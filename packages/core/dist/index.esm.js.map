{"version":3,"file":"index.esm.js","sources":["../../../node_modules/.pnpm/eventemitter3@5.0.1/node_modules/eventemitter3/index.js","../../src/utils.ts","../../src/app.ts","../../src/coordinate/ObservablePoint.ts","../../src/renderables/renderable.ts","../../src/renderables/picture.ts","../../src/renderables/shape.ts","../../src/style/abstract-style.ts","../../src/style/text-style.ts","../../src/renderables/text.ts"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","import type { PointData } from './coordinate/PointData'\nimport type { TextStyle } from './style/text-style'\n\n/**\n *  输出 px\n * @param val\n */\nexport function formatWithPx(val: string | number) {\n  return typeof val === 'string' ? val : `${val}px`\n}\n\n/**\n * 创造 [CSS-font](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font) 字符串\n * 由于 canvas 绘制的差异性部分属性不生效故舍弃\n */\nexport function createCanvasFontString({\n  fontFamily,\n  fontSize,\n  fontStyle = 'normal',\n  fontWeight = 'normal',\n}: TextStyle): string {\n  const _fontSize = typeof fontSize === 'string' ? fontSize : `${fontSize}px`\n  return `${fontStyle} ${fontWeight} ${_fontSize} ${fontFamily}`\n}\n\n/**\n * 计算最小值\n * @param numbers\n */\nexport function calcMin(numbers: number[]) {\n  return numbers.reduce((a, b) => {\n    return a < b ? a : b\n  })\n}\n/**\n * 计算最大值\n * @param numbers\n */\nexport function calcMax(numbers: number[]) {\n  return numbers.reduce((a, b) => {\n    return a > b ? a : b\n  })\n}\n/**\n * 计算差异\n * @param numbers\n */\nexport function calcDiff(numbers: number[]) {\n  return calcMax(numbers) - calcMin(numbers)\n}\n\n/**\n * 确保输入值在 min 和 max 之间，若超出边界则返回边界\n * @param input\n * @param min\n * @param max\n */\nexport function ensureBetween(input: number, min: number = 0, max: number = 1) {\n  return input <= min ? min : input >= max ? max : input\n}\n\n/**\n * 创建代理\n * @param value\n * @param cb\n */\nexport function createProxy<T extends object>(value: T, cb?: (property: string, newValue: any) => void): T {\n  return new Proxy<T>(value, {\n    set: (target, property, newValue) => {\n      target[property as keyof T] = newValue\n      cb?.(property as string, newValue)\n      return true\n    },\n  })\n}\n\nexport enum ENV {\n  WX = 'WX',\n  WEB = 'WEB',\n  UNKNOWN = 'UNKNOWN',\n  UNI_APP = 'UNI_APP',\n}\n\nexport function getEnv() {\n  if (typeof uni !== 'undefined')\n    return ENV.UNI_APP\n  if (typeof wx !== 'undefined')\n    return ENV.WX\n  if (typeof window !== 'undefined' && typeof window.document !== 'undefined')\n    return ENV.WEB\n  return ENV.UNKNOWN\n}\n\n/**\n * Draws a rectangle with rounded corners compatible with different environments.\n *\n * @param {CanvasRenderingContext2D} ctx - The canvas rendering context.\n * @param {PointData} position - The position of the rectangle.\n * @param {PointData} size - The size of the rectangle.\n * @param {number} [rounded] - The radius of the rounded corners.\n *\n * @return {void}\n */\nexport function drawRectCompatible(\n  ctx: CanvasRenderingContext2D,\n  position: PointData,\n  size: PointData,\n  rounded?: number,\n) {\n  rounded = rounded ?? 0\n  rounded = Math.min(rounded, size.x / 2, size.y / 2)\n  ctx.beginPath()\n  if (rounded) {\n    if (getEnv() === ENV.WX) {\n      // 左上角到右上角\n      ctx.moveTo(position.x + rounded, position.y)\n      ctx.arcTo(position.x + size.x, position.y, position.x + size.x, position.y + rounded, rounded)\n      // 右上角到右下角\n      ctx.arcTo(position.x + size.x, position.y + size.y, position.x + size.x - rounded, position.y + size.y, rounded)\n      // 右下角到左下角\n      ctx.arcTo(position.x, position.y + size.y, position.x, position.y + size.y - rounded, rounded)\n      // 左下角到左上角\n      ctx.arcTo(position.x, position.y, position.x + rounded, position.y, rounded)\n      // 闭合路径\n      ctx.closePath()\n    }\n    else {\n      ctx.roundRect(position.x, position.y, size.x, size.y, rounded)\n    }\n  }\n  else {\n    ctx.rect(position.x, position.y, size.x, size.y)\n  }\n}\n","import EventEmitter from 'eventemitter3'\nimport type { Renderable } from './renderables/renderable'\nimport { ENV, formatWithPx, getEnv } from './utils'\n\nexport interface AppOptions {\n  /**\n   *  画布宽度\n   */\n  width?: number\n  /**\n   *  画布高度\n   */\n  height?: number\n  /**\n   *  是否开启dpr\n   */\n  dpr?: boolean | number\n  /**\n   *  `画布元素`或`画布id(微信小程序或者uni-app)`或者`document.querySelector可以接受的字符串`\n   */\n  canvas?: HTMLCanvasElement | string\n  /**\n   * backgroundColor\n   */\n  backgroundColor?: string\n  /**\n   * 画布resize到的元素 仅 web 支持\n   */\n  resizeTo?: HTMLElement | Window | string\n}\n\nexport class App extends EventEmitter<{\n  render: []\n  ready: []\n}> {\n  private ctx!: CanvasRenderingContext2D\n  private _ready = false\n  protected _env = getEnv()\n  canvas!: HTMLCanvasElement\n  ticker!: Ticker\n  dpr = 1\n  width = 0\n  height = 0\n  _width = 0\n  _height = 0\n  removeResizeEvent?: () => void\n  constructor(private options: AppOptions = {}) {\n    super()\n    this.validateAppOptions(options)\n    this.initDpr()\n    this.initTicker()\n    this.initCanvas()\n  }\n\n  onReady(fn: () => void) {\n    if (this._ready) {\n      fn()\n    }\n    else {\n      this.once('ready', () => {\n        fn()\n      })\n    }\n  }\n\n  private validateAppOptions(appOptions: AppOptions) {\n    if (this._env === ENV.WX && !appOptions.canvas) {\n      console.error('当前为非document环境, 无法使用 document.createElement(\\'canvas\\'),\\n 请传入canvas元素或者canvasId')\n    }\n  }\n\n  private initDpr() {\n    const { dpr = true } = this.options\n    if (typeof dpr === 'boolean') {\n      this.dpr = window.devicePixelRatio ?? 1\n    }\n    else {\n      this.dpr = dpr\n    }\n  }\n\n  private initCanvas() {\n    const canvas = this.options.canvas\n    if (canvas) {\n      if (typeof canvas === 'string') {\n        if (this._env === ENV.WEB) {\n          this.canvas = document.querySelector(canvas) as HTMLCanvasElement\n        }\n        else {\n          let query: WechatMiniprogram.SelectorQuery | UniNamespace.SelectorQuery\n          if (this._env === ENV.WX) {\n            query = wx.createSelectorQuery()\n          }\n          else {\n            query = uni.createSelectorQuery()\n          }\n          query.select('#myCanvas')\n            .fields({ node: true, size: true }, undefined as any)\n            .exec((res) => {\n              const canvas = res[0].node as HTMLCanvasElement\n              this.canvas = canvas\n              this.initCanvasRenderingContext2D()\n            })\n        }\n      }\n      else {\n        this.canvas = canvas\n        this.initCanvasRenderingContext2D()\n      }\n    }\n    else {\n      this.canvas = document.createElement('canvas')!\n      this.initCanvasRenderingContext2D()\n    }\n  }\n\n  private initCanvasRenderingContext2D() {\n    const {\n      width = this._env === ENV.WX ? 300 : 600,\n      height = this._env === ENV.WX ? 150 : 300,\n      resizeTo,\n    } = this.options\n    if (!this.canvas)\n      return\n    if (this.canvas.style) {\n      this.canvas.style.backgroundColor = this.options.backgroundColor ?? 'transparent'\n      if (resizeTo) {\n        this.initResizeEvent()\n      }\n      else {\n        this.width = width\n        this.height = height\n      }\n    }\n    else {\n      this.canvas.width = width * this.dpr\n      this.canvas.height = height * this.dpr\n      this.width = width\n      this.height = width\n    }\n\n    this.ctx = this.canvas.getContext('2d')!\n    this._ready = true\n    this.ticker.init(this.canvas, true)\n    this.emit('ready')\n  }\n\n  initResizeEvent(): void {\n    if (!this.options.resizeTo) {\n      return\n    }\n    const resizeTo = this.options.resizeTo\n    const target = typeof resizeTo === 'string'\n      ? document.querySelector(resizeTo) as HTMLElement\n      : resizeTo\n    if (target instanceof Window) {\n      const resizeHandler = () => {\n        this.width = window.innerWidth\n        this.height = window.innerHeight\n      }\n      const _resizeHandler = resizeHandler.bind(this)\n      window.addEventListener('resize', _resizeHandler)\n      this.removeResizeEvent = () => {\n        window.removeEventListener('resize', _resizeHandler)\n      }\n      resizeHandler()\n    }\n    else {\n      const resizeHandler = () => {\n        const width = target.clientWidth\n        const height = target.clientHeight\n        this.width = width\n        this.height = height\n      }\n      const resizeObserver = new ResizeObserver(resizeHandler)\n      resizeObserver.observe(target)\n      this.removeResizeEvent = () => {\n        resizeObserver.disconnect()\n      }\n      resizeHandler()\n    }\n  }\n\n  private get shouldResize() {\n    return this.width !== this._width || this.height !== this._height\n  }\n\n  resize() {\n    if (this.shouldResize) {\n      this.canvas.style.width = formatWithPx(this.width)\n      this.canvas.style.height = formatWithPx(this.height)\n      this.canvas.width = this.width * this.dpr\n      this.canvas.height = this.height * this.dpr\n      this._width = this.width\n      this._height = this.height\n    }\n  }\n\n  private initTicker() {\n    this.ticker = new Ticker()\n    this.ticker.add(this.update.bind(this))\n  }\n\n  private beforeRender() {\n    this.ctx.save()\n  }\n\n  private afterRender() {\n    this.ctx.restore()\n  }\n\n  children: Renderable[] = []\n\n  add(...objects: Renderable[]) {\n    for (let index = 0; index < objects.length; index++) {\n      const object = objects[index]\n      this.children.push(object)\n      object.onAdd(this)\n    }\n  }\n\n  remove(...objects: Renderable[]) {\n    for (let index = 0; index < objects.length; index++) {\n      const object = objects[index]\n      const delIndex = this.children.indexOf(object)\n      if (delIndex !== -1) {\n        object.onRemove()\n        this.children.splice(delIndex, 1)\n      }\n    }\n  }\n\n  private update() {\n    if (!this.children.length) {\n      return\n    }\n    const isDirty = !![...this.children.filter(e => e.dirty)].length || this.shouldResize\n\n    if (!isDirty)\n      return\n\n    if (this.shouldResize) {\n      this.resize()\n    }\n    this.ctx.clearRect(\n      -this.canvas.width,\n      -this.canvas.height,\n      this.canvas.width * 2,\n      this.canvas.height * 2,\n    )\n\n    const shouldRender = [...this.children].filter(e => e.shouldUpdate)\n    while (shouldRender.length) {\n      this.beforeRender()\n      const child = shouldRender.shift()!\n      child.render(this.ctx)\n      child.dirty = false\n      child._renderId++\n      child.emit('render')\n      this.afterRender()\n    }\n  }\n\n  toDataURL(type?: string, quality?: any) {\n    return this.canvas.toDataURL(type, quality)\n  }\n\n  toDataURLAsync(type?: string, quality?: any) {\n    return new Promise<string>((resolve) => {\n      this.once('render', () => {\n        resolve(this.toDataURL(type, quality))\n      })\n    })\n  }\n\n  wrapperRender(fn: (ctx: CanvasRenderingContext2D) => any) {\n    this.beforeRender()\n    fn(this.ctx)\n    this.afterRender()\n  }\n}\n\nclass Ticker {\n  requestAnimationFrame?: typeof requestAnimationFrame\n  cancelAnimationFrame?: typeof cancelAnimationFrame\n  myReq: number = 0\n  private isRunning: boolean = false\n  handler: ((time: number) => void)[] = []\n  protected _env = getEnv()\n  constructor(protected autoStart: boolean = true) {\n\n  }\n\n  init(canvas: HTMLCanvasElement, autoStart: boolean) {\n    if (this._env === ENV.WX) {\n      this.requestAnimationFrame = (canvas as any).requestAnimationFrame.bind(canvas)\n      this.cancelAnimationFrame = (canvas as any).requestAnimationFrame.bind(canvas)\n    }\n    else if (window) {\n      this.requestAnimationFrame = window.requestAnimationFrame.bind(window)\n      this.cancelAnimationFrame = window.cancelAnimationFrame.bind(window)\n    }\n    if (autoStart) {\n      this.start()\n    }\n  }\n\n  add(fn: (time: number) => void) {\n    this.handler.push(fn)\n  }\n\n  removeAll() {\n    this.handler = []\n  }\n\n  remove(fn: (time: number) => void) {\n    const index = this.handler.indexOf(fn)\n    if (index !== -1) {\n      this.handler.splice(index, 1)\n    }\n  }\n\n  start() {\n    this.isRunning = true\n    if (this.requestAnimationFrame) {\n      this.myReq = this.requestAnimationFrame(this.update.bind(this))\n    }\n  }\n\n  stop() {\n    if (this.isRunning && this.myReq) {\n      this.cancelAnimationFrame?.(this.myReq)\n      this.isRunning = false\n    }\n  }\n\n  update() {\n    if (!this.isRunning)\n      return\n    if (this.requestAnimationFrame) {\n      this.myReq = this.requestAnimationFrame(this.update.bind(this))\n    }\n    this.handler.forEach(fn => fn(performance.now()))\n  }\n}\n","import type { PointData } from './PointData'\nimport type { PointLike } from './PointLike'\n\nexport interface Observer<T> {\n  _onUpdate: (point?: T) => void\n}\n\nexport class ObservablePoint implements PointLike {\n  public _x: number\n  public _y: number\n  private readonly _observer: Observer<ObservablePoint> | null\n  constructor(observer: Observer<ObservablePoint> | null, x?: number, y?: number) {\n    this._x = x || 0\n    this._y = y || 0\n    this._observer = observer\n  }\n\n  public clone(observer?: Observer<ObservablePoint>): ObservablePoint {\n    return new ObservablePoint(observer ?? this._observer, this._x, this._y)\n  }\n\n  public set(x = 0, y = x): this {\n    if (this._x !== x || this._y !== y) {\n      this._x = x\n      this._y = y\n      this._observer?._onUpdate(this)\n    }\n    return this\n  }\n\n  public copyFrom(p: PointData): this {\n    if (this._x !== p.x || this._y !== p.y) {\n      this._x = p.x\n      this._y = p.y\n      this._observer?._onUpdate(this)\n    }\n    return this\n  }\n\n  public copyTo<T extends PointLike>(p: T): T {\n    p.set(this._x, this._y)\n    return p\n  }\n\n  public equals(p: PointData): boolean {\n    return (p.x === this._x) && (p.y === this._y)\n  }\n\n  get x(): number {\n    return this._x\n  }\n\n  set x(value: number) {\n    if (this._x !== value) {\n      this._x = value\n      this._observer?._onUpdate(this)\n    }\n  }\n\n  get y(): number {\n    return this._y\n  }\n\n  set y(value: number) {\n    if (this._y !== value) {\n      this._y = value\n      this._observer?._onUpdate(this)\n    }\n  }\n\n  [Symbol.iterator]() {\n    let step = 0\n    const properties = [this.x, this.y]\n\n    return {\n      next: () => {\n        if (step < properties.length) {\n          return { value: properties[step++], done: false }\n        }\n        else {\n          return { done: true, value: undefined }\n        }\n      },\n    }\n  }\n}\n","import EventEmitter from 'eventemitter3'\nimport type { App } from '../app'\nimport type { Observer } from '../coordinate/ObservablePoint'\nimport { ObservablePoint } from '../coordinate/ObservablePoint'\nimport type { PointData } from '../coordinate/PointData'\nimport { createProxy, ensureBetween, getEnv } from '../utils'\n\nexport interface ShadowType {\n  /**\n   * [CanvasRenderingContext2D.shadowColor](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowColor)\n   */\n  color: string\n  /**\n   * [CanvasRenderingContext2D.shadowOffsetX](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowOffsetX)\n   */\n  x?: number\n  /**\n   * [CanvasRenderingContext2D.shadowOffsetY](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowOffsetY)\n   */\n  y?: number\n  /**\n   * [CanvasRenderingContext2D.shadowBlur](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowBlur)\n   */\n  blur?: number\n}\n/**\n * [单位矩阵变化](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setTransform)\n */\nexport interface RenderableOptions {\n  /**\n   * 元素是否可见\n   */\n  visible?: boolean\n  /**\n   * 透明度\n   */\n  alpha?: number\n  /**\n   * 阴影\n   */\n  shadow?: ShadowType\n  /**\n   * 元素位置x\n   */\n  x?: number\n  /**\n   * 元素位置y\n   */\n  y?: number\n  /**\n   * 元素位置\n   */\n  position?: PointData\n  /**\n   * 单位矩阵变化中心，默认是[0,0]表示左上角，[1,1]表示右下角，[0.5,0.5]表示中心\n   *\n   * 此属性可以很好的控制元素的锚点，不用计算相对位置\n   *\n   * 例如：一个500x500的画布上需要绘制一个上下居中的图片\n   *\n   * ``` ts\n   * const text = new Picture('demo.png',{\n   *  anchor: 0.5\n   * })\n   * ```\n   */\n  anchor?: PointData | number\n  /**\n   * 同 anchor，但是具体坐标，建议使用 anchor\n   */\n  pivot?: PointData | number\n  /**\n   * 旋转角度(弧度)\n   */\n  rotation?: number\n  /**\n   * 缩放比例\n   */\n  scale?: PointData | number\n  /**\n   * 元素倾斜\n   */\n  skew?: PointData\n\n}\n/**\n * 默认的倾斜\n */\nconst defaultSkew = new ObservablePoint(null)\n/**\n * 默认的旋转中心\n */\nconst defaultPivot = new ObservablePoint(null)\n/**\n * 默认的锚点\n */\nconst defaultAnchor = new ObservablePoint(null)\n/**\n * 默认的缩放\n */\nconst defaultScale = new ObservablePoint(null, 1, 1)\n\nexport abstract class Renderable extends EventEmitter<{\n  updateBounds: [width: number, height: number]\n  render: []\n}> implements Observer<ObservablePoint> {\n  protected _env = getEnv()\n  constructor(options: RenderableOptions = {}) {\n    super()\n    this.visible = options.visible ?? true\n    this.alpha = options.alpha ?? 1\n    if (options.shadow) {\n      this.shadow = options.shadow\n    }\n\n    if (options.position) {\n      this.position = options.position\n    }\n    else {\n      this.x = options.x ?? 0\n      this.y = options.y ?? 0\n    }\n    if (options.anchor !== undefined) {\n      this.anchor = options.anchor\n    }\n    if (options.pivot !== undefined) {\n      this.pivot = options.pivot\n    }\n    if (options.rotation !== undefined) {\n      this.rotation = options.rotation\n    }\n    if (options.scale !== undefined) {\n      this.scale = options.scale\n    }\n    if (options.skew !== undefined) {\n      this.skew = options.skew\n    }\n  }\n\n  /**\n   * 更新优化\n   */\n  private get _renderableShouldUpdate() {\n    return !(!this.visible\n      || this.scale.x === 0\n      || this.scale.y === 0\n      || this.alpha === 0)\n  }\n  /**\n   * 更新优化\n   * 如果_shouldRender为true 则渲染\n   * 否则跳过渲染\n   */\n  abstract get _shouldUpdate(): boolean\n\n  get shouldUpdate() {\n    return this._renderableShouldUpdate && this._shouldUpdate\n  }\n\n  protected _dirty = false\n  set dirty(value) {\n    if (this._dirty === value)\n      return\n    this._dirty = value\n  }\n\n  get dirty() {\n    return this._dirty\n  }\n\n  private _alpha = 1\n\n  set alpha(value) {\n    if (this.alpha !== value) {\n      this._alpha = value\n      this._onUpdate()\n    }\n  }\n\n  get alpha() {\n    return this._alpha\n  }\n\n  private _shadow: ShadowType = { x: 0, y: 0 } as ShadowType\n\n  set shadow(value) {\n    if (value === this._shadow)\n      return\n    if (value) {\n      if (value.x === undefined)\n        value.x = 5\n      if (value.y === undefined)\n        value.y = 5\n      if (value.blur === undefined)\n        value.blur = 0\n\n      this._shadow = createProxy(value, () => {\n        this._onUpdate()\n      })\n      this._onUpdate()\n    }\n  }\n\n  get shadow(): ShadowType {\n    return this._shadow\n  }\n\n  set x(value) {\n    if (this.x !== value) {\n      this.position.x = value\n    }\n  }\n\n  get x() {\n    return this.position.x\n  }\n\n  set y(value) {\n    if (this.y !== value) {\n      this.position.y = value\n    }\n  }\n\n  get y() {\n    return this.position.y\n  }\n\n  private _position = new ObservablePoint(this, 0, 0)\n\n  set position(value: PointData) {\n    if (this.position !== value && !this.position.equals(value)) {\n      this._position.copyFrom(value)\n    }\n  }\n\n  get position(): ObservablePoint {\n    return this._position\n  }\n\n  private _anchor = defaultAnchor\n\n  set anchor(value: PointData | number) {\n    if (this._anchor === defaultAnchor) {\n      this._anchor = new ObservablePoint(this, 0, 0)\n    }\n    if (typeof value === 'number') {\n      if (this._anchor.equals({ x: value, y: value })) {\n        return\n      }\n      this._anchor.set(value)\n    }\n    else {\n      if (this._anchor.equals(value)) {\n        return\n      }\n      this._anchor.copyFrom(value)\n    }\n  }\n\n  get anchor(): ObservablePoint {\n    if (this._anchor === defaultAnchor) {\n      this._anchor = new ObservablePoint(this, 0, 0)\n    }\n    return this._anchor\n  }\n\n  private _pivot: ObservablePoint = defaultPivot\n\n  set pivot(value: PointData | number) {\n    if (this._pivot === defaultPivot) {\n      this._pivot = new ObservablePoint(this, 0, 0)\n    }\n    if (typeof value === 'number') {\n      if (this._pivot.equals({ x: value, y: value })) {\n        return\n      }\n      this._pivot.set(value)\n    }\n    else {\n      if (this._pivot.equals(value)) {\n        return\n      }\n      this._pivot.copyFrom(value)\n    }\n  }\n\n  get pivot(): ObservablePoint {\n    if (this._pivot === defaultPivot) {\n      this._pivot = new ObservablePoint(this)\n    }\n    return this._pivot\n  }\n\n  private _rotation = 0\n\n  set rotation(value) {\n    if (this.rotation !== value) {\n      this._rotation = value\n      this._onUpdate()\n    }\n  }\n\n  get rotation() {\n    return this._rotation\n  }\n\n  private _scale: ObservablePoint = defaultScale\n\n  set scale(value: PointData | number) {\n    if (this._scale === defaultScale) {\n      this._scale = new ObservablePoint(this, 1, 1)\n    }\n    if (typeof value === 'number') {\n      if (this._scale.equals({ x: value, y: value })) {\n        return\n      }\n      this._scale.set(value)\n    }\n    else {\n      if (this._scale.equals(value)) {\n        return\n      }\n      this._scale.copyFrom(value)\n    }\n  }\n\n  get scale(): ObservablePoint {\n    if (this._scale === defaultScale) {\n      this._scale = new ObservablePoint(this, 1, 1)\n    }\n    return this._scale\n  }\n\n  private _skew: ObservablePoint = defaultSkew\n\n  set skew(value: PointData) {\n    if (this._skew === defaultSkew) {\n      this._skew = new ObservablePoint(this)\n    }\n    if (this._skew.equals(value)) {\n      return\n    }\n    this._skew.copyFrom(value)\n  }\n\n  get skew(): ObservablePoint {\n    if (this._skew === defaultSkew) {\n      this._skew = new ObservablePoint(this, 0, 0)\n    }\n    return this._skew\n  }\n\n  _onUpdate(_point?: ObservablePoint | undefined) {\n    this.dirty = true\n  }\n\n  _app: App | null = null\n\n  private _visible = true\n\n  get visible() {\n    return this._visible\n  }\n\n  set visible(value) {\n    this._visible = value\n    this._onUpdate()\n  }\n\n  protected _shouldUpdateBounds = false\n\n  protected shouldUpdateBounds(type: string) {\n    if (this._shouldUpdateBounds) {\n      return\n    }\n    console.log('shouldUpdateBounds', type)\n    this._shouldUpdateBounds = true\n  }\n\n  /**\n   * 读取阴影\n   * @param ctx\n   */\n  private _readerShadow(ctx: CanvasRenderingContext2D) {\n    if ((this.shadow?.x || this.shadow?.y)\n      && (this.shadow?.blur || this.shadow?.color)) {\n      if (this.shadow.color) {\n        ctx.shadowColor = this.shadow.color\n      }\n      if (this.shadow.blur) {\n        ctx.shadowBlur = this.shadow.blur\n      }\n      if (this.shadow.x) {\n        ctx.shadowOffsetX = this.shadow.x\n      }\n      if (this.shadow.y) {\n        ctx.shadowOffsetY = this.shadow.y\n      }\n    }\n  }\n\n  public render(ctx: CanvasRenderingContext2D) {\n    if (this._shouldUpdateBounds) {\n      this.updateRawSize()\n      this._shouldUpdateBounds = false\n    }\n    if (this.alpha !== 1) {\n      ctx.globalAlpha = this.alpha\n    }\n    const dpr = this._app?.dpr ?? 1\n    const scaleX = this.scale.x * dpr\n    const scaleY = this.scale.y * dpr\n    const skewX = this.skew.x\n    const skewY = this.skew.y\n    const positionX = this.position.x * dpr\n    const positionY = this.position.y * dpr\n    const pivotX = this.pivot.x\n    const pivotY = this.pivot.y\n    const rotation = this.rotation\n\n    const cos = Math.cos(rotation)\n    const sin = Math.sin(rotation)\n\n    const anchorX = ensureBetween(this.anchor.x, 0, 1)\n    const anchorY = ensureBetween(this.anchor.y, 0, 1)\n\n    const originX = this.width * anchorX\n    const originY = this.height * anchorY\n\n    const dx = positionX - (pivotX + originX) * cos * scaleX + (pivotY + originY) * sin * scaleY\n    const dy = positionY - (pivotX + originX) * sin * scaleX - (pivotY + originY) * cos * scaleY\n\n    ctx.setTransform(\n      scaleX * cos + skewY * -sin, // a\n      scaleX * sin + skewY * cos, // b\n      skewX * cos + scaleY * -sin, // c\n      skewX * sin + scaleY * cos, // d\n      dx, // e\n      dy, // f\n    )\n    const _position = this.position.clone()\n    this.position.set(0)\n    this._readerShadow(ctx)\n    this._render(ctx)\n    this.position = _position\n    ctx.resetTransform()\n  }\n\n  _renderId = 0\n\n  protected abstract _render(ctx: CanvasRenderingContext2D): void\n\n  /**\n   * 原始尺寸\n   */\n  protected _rawSize = { width: 0, height: 0 }\n\n  get height() {\n    return this._rawSize.height\n  }\n\n  get width() {\n    return this._rawSize.width\n  }\n\n  /**\n   * 更新原始尺寸\n   */\n  protected abstract updateRawSize(): void\n  /**\n   * 更新原始尺寸\n   */\n  protected changeRawSize(width: number, height: number) {\n    if (this._rawSize.width === width && this._rawSize.height === height) {\n      return\n    }\n    this._rawSize.width = width\n    this._rawSize.height = height\n    this.emit('updateBounds', width, height)\n  }\n\n  onAdd(_app: App) {\n    this._app = _app\n    this._onUpdate()\n  }\n\n  onRemove() {\n    this._app = null\n    this._onUpdate()\n  }\n\n  addTo(app: App) {\n    app.add(this)\n    return this\n  }\n\n  destroy() {\n    this.removeAllListeners()\n  }\n}\n","import type { Properties } from 'csstype'\nimport type { PointData } from '../coordinate/PointData'\nimport { ObservablePoint } from '../coordinate/ObservablePoint'\nimport { ENV, calcDiff, drawRectCompatible } from '../utils'\nimport type { App } from '../app'\nimport type { RenderableOptions, ShadowType } from './renderable'\nimport { Renderable } from './renderable'\n\nexport interface PictureOptions extends RenderableOptions {\n  /**\n   *  image\n   */\n  image: HTMLImageElement | string\n  /**\n   * 图片的宽高\n   */\n  size?: PointData\n  /**\n   * 图片切片的开始坐标\n   */\n  slice?: PointData\n  /**\n   * 图片切片的宽高\n   */\n  sliceSize?: PointData\n  /**\n   * 图片的缩放模式\n   */\n  objectFit?: Properties['objectFit']\n  /**\n   * 圆角\n   */\n  rounded?: number\n  /**\n   * @deprecated 图片不支持阴影\n   */\n  shadow?: ShadowType\n}\n\nexport class Picture extends Renderable {\n  private src = ''\n  constructor(private options?: PictureOptions) {\n    super(options)\n    const maybeImage = options?.image\n    if (typeof maybeImage == 'string') {\n      if (this._env === ENV.WX) {\n        this.src = maybeImage\n      }\n      else {\n        this.image = document.createElement('img')\n        this.image.src = maybeImage\n        this.initImageEvents()\n      }\n      this.rounded = this.options?.rounded ?? 0\n    }\n    else {\n      this.image = maybeImage\n      this.initImageEvents()\n    }\n  }\n\n  onAdd(_app: App) {\n    super.onAdd(_app)\n    if (this._env !== ENV.WEB) {\n      _app.onReady(this.createImage.bind(this))\n    }\n  }\n\n  createImage() {\n    if (!this._app)\n      return\n    this.image = (this._app?.canvas as any).createImage()\n    this.image!.src = this.src\n    this.initImageEvents()\n  }\n\n  initImageEvents() {\n    if (!this.image)\n      return\n    if (this.image.complete) {\n      this._onImageComplete()\n    }\n    else {\n      this.image.addEventListener('load', () => {\n        this._onImageComplete()\n      })\n    }\n  }\n\n  private image?: HTMLImageElement\n\n  private _size = new ObservablePoint(this, 0, 0)\n\n  private _imageSize = new ObservablePoint(this, 0, 0)\n\n  set size(value: PointData) {\n    if (this.size !== value && !this.size.equals(value)) {\n      this._size.copyFrom(value)\n      this.shouldUpdateBounds('size')\n    }\n  }\n\n  get size(): ObservablePoint {\n    return this._size\n  }\n\n  private _slice = new ObservablePoint(this)\n\n  set slice(value: PointData) {\n    if (this.slice !== value) {\n      this._slice.copyFrom(value)\n      this.shouldUpdateBounds('slice')\n    }\n  }\n\n  get slice(): ObservablePoint {\n    return this._slice\n  }\n\n  private _sliceSize = new ObservablePoint(this)\n\n  set sliceSize(value: PointData) {\n    if (this.sliceSize !== value) {\n      this._sliceSize.copyFrom(value)\n      this._onUpdate()\n      this.shouldUpdateBounds('sliceSize')\n    }\n  }\n\n  get sliceSize(): ObservablePoint {\n    return this._sliceSize\n  }\n\n  private _objectFit: Properties['objectFit'] = 'none'\n\n  set objectFit(value) {\n    if (this.objectFit !== value) {\n      this._objectFit = value\n      this.shouldUpdateBounds('objectFit')\n      this._onUpdate()\n    }\n  }\n\n  get objectFit() {\n    return this._objectFit\n  }\n\n  private _rounded = 0\n\n  set rounded(value) {\n    value = value <= 0 ? 0 : value\n    if (this.rounded !== value) {\n      this._rounded = value\n      this._onUpdate()\n    }\n  }\n\n  _onUpdate(_point?: ObservablePoint | undefined) {\n    if (this._complete)\n      super._onUpdate(_point)\n  }\n\n  get rounded() {\n    return this._rounded\n  }\n\n  private _complete = false\n\n  private _onImageComplete() {\n    if (!this.image)\n      return\n    this._imageSize.set(\n      this.image.width,\n      this.image.height,\n    )\n\n    this.size = this.options?.size ?? {\n      x: this.image.width,\n      y: this.image.height,\n    }\n\n    this.slice = this.options?.slice ?? this.slice\n\n    this.sliceSize = this.options?.sliceSize ?? {\n      x: this.size.x,\n      y: this.size.y,\n    }\n\n    this.objectFit = this.options?.objectFit ?? this.objectFit\n\n    this.rounded = this.options?.rounded ?? this.rounded\n    this._complete = true\n    this._onUpdate()\n  }\n\n  get _shouldUpdate(): boolean {\n    return true\n  }\n\n  private get _isSlice() {\n    return (!!this.slice.x || !!this.slice.y) || !this.sliceSize.equals(this.size)\n  }\n\n  private renderRoundedClip(ctx: CanvasRenderingContext2D, position: PointData, size: PointData) {\n    drawRectCompatible(ctx, position, size, this.rounded)\n    ctx.clip()\n  }\n\n  protected _render(ctx: CanvasRenderingContext2D): void {\n    if (!this.image || !this._complete) {\n      return\n    }\n    if (!this._isSlice) {\n      const _size = this.size.clone()\n      const _position = this.position.clone()\n      const scaleDiff = _size.x / this._imageSize.x\n      const diffSize = calcDiff([this._imageSize.x, this._imageSize.y])\n      const diff = diffSize * scaleDiff\n      const slim = this._imageSize.x < this._imageSize.y\n      const fat = this._imageSize.x > this._imageSize.y\n      if (slim || fat) {\n        switch (this.objectFit) {\n          case 'contain':\n            if (slim) {\n              this.position.set(this.position.x - diff / 2, this.position.y)\n              this.size.set(this.size.x - diff, this.size.y)\n            }\n            else {\n              this.position.set(this.position.x, this.position.y + diff / 2)\n              this.size.set(this.size.x, this.size.y - diff)\n            }\n            this.renderRoundedClip(ctx, this.position, this.size)\n            break\n          case 'cover':\n            if (slim) {\n              this.position.set(this.position.x + diff / 2, this.position.y)\n              this.size.set(this.size.x + diff, this.size.y)\n            }\n            else {\n              this.position.set(this.position.x - diff / 2, this.position.y)\n              this.size.set(this.size.x + diff, this.size.y)\n            }\n            this.renderRoundedClip(ctx, _position, _size)\n            break\n          default:\n            this.renderRoundedClip(ctx, this.position, this.size)\n        }\n      }\n      ctx.drawImage(\n        this.image,\n        this.position.x,\n        this.position.y,\n        this.size.x,\n        this.size.y,\n      )\n      this.position = _position\n      this.size = _size\n    }\n    else {\n      const args = [\n        this.image,\n        this.slice.x,\n        this.slice.y,\n        this.sliceSize.x,\n        this.sliceSize.y,\n        this.x,\n        this.y,\n        this.size.x,\n        this.size.y,\n      ] as const\n      this.renderRoundedClip(ctx, this.position, this.size)\n      ctx.drawImage(...args)\n    }\n  }\n\n  protected updateRawSize(): void {\n    this.changeRawSize(this.size.x, this.size.y)\n  }\n}\n","import type { IAbstractStyle, InputColor, StrokeInput } from '../style/abstract-style'\n// import type { FunctionKeys } from '../types'\nimport { ENV, calcDiff, createProxy, drawRectCompatible } from '../utils'\nimport type { RenderableOptions } from './renderable'\nimport { Renderable } from './renderable'\n\n// type CanvasRenderingContext2DMethods = FunctionKeys<CanvasRenderingContext2D>\ninterface PathData<T extends keyof CanvasRenderingContext2D> {\n  action: T\n  args: any[]\n}\n\ntype Methods =\n  | 'beginPath'\n  | 'closePath'\n  | 'moveTo'\n  | 'fill'\n  | 'stroke'\n  | 'lineTo' //\n  | 'rect' //\n  | 'roundRect' //\n  | 'fillRect' //\n  | 'strokeRect'\n  | 'arc' //\n  | 'arcTo' //\n  | 'bezierCurveTo' //\n  | 'ellipse'\n  | 'lineCap'\n  | 'lineJoin'\n\ntype PathInstruction = PathData<Methods>\ninterface _ShapeOptions extends RenderableOptions { }\n\ninterface IShape {\n  beginPath: () => Shape\n  closePath: () => Shape\n  moveTo: (...args: Parameters<CanvasRenderingContext2D['moveTo']>) => Shape\n  lineTo: (...args: Parameters<CanvasRenderingContext2D['lineTo']>) => Shape\n  stroke: (value?: StrokeInput | InputColor) => Shape\n  fill: (color?: InputColor) => Shape\n  rect: (...args: Parameters<CanvasRenderingContext2D['rect']>) => Shape\n  roundRect: (...args: Parameters<CanvasRenderingContext2D['roundRect']>) => Shape\n  arc: (...args: Parameters<CanvasRenderingContext2D['arc']>) => Shape\n  arcTo: (...args: Parameters<CanvasRenderingContext2D['arcTo']>) => Shape\n  bezierCurveTo: (...args: Parameters<CanvasRenderingContext2D['bezierCurveTo']>) => Shape\n  ellipse: (...args: Parameters<CanvasRenderingContext2D['ellipse']>) => Shape\n  fillRect: (...args: Parameters<CanvasRect['fillRect']>) => Shape\n  strokeRect: (...args: Parameters<CanvasRect['strokeRect']>) => Shape\n  lineCap: (...args: [CanvasRenderingContext2D['lineCap']]) => void\n  lineJoin: (...args: [CanvasRenderingContext2D['lineJoin']]) => void\n}\n\nexport type ShapeOptions = Partial<_ShapeOptions>\n\nexport class Shape extends Renderable implements IShape {\n  constructor(options: ShapeOptions = {}) {\n    super(options)\n    this._onUpdate()\n  }\n\n  private addPath(...items: PathInstruction[]) {\n    this.pathInstruction.push(...items)\n    this.shouldUpdateBounds('path')\n  }\n\n  beginPath(): Shape {\n    this.addPath({\n      action: 'beginPath',\n      args: [],\n    })\n    return this\n  }\n\n  closePath() {\n    this.addPath({\n      action: 'closePath',\n      args: [],\n    })\n    return this\n  }\n\n  lineCap(cap: 'butt' | 'round' | 'square') {\n    this.addPath({\n      action: 'lineCap',\n      args: [cap],\n    })\n    return this\n  }\n\n  lineJoin(join: 'bevel' | 'miter' | 'round') {\n    this.addPath({\n      action: 'lineJoin',\n      args: [join],\n    })\n    return this\n  }\n\n  moveTo(x: number, y: number) {\n    this.addPath({\n      action: 'moveTo',\n      args: [x, y],\n    })\n    return this\n  }\n\n  lineTo(x: number, y: number) {\n    this.addPath({\n      action: 'lineTo',\n      args: [x, y],\n    })\n    return this\n  }\n\n  rect(x: number, y: number, w: number, h: number) {\n    this.addPath({\n      action: 'rect',\n      args: [x, y, w, h],\n    })\n    return this\n  }\n\n  roundRect(\n    x: number,\n    y: number,\n    w: number,\n    h: number,\n    radii?: number | DOMPointInit | Iterable<number | DOMPointInit>,\n  ) {\n    this.addPath({\n      action: 'roundRect',\n      args: [x, y, w, h, radii],\n    })\n    return this\n  }\n\n  arc(\n    x: number,\n    y: number,\n    radius: number,\n    startAngle: number = 0,\n    endAngle: number = 2 * Math.PI,\n    counterclockwise?: boolean,\n  ) {\n    this.addPath({\n      action: 'arc',\n      args: [x, y, radius, startAngle, endAngle, counterclockwise],\n    })\n    return this\n  }\n\n  arcTo(x1: number, y1: number, x2: number, y2: number, radius: number) {\n    this.addPath({\n      action: 'arcTo',\n      args: [x1, y1, x2, y2, radius],\n    })\n    return this\n  }\n\n  bezierCurveTo(\n    cp1x: number,\n    cp1y: number,\n    cp2x: number,\n    cp2y: number,\n    x: number,\n    y: number,\n  ) {\n    this.addPath({\n      action: 'bezierCurveTo',\n      args: [cp1x, cp1y, cp2x, cp2y, x, y],\n    })\n    return this\n  }\n\n  ellipse(\n    x: number,\n    y: number,\n    radiusX: number,\n    radiusY: number,\n    rotation: number,\n    startAngle: number,\n    endAngle: number,\n    counterclockwise?: boolean,\n  ) {\n    this.addPath({\n      action: 'ellipse',\n      args: [x, y, radiusX, radiusY, rotation, startAngle, endAngle, counterclockwise],\n    })\n    return this\n  }\n\n  fillRect(x: number, y: number, w: number, h: number) {\n    this.addPath({\n      action: 'fillRect',\n      args: [x, y, w, h],\n    })\n    return this\n  }\n\n  strokeRect(x: number, y: number, w: number, h: number) {\n    this.addPath({\n      action: 'strokeRect',\n      args: [x, y, w, h],\n    })\n    return this\n  }\n\n  private pathInstruction: PathInstruction[] = []\n  get _shouldUpdate(): boolean {\n    const actions = this.pathInstruction.map(item => item.action)\n    if (actions.includes('fill')\n      || actions.includes('stroke')) {\n      return true\n    }\n    return false\n  }\n\n  protected _render(ctx: CanvasRenderingContext2D): void {\n    if (!ctx) {\n      throw new Error('CanvasRenderingContext2D is null or undefined')\n    }\n    for (let index = 0; index < this.pathInstruction.length; index++) {\n      const { action, args } = this.pathInstruction[index]\n      if (action === 'fill') {\n        if (args[0]) {\n          ctx.fillStyle = args[0]\n        }\n        else if (this.fillStyle) {\n          ctx.fillStyle = this.fillStyle\n        }\n        ctx.fill()\n      }\n      else if (action === 'stroke') {\n        if (args[0]) {\n          const strokeInput = args[0] as StrokeInput | InputColor\n          if (typeof strokeInput === 'string'\n            || (typeof CanvasGradient !== 'undefined' && strokeInput instanceof CanvasGradient)\n            || (typeof CanvasPattern !== 'undefined' && strokeInput instanceof CanvasPattern)\n          ) {\n            ctx.strokeStyle = strokeInput\n            ctx.lineWidth = this.strokeStyle.width ?? 1\n          }\n          else {\n            const _strokeInput = strokeInput as StrokeInput\n            const color = _strokeInput.color ?? this.strokeStyle.color\n            if (color)\n              ctx.strokeStyle = color\n\n            const width = _strokeInput.width ?? this.strokeStyle.width\n\n            if (width)\n              ctx.lineWidth = width\n\n            if (_strokeInput.dash) {\n              ctx.setLineDash(_strokeInput.dash)\n            }\n            else {\n              ctx.setLineDash([])\n            }\n          }\n        }\n        else {\n          if (this.strokeStyle.color)\n            ctx.strokeStyle = this.strokeStyle.color\n          if (this.strokeStyle.width)\n            ctx.lineWidth = this.strokeStyle.width\n          if (this.strokeStyle.dash) {\n            ctx.setLineDash(this.strokeStyle.dash)\n          }\n          else {\n            ctx.setLineDash([])\n          }\n        }\n        ctx.stroke()\n      }\n      else if (['lineCap', 'lineJoin'].includes(action)) {\n        ctx[action] = args[0]\n      }\n      else if (action === 'roundRect' && this._env === ENV.WX) {\n        drawRectCompatible(ctx, { x: args[0], y: args[1] }, { x: args[2], y: args[3] }, args[4])\n      }\n      else {\n        if (!(action in ctx)) {\n          throw new Error(`CanvasRenderingContext2D has no method ${action}`)\n        }\n        else {\n          ;(ctx[action] as (...args: any[]) => void)(...args)\n        }\n      }\n    }\n  }\n\n  private _strokeStyle: StrokeInput = {}\n\n  set strokeStyle(value: StrokeInput | InputColor) {\n    if (value === this._strokeStyle)\n      return\n    if (\n      typeof value === 'string'\n      || (typeof CanvasGradient !== 'undefined' && value instanceof CanvasGradient)\n      || (typeof CanvasPattern !== 'undefined' && value instanceof CanvasPattern)\n    ) {\n      this._strokeStyle = createProxy({\n        ...this._strokeStyle,\n        color: value,\n      }, () => {\n        this._onUpdate()\n      })\n    }\n    else {\n      this._strokeStyle = createProxy(value as StrokeInput, () => {\n        this._onUpdate()\n      })\n      this._onUpdate()\n    }\n  }\n\n  get strokeStyle(): StrokeInput {\n    return this._strokeStyle\n  }\n\n  protected updateRawSize(): void {\n    const allX: number[] = []\n    const allY: number[] = []\n\n    for (let index = 0; index < this.pathInstruction.length; index++) {\n      const { action, args } = this.pathInstruction[index]\n      switch (action) {\n        case 'lineTo':\n\n          allX.push(args[0])\n          allY.push(args[1])\n          break\n        case 'fillRect':\n        case 'strokeRect':\n        case 'roundRect':\n        case 'rect':{\n          // const strokeWeight = this.getNextStrokeWidth(index)\n          allX.push(args[0])\n          allY.push(args[1])\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[3])\n          break\n        }\n        case 'arc':{\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[2])\n          break\n        }\n        case 'arcTo':{\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[2])\n          break\n        }\n        case 'bezierCurveTo': {\n          allX.push(args[2] + args[4])\n          allY.push(args[3] + args[5])\n          break\n        }\n        case 'ellipse':\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[3])\n      }\n    }\n    const w = calcDiff(allX)\n    const h = calcDiff(allY)\n    this.changeRawSize(w, h)\n  }\n\n  private _fillStyle: InputColor | null = null\n\n  set fillStyle(value) {\n    this._fillStyle = value\n    this._onUpdate()\n  }\n\n  get fillStyle() {\n    return this._fillStyle\n  }\n\n  fill(color?: IAbstractStyle['fill']) {\n    if (color) {\n      this.addPath({\n        action: 'fill',\n        args: [color],\n      })\n    }\n    return this\n  }\n\n  stroke(value?: StrokeInput | InputColor) {\n    this.addPath({\n      action: 'stroke',\n      args: value ? [value] : [],\n    })\n    return this\n  }\n\n  private _filter = 'none'\n\n  set filter(value) {\n    this._filter = value\n    this._onUpdate()\n  }\n\n  get filter() {\n    return this._filter\n  }\n}\n","import EventEmitter from 'eventemitter3'\nimport { createProxy } from '../utils'\n\nexport type InputColor = CanvasRenderingContext2D['strokeStyle']\nexport type LineDash = Iterable<number>\nexport interface StrokeInput {\n  /**\n   * 颜色\n   */\n  color?: InputColor\n  /**\n   * 宽度 同 [lineWidth](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/lineWidth)\n   */\n  width?: number\n  /**\n   * [CanvasRenderingContext2D.lineDashOffset](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/lineDashOffset)\n   */\n  dash?: LineDash\n}\n/**\n * 抽象样式\n */\nexport interface IAbstractStyle {\n  /**\n   * 填充颜色\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/fillStyle)\n   */\n  fill: CanvasRenderingContext2D['fillStyle'] | null\n  /**\n   * 描边颜色 当仅仅指定stroke 而未指定 fill 时 只会绘制镂空文字\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/strokeStyle)\n   */\n  stroke: StrokeInput\n  /**\n   * [CanvasRenderingContext2D.filter](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/filter)\n   */\n  filter: CanvasRenderingContext2D['filter']\n}\nexport abstract class AbstractStyle extends EventEmitter<{\n  update: []\n  updateBounds: []\n}> implements IAbstractStyle {\n  private _fill = '#000'\n\n  set fill(value) {\n    this._fill = value\n    this.update()\n  }\n\n  get fill() {\n    return this._fill\n  }\n\n  private _stroke: StrokeInput = {}\n\n  set stroke(value: StrokeInput | InputColor) {\n    if (value === this._stroke)\n      return\n    if (\n      typeof value === 'string'\n      || (typeof CanvasGradient !== 'undefined' && value instanceof CanvasGradient)\n      || (typeof CanvasPattern !== 'undefined' && value instanceof CanvasPattern)\n    ) {\n      this._stroke = createProxy({\n        ...this._stroke,\n        color: value,\n      }, () => {\n        this.update()\n      })\n    }\n    else {\n      this._stroke = createProxy(value as StrokeInput, () => {\n        this.update()\n      })\n      this.update()\n    }\n  }\n\n  get stroke(): StrokeInput {\n    return this._stroke\n  }\n\n  private _filter = 'none'\n\n  set filter(value) {\n    this._filter = value\n    this.update()\n  }\n\n  get filter() {\n    return this._filter\n  }\n\n  update() {\n    this.emit('update')\n  }\n\n  updateBounds() {\n    this.emit('updateBounds')\n  }\n\n  render(ctx: CanvasRenderingContext2D) {\n    if (this.stroke.color && this.stroke.width) {\n      ctx.lineWidth = this.stroke.width\n      ctx.strokeStyle = this.stroke.color\n    }\n    if (this.fill) {\n      ctx.fillStyle = this.fill\n    }\n    if (this.filter) {\n      ctx.filter = this.filter\n    }\n    return this\n  }\n\n  destroy() {\n    this.removeAllListeners()\n  }\n}\n","import type { Properties } from 'csstype'\nimport { createCanvasFontString, formatWithPx } from '../utils'\nimport type { IAbstractStyle } from './abstract-style'\nimport { AbstractStyle } from './abstract-style'\n\nexport interface TextStyleOptions extends IAbstractStyle {\n  /**\n   * @description 字体大小 当值为 number 时单位为px\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-size)\n   */\n  fontSize: Properties['fontSize'] | (number & {})\n  /**\n   * 文本时文本的对齐方式\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/textAlign)\n   */\n  textAlign: CanvasTextAlign\n  /**\n   * @description 字体\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-family)\n   */\n  fontFamily: Properties['fontFamily']\n  /**\n   * @description 字体样式\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-style)\n   */\n  fontStyle: Properties['fontStyle']\n  /**\n   * @description 字体的粗细程度\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-weight)\n   */\n  fontWeight: Properties['fontWeight']\n  /**\n   * 指定绘制文本时字体如何被扩展或压缩\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fontStretch)\n   */\n  fontStretch: CanvasFontStretch\n  /**\n   * 用于指定渲染文本的替代大写形式\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fontVariantCaps)\n   */\n  fontVariantCaps: CanvasFontVariantCaps\n  /**\n   * 用于指定绘制文本时字母之间的间距\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/letterSpacing)\n   */\n  letterSpacing: string | number\n  /**\n   * 指定绘制文本时单词之间的间距\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/wordSpacing)\n   */\n  wordSpacing: string | number\n  /**\n   * 是否开启换行\n   */\n  wordWrap: boolean\n  /**\n   * 换行宽度\n   */\n  wordWrapWidth: number\n  /**\n   * 用于指定文本的行高 仅当 `wordWrap` 为 `true` 时有效\n   */\n  lineHeight: number\n}\n\nexport class TextStyle extends AbstractStyle implements TextStyleOptions {\n  public static defaultTextStyle: TextStyleOptions = {\n    fill: 'black',\n    stroke: {\n      width: 1,\n    },\n    filter: 'none',\n    // 文本\n    fontSize: 12,\n    textAlign: 'left',\n    fontFamily: 'Arial',\n    fontStyle: 'normal',\n    fontWeight: 'normal',\n    fontStretch: 'condensed',\n    fontVariantCaps: 'normal',\n    letterSpacing: 0,\n    wordSpacing: 0,\n    wordWrap: false,\n    lineHeight: 12, // 默认为字体大小\n    wordWrapWidth: 0,\n  }\n\n  constructor(style: Partial<TextStyleOptions> = {}) {\n    super()\n    const fullStyle = Object.assign({}, TextStyle.defaultTextStyle, style)\n    for (const key in fullStyle) {\n      const thisKey = key as keyof typeof this\n      const data = fullStyle[key as keyof TextStyleOptions] as any\n      if (key === 'stroke') {\n        this[thisKey] = Object.assign({}, TextStyle.defaultTextStyle[key] as unknown as object, data)\n      }\n      else {\n        this[thisKey] = data\n      }\n    }\n  }\n\n  public reset() {\n    const defaultStyle = TextStyle.defaultTextStyle\n    for (const key in defaultStyle) {\n      this[key as keyof typeof this] = defaultStyle[key as keyof TextStyleOptions] as any\n    }\n    this.updateBounds()\n    this.update()\n  }\n\n  // set fill(value: CanvasRenderingContext2D['fillStyle'] | null) {\n  //   this._fill = value ? String(value) : 'black'\n  //   this.update()\n  // }\n\n  // get fill(): string {\n  //   return this._fill\n  // }\n\n  protected readonly textBaseline = 'top'\n\n  private _fontSize: TextStyleOptions['fontSize']\n  set fontSize(value) {\n    this._fontSize = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontSize() {\n    return this._fontSize\n  }\n\n  private _fontFamily: TextStyleOptions['fontFamily']\n  set fontFamily(value) {\n    this._fontFamily = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontFamily() {\n    return this._fontFamily\n  }\n\n  private _fontStyle: TextStyleOptions['fontStyle']\n\n  set fontStyle(value) {\n    this._fontStyle = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontStyle() {\n    return this._fontStyle\n  }\n\n  private _fontWeight: TextStyleOptions['fontWeight']\n\n  set fontWeight(value) {\n    this._fontWeight = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontWeight() {\n    return this._fontWeight\n  }\n\n  private _fontStretch: TextStyleOptions['fontStretch'] = TextStyle.defaultTextStyle.fontStretch\n\n  set fontStretch(value) {\n    this._fontStretch = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontStretch() {\n    return this._fontStretch\n  }\n\n  private _fontVariantCaps: TextStyleOptions['fontVariantCaps'] = TextStyle.defaultTextStyle.fontVariantCaps\n\n  set fontVariantCaps(value) {\n    this._fontVariantCaps = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontVariantCaps() {\n    return this._fontVariantCaps\n  }\n\n  private _letterSpacing: TextStyleOptions['letterSpacing'] = TextStyle.defaultTextStyle.letterSpacing\n\n  set letterSpacing(value) {\n    this._letterSpacing = value\n    this.update()\n    this.updateBounds()\n  }\n\n  get letterSpacing() {\n    return this._letterSpacing\n  }\n\n  private _wordSpacing: TextStyleOptions['wordSpacing'] = TextStyle.defaultTextStyle.wordSpacing\n\n  set wordSpacing(value) {\n    this._wordSpacing = value\n    this.update()\n    this.updateBounds()\n  }\n\n  get wordSpacing() {\n    return this._wordSpacing\n  }\n\n  private _textAlign: TextStyleOptions['textAlign'] = TextStyle.defaultTextStyle.textAlign\n\n  set textAlign(value) {\n    this._textAlign = value\n    this.update()\n  }\n\n  get textAlign() {\n    return this._textAlign\n  }\n\n  private _lineHeight = 0\n\n  set lineHeight(value) {\n    if (this.lineHeight !== value) {\n      this._lineHeight = value\n      this.update()\n      this.updateBounds()\n    }\n  }\n\n  get lineHeight() {\n    if (!this._lineHeight) {\n      this._lineHeight = typeof this.fontSize == 'number' ? this.fontSize : Number.parseInt(`${this.fontSize}`)\n    }\n    return this._lineHeight\n  }\n\n  private _wordWrap = false\n\n  set wordWrap(value) {\n    if (this.wordWrap !== value) {\n      this._wordWrap = value\n      this.update()\n      this.updateBounds()\n    }\n  }\n\n  get wordWrap() {\n    return this._wordWrap\n  }\n\n  private _wordWrapWidth = 0\n\n  set wordWrapWidth(value) {\n    if (this.wordWrapWidth !== value) {\n      this._wordWrapWidth = value\n      this.update()\n      this.updateBounds()\n    }\n  }\n\n  get wordWrapWidth() {\n    return this._wordWrapWidth\n  }\n\n  clone() {\n    return new TextStyle({\n      fill: this.fill,\n      stroke: this.stroke,\n      fontFamily: this.fontFamily,\n      fontSize: this.fontSize,\n      fontStyle: this.fontStyle,\n      fontWeight: this.fontWeight,\n      fontStretch: this.fontStretch,\n      fontVariantCaps: this.fontVariantCaps,\n      letterSpacing: this.letterSpacing,\n      wordSpacing: this.wordSpacing,\n      textAlign: this.textAlign,\n      filter: this.filter,\n    })\n  }\n\n  render(ctx: CanvasRenderingContext2D) {\n    super.render(ctx)\n    ctx.textBaseline = 'top'\n    ctx.font = createCanvasFontString(this)\n    ctx.fontStretch = this.fontStretch\n    ctx.fontVariantCaps = this.fontVariantCaps\n    ctx.letterSpacing = formatWithPx(this.letterSpacing)\n    ctx.wordSpacing = formatWithPx(this.wordSpacing)\n    ctx.textAlign = this.textAlign\n    return this\n  }\n};\n","import type { TextStyleOptions } from '../style/text-style'\nimport { TextStyle } from '../style/text-style'\nimport type { RenderableOptions } from './renderable'\nimport { Renderable } from './renderable'\n\nexport interface TextOptions extends RenderableOptions {\n  /**\n   * 文本\n   */\n  text: string\n  /**\n   * 文本样式\n   */\n  style?: Partial<TextStyleOptions> | TextStyle\n}\n\nexport class Text extends Renderable {\n  constructor(options: TextOptions) {\n    super(options)\n    if (options.style)\n      this.style = options.style\n    this.text = options.text ?? ''\n    this._onUpdate()\n  }\n\n  private _style = new TextStyle()\n\n  set style(style: Partial<TextStyleOptions> | TextStyle) {\n    style = style || {}\n    this._style?.off('update', this._onUpdate, this)\n    this._style?.off('updateBounds', this.shouldUpdateBounds.bind(this, 'style'), this)\n    if (style instanceof TextStyle) {\n      this._style = style\n    }\n    else {\n      this._style = new TextStyle(style)\n    }\n    this._style.on('update', this._onUpdate, this)\n    this._style?.on('updateBounds', this.shouldUpdateBounds.bind(this, 'style'), this)\n    this.shouldUpdateBounds('any')\n    this._onUpdate()\n  }\n\n  get style(): TextStyle {\n    return this._style\n  }\n\n  private _text = ''\n\n  set text(text) {\n    if (this._text === text)\n      return\n    this._text = text\n    this._onUpdate()\n  }\n\n  get text() {\n    return this._text\n  }\n\n  get _shouldUpdate(): boolean {\n    return !!(this.style.fill) || !!(this.style.stroke.color && this.style.stroke.width)\n  }\n\n  getSplitText(ctx: CanvasRenderingContext2D) {\n    const texts = this.text.split('')\n    const splitText = []\n    let multilineText: string[] = []\n    for (let i = 0; i < texts.length; i++) {\n      const currentStr = texts[i]\n      multilineText.push(currentStr)\n      const rowStr = multilineText.join('')\n      if (ctx.measureText(rowStr).width > this.style.wordWrapWidth) {\n        multilineText.pop()\n        splitText.push(multilineText.join(''))\n        multilineText = [currentStr]\n        continue\n      }\n      if (i === texts.length - 1) {\n        splitText.push(rowStr)\n      }\n    }\n    return splitText\n  }\n\n  _render(ctx: CanvasRenderingContext2D) {\n    if (this.style.fill || (this.style.stroke?.color && this.style.stroke?.width)) {\n      this.style.render(ctx)\n      // 绘制单行文本\n      if (!this.style.wordWrap || !this.style.wordWrapWidth) {\n        if (this.style.stroke?.color && this.style.stroke?.width) {\n          ctx.strokeText(this.text, this.position.x, this.position.y)\n        }\n        if (this.style.fill) {\n          ctx.fillText(this.text, this.position.x, this.position.y)\n        }\n      }\n      else {\n        const splitText = this.getSplitText(ctx)\n        for (let i = 0; i < splitText.length; i++) {\n          const text = splitText[i]\n          if (this.style.fill) {\n            ctx.fillText(text, this.position.x, this.position.y + i * this.style.lineHeight)\n          }\n          if (this.style.stroke?.color && this.style.stroke?.width) {\n            ctx.strokeText(text, this.position.x, this.position.y + i * this.style.lineHeight)\n          }\n        }\n      }\n    }\n  }\n\n  protected updateRawSize() {\n    if (!this._app) {\n      return\n    }\n    this._app.wrapperRender((ctx) => {\n      this.style.render(ctx)\n      let rawWidth = this._rawSize.width\n      let rawHeight = this._rawSize.height\n      if (!this.style.wordWrap || !this.style.wordWrapWidth) {\n        const measure = ctx.measureText(this.text)\n        rawWidth = measure.width\n        let height = Math.max(...[\n          measure.actualBoundingBoxDescent - measure.actualBoundingBoxAscent,\n          typeof this.style.fontSize == 'number' ? this.style.fontSize : Number.parseInt(`${this.style.fontSize}`),\n        ])\n        if (this.style.stroke && this.style.stroke.width) {\n          height += this.style.stroke.width\n        }\n        rawHeight = height\n      }\n      else {\n        const splitText = this.getSplitText(ctx)\n        rawWidth = this.style.wordWrapWidth\n        if (!splitText.length) {\n          rawHeight = 0\n          return\n        }\n        const measure = ctx.measureText(this.getSplitText(ctx)[0])\n        const lineHeight = this.style.lineHeight\n        let height = Math.max(...[\n          measure.actualBoundingBoxDescent - measure.actualBoundingBoxAscent,\n          lineHeight,\n        ])\n        if (this.style.stroke && this.style.stroke.width) {\n          height += this.style.stroke.width\n        }\n        if (splitText.length > 1) {\n          rawHeight = (splitText.length - 1) * lineHeight + height\n        }\n      }\n      this.changeRawSize(rawWidth, rawHeight)\n    })\n  }\n};\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","exports","ENV","formatWithPx","val","calcDiff","numbers","reduce","a","b","calcMax","calcMin","ensureBetween","input","min","max","createProxy","value","cb","Proxy","set","target","property","newValue","getEnv","uni","UNI_APP","wx","WX","window","document","WEB","UNKNOWN","drawRectCompatible","ctx","position","size","rounded","Math","x","y","beginPath","moveTo","arcTo","closePath","roundRect","rect","App","options","_ready","_env","canvas","ticker","dpr","width","height","_width","_height","removeResizeEvent","constructor","super","validateAppOptions","initDpr","initTicker","initCanvas","onReady","appOptions","console","error","devicePixelRatio","querySelector","query","createSelectorQuery","select","fields","node","exec","res","initCanvasRenderingContext2D","createElement","resizeTo","style","backgroundColor","initResizeEvent","getContext","init","Window","resizeHandler","innerWidth","innerHeight","_resizeHandler","bind","addEventListener","removeEventListener","clientWidth","clientHeight","resizeObserver","ResizeObserver","observe","disconnect","shouldResize","resize","Ticker","add","update","beforeRender","save","afterRender","restore","children","objects","index","object","onAdd","remove","delIndex","indexOf","onRemove","splice","filter","e","dirty","clearRect","shouldRender","shouldUpdate","child","shift","render","_renderId","toDataURL","type","quality","toDataURLAsync","Promise","resolve","wrapperRender","autoStart","requestAnimationFrame","cancelAnimationFrame","myReq","isRunning","handler","start","removeAll","stop","forEach","performance","now","ObservablePoint","_x","_y","_observer","observer","clone","_onUpdate","copyFrom","p","copyTo","equals","Symbol","iterator","step","properties","next","done","defaultSkew","defaultPivot","defaultAnchor","defaultScale","Renderable","visible","alpha","shadow","anchor","pivot","rotation","scale","skew","_renderableShouldUpdate","_shouldUpdate","_dirty","_alpha","_shadow","blur","_position","_anchor","_pivot","_rotation","_scale","_skew","_point","_app","_visible","_shouldUpdateBounds","shouldUpdateBounds","log","_readerShadow","color","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","updateRawSize","globalAlpha","scaleX","scaleY","skewX","skewY","positionX","positionY","pivotX","pivotY","cos","sin","anchorX","anchorY","originX","originY","dx","dy","setTransform","_render","resetTransform","_rawSize","changeRawSize","addTo","app","destroy","Picture","src","maybeImage","image","initImageEvents","createImage","complete","_onImageComplete","_size","_imageSize","_slice","_sliceSize","sliceSize","_objectFit","objectFit","_rounded","_complete","_isSlice","renderRoundedClip","clip","drawImage","scaleDiff","diff","slim","fat","Shape","addPath","items","pathInstruction","action","lineCap","cap","lineJoin","join","lineTo","w","h","radii","arc","radius","startAngle","endAngle","PI","counterclockwise","x1","y1","x2","y2","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","ellipse","radiusX","radiusY","fillRect","strokeRect","actions","map","item","includes","Error","fillStyle","fill","strokeInput","CanvasGradient","CanvasPattern","strokeStyle","lineWidth","_strokeInput","dash","setLineDash","stroke","_strokeStyle","allX","allY","_fillStyle","_filter","AbstractStyle","_fill","_stroke","updateBounds","TextStyle","static","fontSize","textAlign","fontFamily","fontStyle","fontWeight","fontStretch","fontVariantCaps","letterSpacing","wordSpacing","wordWrap","lineHeight","wordWrapWidth","fullStyle","assign","defaultTextStyle","key","thisKey","data","reset","defaultStyle","textBaseline","_fontSize","_fontFamily","_fontStyle","_fontWeight","_fontStretch","_fontVariantCaps","_letterSpacing","_wordSpacing","_textAlign","_lineHeight","Number","parseInt","_wordWrap","_wordWrapWidth","font","createCanvasFontString","Text","text","_style","_text","getSplitText","texts","split","splitText","multilineText","currentStr","rowStr","measureText","pop","fillText","strokeText","rawWidth","rawHeight","measure","actualBoundingBoxDescent","actualBoundingBoxAscent"],"mappings":"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","x_google_ignoreList":[0]}