{"version":3,"file":"app.js","sources":["../src/app.ts"],"sourcesContent":["import type { Display } from './object/display'\nimport type { RenderImpl } from './types'\nimport { formatValue } from './utils'\n\ninterface AppConstructorOptions {\n  width?: number\n  height?: number\n  dpr?: boolean\n\n}\nexport class App {\n  canvas: HTMLCanvasElement\n  ctx: CanvasRenderingContext2D\n  dpr = 1\n  width: number\n  height: number\n  constructor({\n    width = 600,\n    height = 800,\n   dpr = true,\n  }: AppConstructorOptions = {}) {\n    if (dpr) {\n      this.dpr = window.devicePixelRatio ?? 1\n    }\n    this.canvas = document.createElement('canvas')!\n    this.ctx = this.canvas.getContext('2d')!\n    this.canvas.style.width = formatValue(width)\n    this.canvas.style.height = formatValue(height)\n    this.canvas.width = width * this.dpr\n    this.canvas.height = height * this.dpr\n    this.ctx.scale(this.dpr, this.dpr)\n    this.width = width\n    this.height = height\n    this.debug()\n    this.update()\n  }\n\n  private beforeRender() {\n    this.ctx.save()\n  }\n\n  private afterRender() {\n    this.ctx.restore()\n  }\n\n  private debug() {\n    this.beforeRender()\n    const ctx = this.ctx\n    ctx.stroke()\n    ctx.textBaseline = 'top'\n    ctx.font = '12px 黑体'\n    for (let row = 0; row < Math.ceil((this.width + 1) / 100); row++) {\n      for (let col = 0; col < Math.ceil((this.height + 1) / 100); col++) {\n        ctx.fillText(`${row * 100},${col * 100}`, row * 100, col * 100)\n        if (row === 0 || col === 0) {\n          continue\n        }\n        ctx.moveTo(row * 100 - 100, col * 100)\n        ctx.lineTo(row * 100, col * 100)\n        ctx.lineTo(row * 100, col * 100 - 100)\n        // ctx.stroke()\n      }\n    }\n    this.afterRender()\n  }\n\n  children: Display[] = []\n  add(object: Display) {\n    this.children.push(object)\n  }\n\n  // renders: ((ctx: CanvasRenderingContext2D) => void)[] = []\n\n  private update() {\n    // window.requestAnimationFrame(() => {\n    //   this.update()\n    // })\n    const needUpdateObject: Display[] = []\n    for (let index = 0; index < this.children.length; index++) {\n      const object = this.children[index]\n      if (object._shouldUpdate) {\n        needUpdateObject.push(object)\n      }\n    }\n    if (needUpdateObject.length) {\n      this.ctx.clearRect(\n        -this.width,\n        -this.height,\n        this.width * 2,\n        this.height * 2,\n      )\n      this.debug()\n    }\n\n    const children = [...this.children]\n    while (children.length) {\n      children.shift()?.render(this.ctx)\n    }\n  }\n}\n"],"names":["formatValue"],"mappings":"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"}