{"version":3,"file":"index.esm.js","sources":["../node_modules/.pnpm/eventemitter3@5.0.1/node_modules/eventemitter3/index.js","../src/utils.ts","../src/app.ts","../src/coordinate/ObservablePoint.ts","../src/object/display.ts","../src/object/picture.ts","../src/object/shape.ts","../src/style/abstract-style.ts","../src/style/text-style.ts","../src/object/text.ts"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","import type { PointData } from './coordinate/PointData'\nimport type { TextStyle } from './style/text-style'\n\n/**\n *  输出 px\n * @param val\n */\nexport function formatWithPx(val: string | number) {\n  return typeof val === 'string' ? val : `${val}px`\n}\n\n/**\n * 创造 [CSS-font](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font) 字符串\n * 由于 canvas 绘制的差异性部分属性不生效故舍弃\n */\nexport function createCanvasFontString({\n  fontFamily,\n  fontSize,\n  fontStyle = 'normal',\n  fontWeight = 'normal',\n}: TextStyle): string {\n  const _fontSize = typeof fontSize === 'string' ? fontSize : `${fontSize}px`\n  return `${fontStyle} ${fontWeight} ${_fontSize} ${fontFamily}`\n}\n\n/**\n * 计算最小值\n * @param numbers\n */\nexport function calcMin(numbers: number[]) {\n  return numbers.reduce((a, b) => {\n    return a < b ? a : b\n  })\n}\n/**\n * 计算最大值\n * @param numbers\n */\nexport function calcMax(numbers: number[]) {\n  return numbers.reduce((a, b) => {\n    return a > b ? a : b\n  })\n}\n/**\n * 计算差异\n * @param numbers\n */\nexport function calcDiff(numbers: number[]) {\n  return calcMax(numbers) - calcMin(numbers)\n}\n\n/**\n * 确保输入值在 min 和 max 之间，若超出边界则返回边界\n * @param input\n * @param min\n * @param max\n */\nexport function ensureBetween(input: number, min: number = 0, max: number = 1) {\n  return input <= min ? min : input >= max ? max : input\n}\n\n/**\n * 创建代理\n * @param value\n * @param cb\n */\nexport function createProxy<T extends object>(value: T, cb?: (property: string, newValue: any) => void): T {\n  return new Proxy<T>(value, {\n    set: (target, property, newValue) => {\n      target[property as keyof T] = newValue\n      cb?.(property as string, newValue)\n      return true\n    },\n  })\n}\n\nexport enum ENV {\n  WX = 'WX',\n  WEB = 'WEB',\n  UNKNOWN = 'UNKNOWN',\n  UNI_APP = 'UNI_APP',\n}\n\nexport function getEnv() {\n  if (typeof uni !== 'undefined')\n    return ENV.UNI_APP\n  if (typeof wx !== 'undefined')\n    return ENV.WX\n  if (typeof window !== 'undefined' && typeof window.document !== 'undefined')\n    return ENV.WEB\n  return ENV.UNKNOWN\n}\n\n/**\n * Draws a rectangle with rounded corners compatible with different environments.\n *\n * @param {CanvasRenderingContext2D} ctx - The canvas rendering context.\n * @param {PointData} position - The position of the rectangle.\n * @param {PointData} size - The size of the rectangle.\n * @param {number} [rounded] - The radius of the rounded corners.\n *\n * @return {void}\n */\nexport function drawRectCompatible(\n  ctx: CanvasRenderingContext2D,\n  position: PointData,\n  size: PointData,\n  rounded?: number,\n) {\n  rounded = rounded ?? 0\n  rounded = Math.min(rounded, size.x / 2, size.y / 2)\n  ctx.beginPath()\n  if (rounded) {\n    if (getEnv() === ENV.WX) {\n      // 左上角到右上角\n      ctx.moveTo(position.x + rounded, position.y)\n      ctx.arcTo(position.x + size.x, position.y, position.x + size.x, position.y + rounded, rounded)\n      // 右上角到右下角\n      ctx.arcTo(position.x + size.x, position.y + size.y, position.x + size.x - rounded, position.y + size.y, rounded)\n      // 右下角到左下角\n      ctx.arcTo(position.x, position.y + size.y, position.x, position.y + size.y - rounded, rounded)\n      // 左下角到左上角\n      ctx.arcTo(position.x, position.y, position.x + rounded, position.y, rounded)\n      // 闭合路径\n      ctx.closePath()\n    }\n    else {\n      ctx.roundRect(position.x, position.y, size.x, size.y, rounded)\n    }\n  }\n  else {\n    ctx.rect(position.x, position.y, size.x, size.y)\n  }\n}\n","import EventEmitter from 'eventemitter3'\nimport type { Display } from './object/display'\nimport { ENV, formatWithPx, getEnv } from './utils'\n\nexport interface AppOptions {\n  /**\n   *  画布宽度\n   */\n  width?: number\n  /**\n   *  画布高度\n   */\n  height?: number\n  /**\n   *  是否开启dpr\n   */\n  dpr?: boolean | number\n  /**\n   *  `画布元素`或`画布id(微信小程序或者uni-app)`或者`document.querySelector可以接受的字符串`\n   */\n  canvas?: HTMLCanvasElement | string\n}\n\nexport class App extends EventEmitter<{\n  render: []\n  ready: []\n}> {\n  private ctx!: CanvasRenderingContext2D\n  private _ready = false\n  protected _env = getEnv()\n  canvas!: HTMLCanvasElement\n  ticker!: Ticker\n  dpr = 1\n  width = 0\n  height = 0\n  constructor(private options: AppOptions = {}) {\n    super()\n    this.validateAppOptions(options)\n    this.initDpr()\n    this.initTicker()\n    this.initCanvas()\n  }\n\n  onReady(fn: AnyFunction) {\n    if (this._ready) {\n      fn()\n    }\n    else {\n      this.once('ready', () => {\n        fn()\n      })\n    }\n  }\n\n  private validateAppOptions(appOptions: AppOptions) {\n    if (this._env === ENV.WX && !appOptions.canvas) {\n      console.error('当前为非document环境, 无法使用 document.createElement(\\'canvas\\'),\\n 请传入canvas元素或者canvasId')\n    }\n  }\n\n  private initDpr() {\n    const { dpr = true } = this.options\n    if (typeof dpr === 'boolean') {\n      this.dpr = window.devicePixelRatio ?? 1\n    }\n    else {\n      this.dpr = dpr\n    }\n  }\n\n  private initCanvas() {\n    const canvas = this.options.canvas\n    if (canvas) {\n      if (typeof canvas === 'string') {\n        if (this._env === ENV.WEB) {\n          this.canvas = document.querySelector(canvas) as HTMLCanvasElement\n        }\n        else {\n          let query: WechatMiniprogram.SelectorQuery | UniNamespace.SelectorQuery\n          if (this._env === ENV.WX) {\n            query = wx.createSelectorQuery()\n          }\n          else {\n            query = uni.createSelectorQuery()\n          }\n          query.select('#myCanvas')\n            .fields({ node: true, size: true }, undefined as any)\n            .exec((res) => {\n              const canvas = res[0].node as HTMLCanvasElement\n              this.canvas = canvas\n              this.initCanvasSize()\n            })\n        }\n      }\n      else {\n        this.canvas = canvas\n        this.initCanvasSize()\n      }\n    }\n    else {\n      this.canvas = document.createElement('canvas')!\n      this.initCanvasSize()\n    }\n  }\n\n  private initCanvasSize() {\n    const { width = 300, height = 150 } = this.options\n    if (!this.canvas)\n      return\n    if (this.canvas.style) {\n      this.canvas.style.width = formatWithPx(width)\n      this.canvas.style.height = formatWithPx(height)\n      this.canvas.width = width * this.dpr\n      this.canvas.height = height * this.dpr\n    }\n    else {\n      this.canvas.width = width * this.dpr\n      this.canvas.height = height * this.dpr\n    }\n    this.width = width\n    this.height = width\n    this.ctx = this.canvas.getContext('2d')!\n    this._ready = true\n    this.emit('ready')\n    this.ticker.init(this.canvas, true)\n  }\n\n  private initTicker() {\n    this.ticker = new Ticker()\n    this.ticker.add(this.update.bind(this))\n  }\n\n  private beforeRender() {\n    this.ctx.save()\n  }\n\n  private afterRender() {\n    this.ctx.restore()\n  }\n\n  children: Display[] = []\n\n  add(...objects: Display[]) {\n    for (let index = 0; index < objects.length; index++) {\n      const object = objects[index]\n      this.children.push(object)\n      object.onAdd(this)\n    }\n  }\n\n  remove(...objects: Display[]) {\n    for (let index = 0; index < objects.length; index++) {\n      const object = objects[index]\n      const delIndex = this.children.indexOf(object)\n      if (delIndex !== -1) {\n        object.onRemove()\n        this.children.splice(delIndex, 1)\n      }\n    }\n  }\n\n  private update() {\n    if (!this.children.length) {\n      return\n    }\n    const isDirty = !![...this.children.filter(e => e.dirty)].length\n    const _renderIds = this.children.every(e => e._renderId > 0)\n    if (_renderIds && this.children.length) {\n      this.emit('render')\n    }\n    if (!isDirty)\n      return\n    this.ctx.clearRect(\n      -this.canvas.width,\n      -this.canvas.height,\n      this.canvas.width * 2,\n      this.canvas.height * 2,\n    )\n\n    // this.debug()\n    const shouldRender = [...this.children].filter(e => e.shouldUpdate)\n    while (shouldRender.length) {\n      this.beforeRender()\n      const child = shouldRender.shift()!\n      child.render(this.ctx)\n      child.dirty = false\n      child._renderId++\n      this.afterRender()\n    }\n  }\n\n  toDataURL(type?: string, quality?: any) {\n    return this.canvas.toDataURL(type, quality)\n  }\n\n  toDataURLAsync(type?: string, quality?: any) {\n    return new Promise<string>((resolve) => {\n      this.once('render', () => {\n        resolve(this.toDataURL(type, quality))\n      })\n    })\n  }\n\n  wrapperRender(fn: (ctx: CanvasRenderingContext2D) => any) {\n    this.beforeRender()\n    fn(this.ctx)\n    this.afterRender()\n  }\n}\n\nclass Ticker {\n  requestAnimationFrame?: typeof requestAnimationFrame\n  cancelAnimationFrame?: typeof cancelAnimationFrame\n  myReq: number = 0\n  private isRunning: boolean = false\n  handler: ((time: number) => void)[] = []\n  protected _env = getEnv()\n  constructor(protected autoStart: boolean = true) {\n\n  }\n\n  init(canvas: HTMLCanvasElement, autoStart: boolean) {\n    if (this._env === ENV.WX) {\n      this.requestAnimationFrame = (canvas as any).requestAnimationFrame.bind(this)\n      this.cancelAnimationFrame = (canvas as any).requestAnimationFrame.bind(this)\n    }\n    else {\n      this.requestAnimationFrame = requestAnimationFrame.bind(this)\n      this.cancelAnimationFrame = cancelAnimationFrame.bind(this)\n    }\n    if (autoStart) {\n      this.start()\n    }\n  }\n\n  add(fn: (time: number) => void) {\n    this.handler.push(fn)\n  }\n\n  removeAll() {\n    this.handler = []\n  }\n\n  remove(fn: (time: number) => void) {\n    const index = this.handler.indexOf(fn)\n    if (index !== -1) {\n      this.handler.splice(index, 1)\n    }\n  }\n\n  start() {\n    this.isRunning = true\n    this.myReq = this.requestAnimationFrame!(this.update.bind(this))\n  }\n\n  stop() {\n    if (this.isRunning && this.myReq) {\n      this.cancelAnimationFrame?.(this.myReq)\n      this.isRunning = false\n    }\n  }\n\n  update() {\n    if (!this.isRunning)\n      return\n    this.myReq = this.requestAnimationFrame!(this.update.bind(this))\n    this.handler.forEach(fn => fn(performance.now()))\n  }\n}\n","import type { PointData } from './PointData'\nimport type { PointLike } from './PointLike'\n\nexport interface Observer<T> {\n  _onUpdate: (point?: T) => void\n}\n\nexport class ObservablePoint implements PointLike {\n  public _x: number\n  public _y: number\n  private readonly _observer: Observer<ObservablePoint> | null\n  constructor(observer: Observer<ObservablePoint> | null, x?: number, y?: number) {\n    this._x = x || 0\n    this._y = y || 0\n    this._observer = observer\n  }\n\n  public clone(observer?: Observer<ObservablePoint>): ObservablePoint {\n    return new ObservablePoint(observer ?? this._observer, this._x, this._y)\n  }\n\n  public set(x = 0, y = x): this {\n    if (this._x !== x || this._y !== y) {\n      this._x = x\n      this._y = y\n      this._observer?._onUpdate(this)\n    }\n    return this\n  }\n\n  public copyFrom(p: PointData): this {\n    if (this._x !== p.x || this._y !== p.y) {\n      this._x = p.x\n      this._y = p.y\n      this._observer?._onUpdate(this)\n    }\n    return this\n  }\n\n  public copyTo<T extends PointLike>(p: T): T {\n    p.set(this._x, this._y)\n    return p\n  }\n\n  public equals(p: PointData): boolean {\n    return (p.x === this._x) && (p.y === this._y)\n  }\n\n  get x(): number {\n    return this._x\n  }\n\n  set x(value: number) {\n    if (this._x !== value) {\n      this._x = value\n      this._observer?._onUpdate(this)\n    }\n  }\n\n  get y(): number {\n    return this._y\n  }\n\n  set y(value: number) {\n    if (this._y !== value) {\n      this._y = value\n      this._observer?._onUpdate(this)\n    }\n  }\n\n  [Symbol.iterator]() {\n    let step = 0\n    const properties = [this.x, this.y]\n\n    return {\n      next: () => {\n        if (step < properties.length) {\n          return { value: properties[step++], done: false }\n        }\n        else {\n          return { done: true, value: undefined }\n        }\n      },\n    }\n  }\n}\n","import EventEmitter from 'eventemitter3'\nimport type { App } from '../app'\nimport type { Observer } from '../coordinate/ObservablePoint'\nimport { ObservablePoint } from '../coordinate/ObservablePoint'\nimport type { PointData } from '../coordinate/PointData'\nimport { createProxy, ensureBetween, getEnv } from '../utils'\n\ninterface ShadowType {\n  /**\n   * [CanvasRenderingContext2D.shadowOffsetX](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowOffsetX)\n   */\n  x?: number\n  /**\n   * [CanvasRenderingContext2D.shadowOffsetY](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowOffsetY)\n   */\n  y?: number\n  /**\n   * [CanvasRenderingContext2D.shadowBlur](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowBlur)\n   */\n  blur?: number\n  /**\n   * [CanvasRenderingContext2D.shadowColor](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowColor)\n   */\n  color?: string\n}\n/**\n * [单位矩阵变化](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setTransform)\n */\nexport interface DisplayOptions {\n  /**\n   * 元素是否可见\n   */\n  visible?: boolean\n  /**\n   * 元素位置x\n   */\n  x?: number\n  /**\n   * 元素位置y\n   */\n  y?: number\n  /**\n   * 元素位置\n   */\n  position?: PointData\n  /**\n   * 旋转角度(弧度)\n   */\n  rotation?: number\n  /**\n   * 缩放比例\n   */\n  scale?: PointData | number\n  /**\n   * 单位矩阵变化中心，默认是[0,0]表示左上角，[1,1]表示右下角，[0.5,0.5]表示中心\n   *\n   * 此属性可以很好的控制元素的锚点，不用计算相对位置\n   *\n   * 例如：一个500x500的画布上需要绘制一个上下居中的图片\n   *\n   * ``` ts\n   * const text = new Picture('demo.png',{\n   *  anchor: 0.5\n   * })\n   * ```\n   *\n   * ```\n   * > [!IMPORTANT]\n   * > Crucial information necessary for users to succeed.\n   * ```\n   */\n  anchor?: PointData | number\n  /**\n   * 同 anchor，但是具体坐标，建议使用 anchor\n   */\n  pivot?: PointData | number\n  /**\n   * 元素倾斜\n   */\n  skew?: PointData\n  /**\n   * 透明度\n   */\n  alpha?: number\n  /**\n   * 阴影\n   */\n  shadow?: ShadowType\n}\n\n/**\n * 默认值\n */\nconst defaultSkew = new ObservablePoint(null)\nconst defaultPivot = new ObservablePoint(null)\nconst defaultAnchor = new ObservablePoint(null)\nconst defaultScale = new ObservablePoint(null, 1, 1)\n\nexport abstract class Display extends EventEmitter<{\n  ready: []\n}> implements Observer<ObservablePoint> {\n  protected _env = getEnv()\n  constructor(options: DisplayOptions = {}) {\n    super()\n    this.visible = options.visible ?? true\n    if (options.position) {\n      this.position = options.position\n    }\n    else {\n      this.x = options.x ?? 0\n      this.y = options.y ?? 0\n    }\n    this.scale = options.scale ?? 1\n    this.skew = options.skew ?? { x: 0, y: 0 }\n    this.pivot = options.pivot ?? 0\n    this.shadow = options.shadow ?? this._shadow\n    this.rotation = options.rotation ?? 0\n    this.anchor = options.anchor ?? 0\n    this.alpha = options.alpha ?? 1\n  }\n\n  /**\n   * 更新优化\n   */\n\n  private get __shouldUpdate() {\n    return !(!this.visible\n      || this.scale.x === 0\n      || this.scale.y === 0\n      || this.alpha === 0)\n  }\n  /**\n   * 更新优化\n   * 如果_shouldRender为true 则渲染\n   * 否则跳过渲染\n   */\n  abstract get _shouldUpdate(): boolean\n\n  get shouldUpdate() {\n    return this.__shouldUpdate && this._shouldUpdate\n  }\n\n  protected _dirty = false\n  set dirty(value) {\n    if (this._dirty === value)\n      return\n    this._dirty = value\n  }\n\n  get dirty() {\n    return this._dirty\n  }\n\n  set x(value) {\n    if (this.x !== value) {\n      this.position.x = value\n    }\n  }\n\n  get x() {\n    return this.position.x\n  }\n\n  set y(value) {\n    if (this.y !== value) {\n      this.position.y = value\n    }\n  }\n\n  get y() {\n    return this.position.y\n  }\n\n  private _position = new ObservablePoint(this, 0, 0)\n\n  set position(value: PointData) {\n    if (this.position !== value) {\n      this._position.copyFrom(value)\n    }\n  }\n\n  get position(): ObservablePoint {\n    return this._position\n  }\n\n  private _scale: ObservablePoint = defaultScale\n\n  set scale(value: PointData | number) {\n    if (this._scale === defaultScale) {\n      this._scale = new ObservablePoint(this, 1, 1)\n    }\n    if (typeof value === 'number') {\n      this._scale.set(value)\n    }\n    else {\n      this._scale.copyFrom(value)\n    }\n  }\n\n  get scale(): ObservablePoint {\n    if (this._scale === defaultScale) {\n      this._scale = new ObservablePoint(this, 1, 1)\n    }\n    return this._scale\n  }\n\n  private _skew: ObservablePoint = defaultSkew\n\n  set skew(value: PointData) {\n    if (this._skew === defaultSkew) {\n      this._skew = new ObservablePoint(this)\n    }\n    this._skew.copyFrom(value)\n  }\n\n  get skew(): ObservablePoint {\n    if (this._skew === defaultSkew) {\n      this._skew = new ObservablePoint(this, 0, 0)\n    }\n    return this._skew\n  }\n\n  private _alpha = 1\n\n  set alpha(value) {\n    if (this.alpha !== value) {\n      this._alpha = value\n      this._onUpdate()\n    }\n  }\n\n  get alpha() {\n    return this._alpha\n  }\n\n  private _rotation = 0\n\n  set rotation(value) {\n    if (this.rotation !== value) {\n      this._rotation = value\n      this._onUpdate()\n    }\n  }\n\n  get rotation() {\n    return this._rotation\n  }\n\n  private _anchor = defaultAnchor\n\n  set anchor(value: PointData | number) {\n    if (this._anchor === defaultAnchor) {\n      this._anchor = new ObservablePoint(this, 0, 0)\n    }\n    if (typeof value === 'number') {\n      this._anchor.set(value)\n    }\n    else {\n      this._anchor.copyFrom(value)\n    }\n  }\n\n  get anchor(): ObservablePoint {\n    if (this._anchor === defaultAnchor) {\n      this._anchor = new ObservablePoint(this)\n    }\n    return this._anchor\n  }\n\n  private _pivot: ObservablePoint = defaultPivot\n\n  set pivot(value: PointData | number) {\n    if (this._pivot === defaultPivot) {\n      this._pivot = new ObservablePoint(this, 0, 0)\n    }\n    if (typeof value === 'number') {\n      this._pivot.set(value)\n    }\n    else {\n      this._pivot.copyFrom(value)\n    }\n  }\n\n  get pivot(): ObservablePoint {\n    if (this._pivot === defaultPivot) {\n      this._pivot = new ObservablePoint(this)\n    }\n    return this._pivot\n  }\n\n  private _shadow: ShadowType = { x: 0, y: 0 }\n\n  set shadow(value) {\n    if (value === this._shadow)\n      return\n    if (value) {\n      this._shadow = createProxy(value, () => {\n        this._onUpdate()\n      })\n      this._onUpdate()\n    }\n  }\n\n  get shadow(): ShadowType {\n    return this._shadow\n  }\n\n  _onUpdate(_point?: ObservablePoint | undefined) {\n    this.dirty = true\n  }\n\n  _app: App | null = null\n  // abstract style: BaseStyle\n\n  private _visible = true\n\n  get visible() {\n    return this._visible\n  }\n\n  set visible(value) {\n    this._visible = value\n    this._onUpdate()\n  }\n\n  protected _shouldUpdateBounds = true\n\n  protected shouldUpdateBounds() {\n    this._shouldUpdateBounds = true\n  }\n\n  private _baseRender(ctx: CanvasRenderingContext2D) {\n    if ((this.shadow?.x || this.shadow?.y)\n      && (this.shadow?.blur || this.shadow?.color)) {\n      if (this.shadow.color) {\n        ctx.shadowColor = this.shadow.color\n      }\n      if (this.shadow.blur) {\n        ctx.shadowBlur = this.shadow.blur\n      }\n      if (this.shadow.x) {\n        ctx.shadowOffsetX = this.shadow.x\n      }\n      if (this.shadow.y) {\n        ctx.shadowOffsetY = this.shadow.y\n      }\n    }\n  }\n\n  public render(ctx: CanvasRenderingContext2D) {\n    if (this._shouldUpdateBounds) {\n      this.updateTransformBounds()\n      this._shouldUpdateBounds = false\n    }\n    if (this.alpha !== 1) {\n      ctx.globalAlpha = this.alpha\n    }\n    const dpr = this._app?.dpr ?? 1\n    const scaleX = this.scale.x * dpr\n    const scaleY = this.scale.y * dpr\n    const skewX = this.skew.x\n    const skewY = this.skew.y\n    const positionX = this.position.x * dpr\n    const positionY = this.position.y * dpr\n    const pivotX = this.pivot.x\n    const pivotY = this.pivot.y\n    const rotation = this.rotation\n    // Calculate rotation matrix components\n    const cos = Math.cos(rotation)\n    const sin = Math.sin(rotation)\n\n    const anchorX = ensureBetween(this.anchor.x, 0, 1)\n    const anchorY = ensureBetween(this.anchor.y, 0, 1)\n\n    const originX = this.transformWidth * anchorX\n    const originY = this.transformHeight * anchorY\n\n    const dx = positionX - (pivotX + originX) * cos * scaleX + (pivotY + originY) * sin * scaleY\n    const dy = positionY - (pivotX + originX) * sin * scaleX - (pivotY + originY) * cos * scaleY\n\n    ctx.setTransform(\n      scaleX * cos + skewY * -sin, // a\n      scaleX * sin + skewY * cos, // b\n      skewX * cos + scaleY * -sin, // c\n      skewX * sin + scaleY * cos, // d\n      dx, // e\n      dy, // f\n    )\n    const _position = this.position.clone()\n    this.position.set(0)\n    this._baseRender(ctx)\n    this._render(ctx)\n    this.position = _position\n    ctx.resetTransform()\n  }\n\n  _renderId = 0\n  protected abstract _render(ctx: CanvasRenderingContext2D): void\n\n  /**\n   * 同于形变转换的宽度\n   */\n  protected abstract transformWidth: number\n  /**\n   * 同于形变转换的高度\n   */\n  protected abstract transformHeight: number\n\n  /**\n   * 同于形变转换的边界\n   */\n  protected abstract updateTransformBounds(): void\n\n  get height() {\n    return this.transformHeight\n  }\n\n  get width() {\n    return this.transformWidth\n  }\n\n  onAdd(_app: App) {\n    this._app = _app\n    this._onUpdate()\n  }\n\n  onRemove() {\n    this._app = null\n    this._onUpdate()\n  }\n\n  addTo(app: App) {\n    app.add(this)\n    return this\n  }\n\n  destroy() {\n    this.removeAllListeners()\n  }\n}\n","import type { Properties } from 'csstype'\nimport type { PointData } from '../coordinate/PointData'\nimport { ObservablePoint } from '../coordinate/ObservablePoint'\nimport { ENV, calcDiff, drawRectCompatible } from '../utils'\nimport type { App } from '../app'\nimport type { DisplayOptions } from './display'\nimport { Display } from './display'\n\nexport interface PictureOptions extends DisplayOptions {\n  /**\n   * 图片的宽高\n   */\n  size?: PointData\n  /**\n   * 图片切片的开始坐标\n   */\n  slice?: PointData\n  /**\n   * 图片切片的宽高\n   */\n  sliceSize?: PointData\n  /**\n   * 图片的缩放模式\n   */\n  objectFit?: Properties['objectFit']\n  /**\n   * 圆角\n   */\n  rounded?: number\n}\n\nexport class Picture extends Display {\n  private src = ''\n  constructor(maybeImage: HTMLImageElement | string, private options?: PictureOptions) {\n    super(options)\n    if (typeof maybeImage == 'string') {\n      if (this._env === ENV.WX) {\n        this.src = maybeImage\n      }\n      else {\n        this.image = document.createElement('img')\n        this.image.src = maybeImage\n        this.initImageEvents()\n      }\n      this.rounded = this.options?.rounded ?? 0\n    }\n    else {\n      this.image = maybeImage\n      this.initImageEvents()\n    }\n  }\n\n  onAdd(_app: App) {\n    super.onAdd(_app)\n    if (this._env !== ENV.WEB) {\n      _app.onReady(this.createImage.bind(this))\n    }\n  }\n\n  createImage() {\n    if (!this._app)\n      return\n    this.image = (this._app?.canvas as any).createImage()\n    this.image!.src = this.src\n    this.initImageEvents()\n  }\n\n  initImageEvents() {\n    if (!this.image)\n      return\n    if (this.image.complete) {\n      this._onImageComplete()\n    }\n    else {\n      this.image.addEventListener('load', () => {\n        this._onImageComplete()\n      })\n    }\n  }\n\n  private image?: HTMLImageElement\n\n  private _size = new ObservablePoint(this, 0, 0)\n\n  private _imageSize = new ObservablePoint(this, 0, 0)\n\n  set size(value: PointData) {\n    if (this.size !== value) {\n      this._size.copyFrom(value)\n      this.shouldUpdateBounds()\n    }\n  }\n\n  get size(): ObservablePoint {\n    return this._size\n  }\n\n  private _slice = new ObservablePoint(this)\n\n  set slice(value: PointData) {\n    if (this.slice !== value) {\n      this._slice.copyFrom(value)\n      this.shouldUpdateBounds()\n    }\n  }\n\n  get slice(): ObservablePoint {\n    return this._slice\n  }\n\n  private _sliceSize = new ObservablePoint(this)\n\n  set sliceSize(value: PointData) {\n    if (this.sliceSize !== value) {\n      this._sliceSize.copyFrom(value)\n      this._onUpdate()\n      this.shouldUpdateBounds()\n    }\n  }\n\n  get sliceSize(): ObservablePoint {\n    return this._sliceSize\n  }\n\n  private _objectFit: Properties['objectFit'] = 'none'\n\n  set objectFit(value) {\n    if (this.objectFit !== value) {\n      this._objectFit = value\n      this.shouldUpdateBounds()\n      this._onUpdate()\n    }\n  }\n\n  get objectFit() {\n    return this._objectFit\n  }\n\n  private _rounded = 0\n\n  set rounded(value) {\n    value = value <= 0 ? 0 : value\n    if (this.rounded !== value) {\n      this._rounded = value\n      this._onUpdate()\n    }\n  }\n\n  _onUpdate(_point?: ObservablePoint | undefined) {\n    if (this._complete)\n      super._onUpdate(_point)\n  }\n\n  get rounded() {\n    return this._rounded\n  }\n\n  private _complete = false\n\n  private _onImageComplete() {\n    if (!this.image)\n      return\n    this._imageSize.set(\n      this.image.width,\n      this.image.height,\n    )\n\n    this.size = this.options?.size ?? {\n      x: this.image.width,\n      y: this.image.height,\n    }\n\n    this.slice = this.options?.slice ?? this.slice\n\n    this.sliceSize = this.options?.sliceSize ?? {\n      x: this.size.x,\n      y: this.size.y,\n    }\n\n    this.objectFit = this.options?.objectFit ?? this.objectFit\n\n    this.rounded = this.options?.rounded ?? this.rounded\n    this._complete = true\n    this.emit('ready')\n    this._onUpdate()\n    this.shouldUpdateBounds()\n  }\n\n  get _shouldUpdate(): boolean {\n    return true\n  }\n\n  private get _isSlice() {\n    return (!!this.slice.x || !!this.slice.y) || !this.sliceSize.equals(this.size)\n  }\n\n  private renderRoundedClip(ctx: CanvasRenderingContext2D, position: PointData, size: PointData) {\n    drawRectCompatible(ctx, position, size, this.rounded)\n    ctx.clip()\n  }\n\n  protected _render(ctx: CanvasRenderingContext2D): void {\n    if (!this.image || !this._complete) {\n      return\n    }\n    if (!this._isSlice) {\n      const _size = this.size.clone()\n      const _position = this.position.clone()\n      const scaleDiff = _size.x / this._imageSize.x\n      const diffSize = calcDiff([this._imageSize.x, this._imageSize.y])\n      const diff = diffSize * scaleDiff\n      const slim = this._imageSize.x < this._imageSize.y\n      const fat = this._imageSize.x > this._imageSize.y\n      if (slim || fat) {\n        switch (this.objectFit) {\n          case 'contain':\n            if (slim) {\n              this.position.set(this.position.x - diff / 2, this.position.y)\n              this.size.set(this.size.x - diff, this.size.y)\n            }\n            else {\n              this.position.set(this.position.x, this.position.y + diff / 2)\n              this.size.set(this.size.x, this.size.y - diff)\n            }\n            // ctx.beginPath()\n            // if (this.rounded) {\n            //   ctx.roundRect(this.x, this.y, this.size.x, this.size.y, this.rounded)\n            // }\n            // else {\n            //   ctx.rect(this.x, this.y, this.size.x, this.size.y)\n            // }\n            // ctx.clip()\n            this.renderRoundedClip(ctx, this.position, this.size)\n            break\n          case 'cover':\n            if (slim) {\n              this.position.set(this.position.x + diff / 2, this.position.y)\n              this.size.set(this.size.x + diff, this.size.y)\n            }\n            else {\n              this.position.set(this.position.x - diff / 2, this.position.y)\n              this.size.set(this.size.x + diff, this.size.y)\n            }\n            // ctx.beginPath()\n            // if (this.rounded) {\n            //   ctx.roundRect(_position.x, _position.y, _size.x, _size.y, this.rounded)\n            // }\n            // else {\n            //   ctx.rect(_position.x, _position.y, _size.x, _size.y)\n            // }\n            // ctx.clip()\n            this.renderRoundedClip(ctx, _position, _size)\n            break\n          default:\n            this.renderRoundedClip(ctx, this.position, this.size)\n        }\n      }\n      ctx.drawImage(\n        this.image,\n        this.position.x,\n        this.position.y,\n        this.size.x,\n        this.size.y,\n      )\n      this.position = _position\n      this.size = _size\n    }\n    else {\n      const args = [\n        this.image,\n        this.slice.x,\n        this.slice.y,\n        this.sliceSize.x,\n        this.sliceSize.y,\n        this.x,\n        this.y,\n        this.size.x,\n        this.size.y,\n      ] as const\n\n      // ctx.beginPath()\n      // console.log(this.rounded)\n      // if (this.rounded) {\n      //   ctx.roundRect(this.x, this.y, this.size.x, this.size.y, this.rounded)\n      // }\n      // else {\n      //   ctx.rect(this.x, this.y, this.size.x, this.size.y)\n      // }\n      // ctx.clip()\n      this.renderRoundedClip(ctx, this.position, this.size)\n      ctx.drawImage(...args)\n    }\n  }\n\n  protected transformWidth: number = 0\n  protected transformHeight: number = 0\n  protected updateTransformBounds(): void {\n    this.transformWidth = this.size.x\n    this.transformHeight = this.size.y\n  }\n}\n","import type { IAbstractStyle, InputColor, StrokeInput } from '../style/abstract-style'\n// import type { FunctionKeys } from '../types'\nimport { ENV, calcDiff, createProxy, drawRectCompatible } from '../utils'\nimport type { DisplayOptions } from './display'\nimport { Display } from './display'\n\n// type CanvasRenderingContext2DMethods = FunctionKeys<CanvasRenderingContext2D>\ninterface PathData<T extends keyof CanvasRenderingContext2D> {\n  action: T\n  args: any[]\n}\n\ntype Methods =\n  | 'beginPath'\n  | 'closePath'\n  | 'moveTo'\n  | 'fill'\n  | 'stroke'\n  | 'lineTo' //\n  | 'rect' //\n  | 'roundRect' //\n  | 'fillRect' //\n  | 'strokeRect'\n  | 'arc' //\n  | 'arcTo' //\n  | 'bezierCurveTo' //\n  | 'ellipse'\n  | 'lineCap'\n  | 'lineJoin'\n\ntype PathInstruction = PathData<Methods>\ninterface _ShapeOptions extends DisplayOptions {\n\n}\n\ninterface IShape {\n  beginPath: () => Shape\n  closePath: () => Shape\n  moveTo: (...args: Parameters<CanvasRenderingContext2D['moveTo']>) => Shape\n  lineTo: (...args: Parameters<CanvasRenderingContext2D['lineTo']>) => Shape\n  stroke: (value?: StrokeInput | InputColor) => Shape\n  fill: (color?: InputColor) => Shape\n  rect: (...args: Parameters<CanvasRenderingContext2D['rect']>) => Shape\n  roundRect: (...args: Parameters<CanvasRenderingContext2D['roundRect']>) => Shape\n  arc: (...args: Parameters<CanvasRenderingContext2D['arc']>) => Shape\n  arcTo: (...args: Parameters<CanvasRenderingContext2D['arcTo']>) => Shape\n  bezierCurveTo: (...args: Parameters<CanvasRenderingContext2D['bezierCurveTo']>) => Shape\n  ellipse: (...args: Parameters<CanvasRenderingContext2D['ellipse']>) => Shape\n  fillRect: (...args: Parameters<CanvasRect['fillRect']>) => Shape\n  strokeRect: (...args: Parameters<CanvasRect['strokeRect']>) => Shape\n  lineCap: (...args: [CanvasRenderingContext2D['lineCap']]) => void\n  lineJoin: (...args: [CanvasRenderingContext2D['lineJoin']]) => void\n}\n\nexport type ShapeOptions = Partial<_ShapeOptions>\n\nexport class Shape extends Display implements IShape {\n  constructor(options: ShapeOptions = {}) {\n    super(options)\n    this.emit('ready')\n    this._onUpdate()\n  }\n\n  private addPath(...items: PathInstruction[]) {\n    this.pathInstruction.push(...items)\n    this.shouldUpdateBounds()\n  }\n\n  beginPath(): Shape {\n    this.addPath({\n      action: 'beginPath',\n      args: [],\n    })\n    return this\n  }\n\n  closePath() {\n    this.addPath({\n      action: 'closePath',\n      args: [],\n    })\n    return this\n  }\n\n  lineCap(cap: 'butt' | 'round' | 'square') {\n    this.addPath({\n      action: 'lineCap',\n      args: [cap],\n    })\n    return this\n  }\n\n  lineJoin(join: 'bevel' | 'miter' | 'round') {\n    this.addPath({\n      action: 'lineJoin',\n      args: [join],\n    })\n    return this\n  }\n\n  moveTo(x: number, y: number) {\n    this.addPath({\n      action: 'moveTo',\n      args: [x, y],\n    })\n    return this\n  }\n\n  lineTo(x: number, y: number) {\n    this.addPath({\n      action: 'lineTo',\n      args: [x, y],\n    })\n    return this\n  }\n\n  rect(x: number, y: number, w: number, h: number) {\n    this.addPath({\n      action: 'rect',\n      args: [x, y, w, h],\n    })\n    return this\n  }\n\n  roundRect(\n    x: number,\n    y: number,\n    w: number,\n    h: number,\n    radii?: number | DOMPointInit | Iterable<number | DOMPointInit>,\n  ) {\n    this.addPath({\n      action: 'roundRect',\n      args: [x, y, w, h, radii],\n    })\n    return this\n  }\n\n  arc(\n    x: number,\n    y: number,\n    radius: number,\n    startAngle: number = 0,\n    endAngle: number = 2 * Math.PI,\n    counterclockwise?: boolean,\n  ) {\n    this.addPath({\n      action: 'arc',\n      args: [x, y, radius, startAngle, endAngle, counterclockwise],\n    })\n    return this\n  }\n\n  arcTo(x1: number, y1: number, x2: number, y2: number, radius: number) {\n    this.addPath({\n      action: 'arcTo',\n      args: [x1, y1, x2, y2, radius],\n    })\n    return this\n  }\n\n  bezierCurveTo(\n    cp1x: number,\n    cp1y: number,\n    cp2x: number,\n    cp2y: number,\n    x: number,\n    y: number,\n  ) {\n    this.addPath({\n      action: 'bezierCurveTo',\n      args: [cp1x, cp1y, cp2x, cp2y, x, y],\n    })\n    return this\n  }\n\n  ellipse(\n    x: number,\n    y: number,\n    radiusX: number,\n    radiusY: number,\n    rotation: number,\n    startAngle: number,\n    endAngle: number,\n    counterclockwise?: boolean,\n  ) {\n    this.addPath({\n      action: 'ellipse',\n      args: [x, y, radiusX, radiusY, rotation, startAngle, endAngle, counterclockwise],\n    })\n    return this\n  }\n\n  fillRect(x: number, y: number, w: number, h: number) {\n    this.addPath({\n      action: 'fillRect',\n      args: [x, y, w, h],\n    })\n    return this\n  }\n\n  strokeRect(x: number, y: number, w: number, h: number) {\n    this.addPath({\n      action: 'strokeRect',\n      args: [x, y, w, h],\n    })\n    return this\n  }\n\n  private pathInstruction: PathInstruction[] = []\n  get _shouldUpdate(): boolean {\n    const actions = this.pathInstruction.map(item => item.action)\n    if (actions.includes('fill')\n      || actions.includes('stroke')) {\n      return true\n    }\n    return false\n  }\n\n  protected _render(ctx: CanvasRenderingContext2D): void {\n    if (!ctx) {\n      throw new Error('CanvasRenderingContext2D is null or undefined')\n    }\n    for (let index = 0; index < this.pathInstruction.length; index++) {\n      const { action, args } = this.pathInstruction[index]\n      if (action === 'fill') {\n        if (args[0]) {\n          ctx.fillStyle = args[0]\n        }\n        else if (this.fillStyle) {\n          ctx.fillStyle = this.fillStyle\n        }\n        ctx.fill()\n      }\n      else if (action === 'stroke') {\n        if (args[0]) {\n          const strokeInput = args[0] as StrokeInput | InputColor\n          if (typeof strokeInput === 'string'\n            || (typeof CanvasGradient !== 'undefined' && strokeInput instanceof CanvasGradient)\n            || (typeof CanvasPattern !== 'undefined' && strokeInput instanceof CanvasPattern)\n          ) {\n            ctx.strokeStyle = strokeInput\n            ctx.lineWidth = this.strokeStyle.width ?? 1\n          }\n          else {\n            const _strokeInput = strokeInput as StrokeInput\n            const color = _strokeInput.color ?? this.strokeStyle.color\n            if (color)\n              ctx.strokeStyle = color\n\n            const width = _strokeInput.width ?? this.strokeStyle.width\n\n            if (width)\n              ctx.lineWidth = width\n\n            if (_strokeInput.dash) {\n              ctx.setLineDash(_strokeInput.dash)\n            }\n            else {\n              ctx.setLineDash([])\n            }\n          }\n        }\n        else {\n          if (this.strokeStyle.color)\n            ctx.strokeStyle = this.strokeStyle.color\n          if (this.strokeStyle.width)\n            ctx.lineWidth = this.strokeStyle.width\n          if (this.strokeStyle.dash) {\n            ctx.setLineDash(this.strokeStyle.dash)\n          }\n          else {\n            ctx.setLineDash([])\n          }\n        }\n        ctx.stroke()\n      }\n      else if (['lineCap', 'lineJoin'].includes(action)) {\n        ctx[action] = args[0]\n      }\n      else if (action === 'roundRect' && this._env === ENV.WX) {\n        drawRectCompatible(ctx, { x: args[0], y: args[1] }, { x: args[2], y: args[3] }, args[4])\n      }\n      else {\n        if (!(action in ctx)) {\n          throw new Error(`CanvasRenderingContext2D has no method ${action}`)\n        }\n        else {\n          ;(ctx[action] as (...args: any[]) => void)(...args)\n        }\n      }\n    }\n  }\n\n  private _strokeStyle: StrokeInput = {}\n\n  set strokeStyle(value: StrokeInput | InputColor) {\n    if (value === this._strokeStyle)\n      return\n    if (\n      typeof value === 'string'\n      || (typeof CanvasGradient !== 'undefined' && value instanceof CanvasGradient)\n      || (typeof CanvasPattern !== 'undefined' && value instanceof CanvasPattern)\n    ) {\n      this._strokeStyle = createProxy({\n        ...this._strokeStyle,\n        color: value,\n      }, () => {\n        this._onUpdate()\n      })\n    }\n    else {\n      this._strokeStyle = createProxy(value as StrokeInput, () => {\n        this._onUpdate()\n      })\n      this._onUpdate()\n    }\n  }\n\n  get strokeStyle(): StrokeInput {\n    return this._strokeStyle\n  }\n\n  protected transformWidth = 0\n  protected transformHeight = 0\n  protected updateTransformBounds(): void {\n    // 所有坐标的最大值放进来\n    const allX: number[] = []\n    const allY: number[] = []\n    for (let index = 0; index < this.pathInstruction.length; index++) {\n      const { action, args } = this.pathInstruction[index]\n      switch (action) {\n        case 'lineTo':\n          allX.push(args[0])\n          allY.push(args[1])\n          break\n        case 'fillRect':\n        case 'strokeRect':\n        case 'roundRect':\n        case 'rect':{\n          let strokeWeight = 0\n          if (action === 'strokeRect') {\n            strokeWeight = this.strokeStyle.width ?? 1\n          }\n          allX.push(args[0])\n          allY.push(args[1])\n\n          allX.push(args[0] + args[2] + strokeWeight)\n          allY.push(args[1] + args[3] + strokeWeight)\n          break\n        }\n        case 'arc':\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[2])\n          break\n        case 'arcTo':\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[2])\n          break\n        case 'bezierCurveTo':\n          allX.push(args[2] + args[4])\n          allY.push(args[3] + args[5])\n          break\n        case 'ellipse':\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[3])\n      }\n    }\n    this.transformWidth = calcDiff(allX)\n    this.transformHeight = calcDiff(allY)\n  }\n\n  private _fillStyle: InputColor | null = null\n\n  set fillStyle(value) {\n    this._fillStyle = value\n    this._onUpdate()\n  }\n\n  get fillStyle() {\n    return this._fillStyle\n  }\n\n  fill(color?: IAbstractStyle['fill']) {\n    if (color) {\n      this.addPath({\n        action: 'fill',\n        args: [color],\n      })\n    }\n    return this\n  }\n\n  stroke(value?: StrokeInput | InputColor) {\n    this.addPath({\n      action: 'stroke',\n      args: value ? [value] : [],\n    })\n    return this\n  }\n\n  private _filter = 'none'\n\n  set filter(value) {\n    this._filter = value\n    this._onUpdate()\n  }\n\n  get filter() {\n    return this._filter\n  }\n}\n","import EventEmitter from 'eventemitter3'\nimport { createProxy } from '../utils'\n\nexport type InputColor = CanvasRenderingContext2D['strokeStyle']\nexport type LineDash = Iterable<number>\nexport interface StrokeInput {\n  /**\n   * 颜色\n   */\n  color?: InputColor\n  /**\n   * 宽度 同 [lineWidth](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/lineWidth)\n   */\n  width?: number\n  /**\n   * [CanvasRenderingContext2D.lineDashOffset](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/lineDashOffset)\n   */\n  dash?: LineDash\n}\n/**\n * 抽象样式\n */\nexport interface IAbstractStyle {\n  /**\n   * 填充颜色\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/fillStyle)\n   */\n  fill: CanvasRenderingContext2D['fillStyle'] | null\n  /**\n   * 描边颜色 当仅仅指定stroke 而未指定 fill 时 只会绘制镂空文字\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/strokeStyle)\n   */\n  stroke: StrokeInput\n  /**\n   * [CanvasRenderingContext2D.filter](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/filter)\n   */\n  filter: CanvasRenderingContext2D['filter']\n}\nexport abstract class AbstractStyle extends EventEmitter<{\n  update: []\n  updateBounds: []\n}> implements IAbstractStyle {\n  private _fill = '#000'\n\n  set fill(value) {\n    this._fill = value\n    this.update()\n  }\n\n  get fill() {\n    return this._fill\n  }\n\n  private _stroke: StrokeInput = {}\n\n  set stroke(value: StrokeInput | InputColor) {\n    if (value === this._stroke)\n      return\n    if (\n      typeof value === 'string'\n      || (typeof CanvasGradient !== 'undefined' && value instanceof CanvasGradient)\n      || (typeof CanvasPattern !== 'undefined' && value instanceof CanvasPattern)\n    ) {\n      this._stroke = createProxy({\n        ...this._stroke,\n        color: value,\n      }, () => {\n        this.update()\n      })\n    }\n    else {\n      this._stroke = createProxy(value as StrokeInput, () => {\n        this.update()\n      })\n      this.update()\n    }\n  }\n\n  get stroke(): StrokeInput {\n    return this._stroke\n  }\n\n  private _filter = 'none'\n\n  set filter(value) {\n    this._filter = value\n    this.update()\n  }\n\n  get filter() {\n    return this._filter\n  }\n\n  update() {\n    this.emit('update')\n  }\n\n  updateBounds() {\n    this.emit('updateBounds')\n  }\n\n  render(ctx: CanvasRenderingContext2D) {\n    if (this.stroke.color && this.stroke.width) {\n      ctx.lineWidth = this.stroke.width\n      ctx.strokeStyle = this.stroke.color\n    }\n    if (this.fill) {\n      ctx.fillStyle = this.fill\n    }\n    if (this.filter) {\n      ctx.filter = this.filter\n    }\n    return this\n  }\n\n  destroy() {\n    this.removeAllListeners()\n  }\n}\n","import type { Properties } from 'csstype'\nimport { createCanvasFontString, formatWithPx } from '../utils'\nimport type { IAbstractStyle } from './abstract-style'\nimport { AbstractStyle } from './abstract-style'\n\nexport interface TextStyleOptions extends IAbstractStyle {\n  /**\n   * @description 字体\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-family)\n   */\n  fontFamily: Properties['fontFamily']\n  /**\n   * @description 字体大小 当值为 number 时单位为px\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-size)\n   */\n  fontSize: Properties['fontSize'] | (number & {})\n  /**\n   * @description 字体样式\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-style)\n   */\n  fontStyle: Properties['fontStyle']\n  /**\n   * @description 字体的粗细程度\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-weight)\n   */\n  fontWeight: Properties['fontWeight']\n  /**\n   * 指定绘制文本时字体如何被扩展或压缩\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fontStretch)\n   */\n  fontStretch: CanvasFontStretch\n  /**\n   * 用于指定渲染文本的替代大写形式\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fontVariantCaps)\n   */\n  fontVariantCaps: CanvasFontVariantCaps\n  /**\n   * 用于指定绘制文本时字母之间的间距\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/letterSpacing)\n   */\n  letterSpacing: string | number\n  /**\n   * 指定绘制文本时单词之间的间距\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/wordSpacing)\n   */\n  wordSpacing: string | number\n  /**\n   * 文本时文本的对齐方式\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/textAlign)\n   */\n  textAlign: CanvasTextAlign\n\n  /**\n   * 用于指定文本的行高\n   */\n  lineHeight: number\n  /**\n   * 是否开启换行\n   */\n  wordWrap: boolean\n  /**\n   * 换行宽度\n   */\n  wordWrapWidth: number\n}\n\nexport class TextStyle extends AbstractStyle implements TextStyleOptions {\n  public static defaultTextStyle: TextStyleOptions = {\n    fill: 'black',\n    stroke: {\n      width: 1,\n    },\n    fontFamily: 'Arial',\n    fontSize: 12,\n    fontStyle: 'normal',\n    fontWeight: 'normal',\n    fontStretch: 'condensed',\n    fontVariantCaps: 'normal',\n    letterSpacing: 0,\n    wordSpacing: 0,\n    textAlign: 'left',\n    filter: 'none',\n    lineHeight: 0,\n    wordWrap: false,\n    wordWrapWidth: 0,\n  }\n\n  _isStroke: boolean\n  constructor(style: Partial<TextStyleOptions> = {}) {\n    super()\n    this._isStroke = !!style.stroke\n    const fullStyle = Object.assign({}, TextStyle.defaultTextStyle, style)\n    for (const key in fullStyle) {\n      const thisKey = key as keyof typeof this\n      const data = fullStyle[key as keyof TextStyleOptions] as any\n      if (key === 'stroke') {\n        this[thisKey] = Object.assign({}, TextStyle.defaultTextStyle[key] as unknown as object, data)\n      }\n      else {\n        this[thisKey] = data\n      }\n    }\n  }\n\n  public reset() {\n    const defaultStyle = TextStyle.defaultTextStyle\n    for (const key in defaultStyle) {\n      this[key as keyof typeof this] = defaultStyle[key as keyof TextStyleOptions] as any\n    }\n    this.updateBounds()\n    this.update()\n  }\n\n  protected readonly textBaseline = 'top'\n\n  private _fontSize: TextStyleOptions['fontSize']\n  set fontSize(value) {\n    this._fontSize = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontSize() {\n    return this._fontSize\n  }\n\n  private _fontFamily: TextStyleOptions['fontFamily']\n  set fontFamily(value) {\n    this._fontFamily = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontFamily() {\n    return this._fontFamily\n  }\n\n  private _fontStyle: TextStyleOptions['fontStyle']\n\n  set fontStyle(value) {\n    this._fontStyle = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontStyle() {\n    return this._fontStyle\n  }\n\n  private _fontWeight: TextStyleOptions['fontWeight']\n\n  set fontWeight(value) {\n    this._fontWeight = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontWeight() {\n    return this._fontWeight\n  }\n\n  private _fontStretch: TextStyleOptions['fontStretch'] = TextStyle.defaultTextStyle.fontStretch\n\n  set fontStretch(value) {\n    this._fontStretch = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontStretch() {\n    return this._fontStretch\n  }\n\n  private _fontVariantCaps: TextStyleOptions['fontVariantCaps'] = TextStyle.defaultTextStyle.fontVariantCaps\n\n  set fontVariantCaps(value) {\n    this._fontVariantCaps = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontVariantCaps() {\n    return this._fontVariantCaps\n  }\n\n  private _letterSpacing: TextStyleOptions['letterSpacing'] = TextStyle.defaultTextStyle.letterSpacing\n\n  set letterSpacing(value) {\n    this._letterSpacing = value\n    this.update()\n    this.updateBounds()\n  }\n\n  get letterSpacing() {\n    return this._letterSpacing\n  }\n\n  private _wordSpacing: TextStyleOptions['wordSpacing'] = TextStyle.defaultTextStyle.wordSpacing\n\n  set wordSpacing(value) {\n    this._wordSpacing = value\n    this.update()\n    this.updateBounds()\n  }\n\n  get wordSpacing() {\n    return this._wordSpacing\n  }\n\n  private _textAlign: TextStyleOptions['textAlign'] = TextStyle.defaultTextStyle.textAlign\n\n  set textAlign(value) {\n    this._textAlign = value\n    this.update()\n  }\n\n  get textAlign() {\n    return this._textAlign\n  }\n\n  private _lineHeight = 0\n\n  set lineHeight(value) {\n    if (this.lineHeight !== value) {\n      this._lineHeight = value\n      this.update()\n      this.updateBounds()\n    }\n  }\n\n  get lineHeight() {\n    if (!this._lineHeight) {\n      this._lineHeight = typeof this.fontSize == 'number' ? this.fontSize : Number.parseInt(`${this.fontSize}`)\n    }\n    return this._lineHeight\n  }\n\n  private _wordWrap = false\n\n  set wordWrap(value) {\n    if (this.wordWrap !== value) {\n      this._wordWrap = value\n      this.update()\n      this.updateBounds()\n    }\n  }\n\n  get wordWrap() {\n    return this._wordWrap\n  }\n\n  private _wordWrapWidth = 0\n\n  set wordWrapWidth(value) {\n    if (this.wordWrapWidth !== value) {\n      this._wordWrapWidth = value\n      this.update()\n      this.updateBounds()\n    }\n  }\n\n  get wordWrapWidth() {\n    return this._wordWrapWidth\n  }\n\n  clone() {\n    return new TextStyle({\n      fill: this.fill,\n      stroke: this.stroke,\n      fontFamily: this.fontFamily,\n      fontSize: this.fontSize,\n      fontStyle: this.fontStyle,\n      fontWeight: this.fontWeight,\n      fontStretch: this.fontStretch,\n      fontVariantCaps: this.fontVariantCaps,\n      letterSpacing: this.letterSpacing,\n      wordSpacing: this.wordSpacing,\n      textAlign: this.textAlign,\n      filter: this.filter,\n    })\n  }\n\n  render(ctx: CanvasRenderingContext2D) {\n    super.render(ctx)\n    ctx.textBaseline = 'top'\n    ctx.font = createCanvasFontString(this)\n    ctx.fontStretch = this.fontStretch\n    ctx.fontVariantCaps = this.fontVariantCaps\n    ctx.letterSpacing = formatWithPx(this.letterSpacing)\n    ctx.wordSpacing = formatWithPx(this.wordSpacing)\n    ctx.textAlign = this.textAlign\n    return this\n  }\n};\n","import type { TextStyleOptions } from '../style/text-style'\nimport { TextStyle } from '../style/text-style'\nimport type { DisplayOptions } from './display'\nimport { Display } from './display'\n\nexport interface TextOptions extends DisplayOptions {\n  /**\n   * 文本\n   */\n  text: string\n  /**\n   * 文本样式\n   */\n  style?: Partial<TextStyleOptions> | TextStyle\n}\n\nexport class Text extends Display {\n  constructor(options: TextOptions) {\n    super(options)\n    if (options.style)\n      this.style = options.style\n    this.text = options.text ?? ''\n    this.emit('ready')\n    this._onUpdate()\n  }\n\n  private _style = new TextStyle()\n\n  set style(style: Partial<TextStyleOptions> | TextStyle) {\n    style = style || {}\n    this._style?.off('update', this._onUpdate, this)\n    this._style?.off('updateBounds', this.shouldUpdateBounds, this)\n    if (style instanceof TextStyle) {\n      this._style = style\n    }\n    else {\n      this._style = new TextStyle(style)\n    }\n    this._style.on('update', this._onUpdate, this)\n    this._style?.on('updateBounds', this.shouldUpdateBounds, this)\n    this._onUpdate()\n  }\n\n  get style(): TextStyle {\n    return this._style\n  }\n\n  private _text = ''\n\n  set text(text) {\n    if (this._text === text)\n      return\n    this._text = text\n    this._onUpdate()\n  }\n\n  get text() {\n    return this._text\n  }\n\n  get _shouldUpdate(): boolean {\n    return !!(this.style.fill) || !!(this.style.stroke.color && this.style.stroke.width)\n  }\n\n  getSplitText(ctx: CanvasRenderingContext2D) {\n    const texts = this.text.split('')\n    const splitText = []\n    let multilineText: string[] = []\n    for (let i = 0; i < texts.length; i++) {\n      const currentStr = texts[i]\n      multilineText.push(currentStr)\n      const rowStr = multilineText.join('')\n      if (ctx.measureText(rowStr).width > this.style.wordWrapWidth) {\n        multilineText.pop()\n        splitText.push(multilineText.join(''))\n        multilineText = [currentStr]\n        continue\n      }\n      if (i === texts.length - 1) {\n        splitText.push(rowStr)\n      }\n    }\n    return splitText\n  }\n\n  _render(ctx: CanvasRenderingContext2D) {\n    if (this.style.fill || (this.style.stroke?.color && this.style.stroke?.width)) {\n      this.style.render(ctx)\n      // 绘制单行文本\n      if (!this.style.wordWrap || !this.style.wordWrapWidth) {\n        if (this.style.fill) {\n          ctx.fillText(this.text, this.position.x, this.position.y)\n        }\n        if (this.style.stroke?.color && this.style.stroke?.width) {\n          ctx.strokeText(this.text, this.position.x, this.position.y)\n        }\n      }\n      else {\n        const splitText = this.getSplitText(ctx)\n        for (let i = 0; i < splitText.length; i++) {\n          const text = splitText[i]\n          if (this.style.fill) {\n            ctx.strokeText(text, this.position.x, this.position.y + i * this.style.lineHeight)\n          }\n          if (this.style.stroke?.color && this.style.stroke?.width) {\n            ctx.strokeText(text, this.position.x, this.position.y + i * this.style.lineHeight)\n          }\n        }\n      }\n    }\n  }\n\n  protected transformWidth = 0\n\n  protected transformHeight = 0\n  protected updateTransformBounds() {\n    if (!this._app)\n      return\n    this._app.wrapperRender((ctx) => {\n      this.style.render(ctx)\n      if (!this.style.wordWrap || !this.style.wordWrapWidth) {\n        const measure = ctx.measureText(this.text)\n        this.transformWidth = measure.width\n        let height = Math.max(...[\n          measure.actualBoundingBoxDescent - measure.actualBoundingBoxAscent,\n          typeof this.style.fontSize == 'number' ? this.style.fontSize : Number.parseInt(`${this.style.fontSize}`),\n        ])\n        if (this.style.stroke && this.style.stroke.width) {\n          height += this.style.stroke.width\n        }\n        this.transformHeight = height\n      }\n      else {\n        const splitText = this.getSplitText(ctx)\n        this.transformWidth = this.style.wordWrapWidth\n        if (!splitText.length) {\n          this.transformHeight = 0\n          return\n        }\n        const measure = ctx.measureText(this.getSplitText(ctx)[0])\n        const lineHeight = this.style.lineHeight\n        let height = Math.max(...[\n          measure.actualBoundingBoxDescent - measure.actualBoundingBoxAscent,\n          lineHeight,\n        ])\n        if (this.style.stroke && this.style.stroke.width) {\n          height += this.style.stroke.width\n        }\n        if (splitText.length > 1) {\n          this.transformHeight = (splitText.length - 1) * lineHeight + height\n        }\n      }\n    })\n  }\n};\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","exports","ENV","formatWithPx","val","calcDiff","numbers","reduce","a","b","calcMax","calcMin","ensureBetween","input","min","max","createProxy","value","cb","Proxy","set","target","property","newValue","getEnv","uni","UNI_APP","wx","WX","window","document","WEB","UNKNOWN","drawRectCompatible","ctx","position","size","rounded","Math","x","y","beginPath","moveTo","arcTo","closePath","roundRect","rect","App","options","_ready","_env","canvas","ticker","dpr","width","height","constructor","super","validateAppOptions","initDpr","initTicker","initCanvas","onReady","appOptions","console","error","devicePixelRatio","querySelector","query","createSelectorQuery","select","fields","node","exec","res","initCanvasSize","createElement","style","getContext","init","Ticker","add","update","bind","beforeRender","save","afterRender","restore","children","objects","index","object","onAdd","remove","delIndex","indexOf","onRemove","splice","isDirty","filter","e","dirty","every","_renderId","clearRect","shouldRender","shouldUpdate","child","shift","render","toDataURL","type","quality","toDataURLAsync","Promise","resolve","wrapperRender","autoStart","requestAnimationFrame","cancelAnimationFrame","myReq","isRunning","handler","start","removeAll","stop","forEach","performance","now","ObservablePoint","_x","_y","_observer","observer","clone","_onUpdate","copyFrom","p","copyTo","equals","Symbol","iterator","step","properties","next","done","defaultSkew","defaultPivot","defaultAnchor","defaultScale","Display","visible","scale","skew","pivot","shadow","_shadow","rotation","anchor","alpha","__shouldUpdate","_shouldUpdate","_dirty","_position","_scale","_skew","_alpha","_rotation","_anchor","_pivot","_point","_app","_visible","_shouldUpdateBounds","shouldUpdateBounds","_baseRender","blur","color","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","updateTransformBounds","globalAlpha","scaleX","scaleY","skewX","skewY","positionX","positionY","pivotX","pivotY","cos","sin","anchorX","anchorY","originX","transformWidth","originY","transformHeight","dx","dy","setTransform","_render","resetTransform","addTo","app","destroy","Picture","src","maybeImage","image","initImageEvents","createImage","complete","_onImageComplete","addEventListener","_size","_imageSize","_slice","_sliceSize","sliceSize","_objectFit","objectFit","_rounded","_complete","_isSlice","renderRoundedClip","clip","drawImage","scaleDiff","diff","slim","fat","Shape","addPath","items","pathInstruction","action","lineCap","cap","lineJoin","join","lineTo","w","h","radii","arc","radius","startAngle","endAngle","PI","counterclockwise","x1","y1","x2","y2","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","ellipse","radiusX","radiusY","fillRect","strokeRect","actions","map","item","includes","Error","fillStyle","fill","strokeInput","CanvasGradient","CanvasPattern","strokeStyle","lineWidth","_strokeInput","dash","setLineDash","stroke","_strokeStyle","allX","allY","strokeWeight","_fillStyle","_filter","AbstractStyle","_fill","_stroke","updateBounds","TextStyle","static","fontFamily","fontSize","fontStyle","fontWeight","fontStretch","fontVariantCaps","letterSpacing","wordSpacing","textAlign","lineHeight","wordWrap","wordWrapWidth","_isStroke","fullStyle","assign","defaultTextStyle","key","thisKey","data","reset","defaultStyle","textBaseline","_fontSize","_fontFamily","_fontStyle","_fontWeight","_fontStretch","_fontVariantCaps","_letterSpacing","_wordSpacing","_textAlign","_lineHeight","Number","parseInt","_wordWrap","_wordWrapWidth","font","createCanvasFontString","Text","text","_style","_text","getSplitText","texts","split","splitText","multilineText","currentStr","rowStr","measureText","pop","strokeText","fillText","measure","actualBoundingBoxDescent","actualBoundingBoxAscent"],"mappings":"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","x_google_ignoreList":[0]}