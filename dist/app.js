"use strict";var t=require("./index-DdxX_nW5.js"),e=require("./const.js"),i=require("./utils.js");class s extends t.EventEmitter{canvas;ctx;dpr=1;width;height;onUpdate;static createImage;constructor({width:t=600,height:h=800,dpr:r=!0,createImage:n=()=>document.createElement("img"),onUpdate:a}={}){super(),r&&(this.dpr=window.devicePixelRatio??1),this.onUpdate=a??e.NOOP,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.style.width=i.formatValue(t),this.canvas.style.height=i.formatValue(h),this.canvas.width=t*this.dpr,this.canvas.height=h*this.dpr,this.width=t,this.height=h,s.createImage=n,this.update()}beforeRender(){this.ctx.save()}afterRender(){this.ctx.restore()}children=[];add(t){this.children.push(t),t.onAdd(this)}remove(t){const e=this.children.indexOf(t);-1!==e&&(t.onRemove(),this.children.splice(e,1))}update(){if(window.requestAnimationFrame((()=>{this.update()})),!this.children.length)return;const t=!![...this.children.filter((t=>t.dirty))].length;if(this.children.every((t=>t._renderId>0))&&this.children.length&&this.emit("render"),!t)return;this.ctx.clearRect(-this.canvas.width,-this.canvas.height,2*this.canvas.width,2*this.canvas.height);const e=[...this.children].filter((t=>t.shouldUpdate));for(;e.length;){this.beforeRender();const t=e.shift();t.render(this.ctx),t.dirty=!1,t._renderId++,this.afterRender()}this.onUpdate()}toDataURL(t,e){return this.canvas.toDataURL(t,e)}toDataURLAsync(t,e){return new Promise((i=>{this.once("render",(()=>{i(this.toDataURL(t,e))}))}))}onContext(t){this.beforeRender(),t(this.ctx),this.afterRender()}}exports.App=s;
//# sourceMappingURL=app.js.map
