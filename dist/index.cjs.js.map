{"version":3,"file":"index.cjs.js","sources":["../node_modules/.pnpm/eventemitter3@5.0.1/node_modules/eventemitter3/index.js","../src/utils.ts","../src/app.ts","../src/coordinate/ObservablePoint.ts","../src/object/display.ts","../src/style/abstract-style.ts","../src/style/text-style.ts","../src/object/picture.ts","../src/object/shape.ts","../src/object/text.ts"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","import type { PointData } from './coordinate/PointData'\nimport type { TextStyle } from './style/text-style'\n\n/**\n *  输出 px\n * @param val\n */\nexport function formatWithPx(val: string | number) {\n  return typeof val === 'string' ? val : `${val}px`\n}\n\n/**\n * 创造 [CSS-font](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font) 字符串\n * 由于 canvas 绘制的差异性部分属性不生效故舍弃\n */\nexport function createCanvasFontString({\n  fontFamily,\n  fontSize,\n  fontStyle = 'normal',\n  fontWeight = 'normal',\n}: TextStyle): string {\n  const _fontSize = typeof fontSize === 'string' ? fontSize : `${fontSize}px`\n  return `${fontStyle} ${fontWeight} ${_fontSize} ${fontFamily}`\n}\n\n/**\n * 计算最小值\n * @param numbers\n */\nexport function calcMin(numbers: number[]) {\n  return numbers.reduce((a, b) => {\n    return a < b ? a : b\n  })\n}\n/**\n * 计算最大值\n * @param numbers\n */\nexport function calcMax(numbers: number[]) {\n  return numbers.reduce((a, b) => {\n    return a > b ? a : b\n  })\n}\n/**\n * 计算差异\n * @param numbers\n */\nexport function calcDiff(numbers: number[]) {\n  return calcMax(numbers) - calcMin(numbers)\n}\n\n/**\n * 确保输入值在 min 和 max 之间，若超出边界则返回边界\n * @param input\n * @param min\n * @param max\n */\nexport function ensureBetween(input: number, min: number = 0, max: number = 1) {\n  return input <= min ? min : input >= max ? max : input\n}\n\n/**\n * 创建代理\n * @param value\n * @param cb\n */\nexport function createProxy<T extends object>(value: T, cb?: (property: string, newValue: any) => void): T {\n  return new Proxy<T>(value, {\n    set: (target, property, newValue) => {\n      target[property as keyof T] = newValue\n      cb?.(property as string, newValue)\n      return true\n    },\n  })\n}\n\nexport enum ENV {\n  WX = 'WX',\n  WEB = 'WEB',\n  UNKNOWN = 'UNKNOWN',\n  UNI_APP = 'UNI_APP',\n}\n\nexport function getEnv() {\n  if (typeof uni !== 'undefined')\n    return ENV.UNI_APP\n  if (typeof wx !== 'undefined')\n    return ENV.WX\n  if (typeof window !== 'undefined' && typeof window.document !== 'undefined')\n    return ENV.WEB\n  return ENV.UNKNOWN\n}\n\n/**\n * Draws a rectangle with rounded corners compatible with different environments.\n *\n * @param {CanvasRenderingContext2D} ctx - The canvas rendering context.\n * @param {PointData} position - The position of the rectangle.\n * @param {PointData} size - The size of the rectangle.\n * @param {number} [rounded] - The radius of the rounded corners.\n *\n * @return {void}\n */\nexport function drawRectCompatible(\n  ctx: CanvasRenderingContext2D,\n  position: PointData,\n  size: PointData,\n  rounded?: number,\n) {\n  rounded = rounded ?? 0\n  rounded = Math.min(rounded, size.x / 2, size.y / 2)\n  ctx.beginPath()\n  if (rounded) {\n    if (getEnv() === ENV.WX) {\n      // 左上角到右上角\n      ctx.moveTo(position.x + rounded, position.y)\n      ctx.arcTo(position.x + size.x, position.y, position.x + size.x, position.y + rounded, rounded)\n      // 右上角到右下角\n      ctx.arcTo(position.x + size.x, position.y + size.y, position.x + size.x - rounded, position.y + size.y, rounded)\n      // 右下角到左下角\n      ctx.arcTo(position.x, position.y + size.y, position.x, position.y + size.y - rounded, rounded)\n      // 左下角到左上角\n      ctx.arcTo(position.x, position.y, position.x + rounded, position.y, rounded)\n      // 闭合路径\n      ctx.closePath()\n    }\n    else {\n      ctx.roundRect(position.x, position.y, size.x, size.y, rounded)\n    }\n  }\n  else {\n    ctx.rect(position.x, position.y, size.x, size.y)\n  }\n}\n","import EventEmitter from 'eventemitter3'\nimport type { Display } from './object/display'\nimport { ENV, formatWithPx, getEnv } from './utils'\n\nexport interface AppOptions {\n  /**\n   *  画布宽度\n   */\n  width?: number\n  /**\n   *  画布高度\n   */\n  height?: number\n  /**\n   *  是否开启dpr\n   */\n  dpr?: boolean | number\n  /**\n   *  `画布元素`或`画布id(微信小程序或者uni-app)`或者`document.querySelector可以接受的字符串`\n   */\n  canvas?: HTMLCanvasElement | string\n}\n\nexport class App extends EventEmitter<{\n  render: []\n  ready: []\n}> {\n  private ctx!: CanvasRenderingContext2D\n  private _ready = false\n  protected _env = getEnv()\n  canvas!: HTMLCanvasElement\n  ticker!: Ticker\n  dpr = 1\n  width = 0\n  height = 0\n  constructor(private options: AppOptions = {}) {\n    super()\n    this.validateAppOptions(options)\n    this.initDpr()\n    this.initTicker()\n    this.initCanvas()\n  }\n\n  onReady(fn: AnyFunction) {\n    if (this._ready) {\n      fn()\n    }\n    else {\n      this.once('ready', () => {\n        fn()\n      })\n    }\n  }\n\n  private validateAppOptions(appOptions: AppOptions) {\n    if (this._env === ENV.WX && !appOptions.canvas) {\n      console.error('当前为非document环境, 无法使用 document.createElement(\\'canvas\\'),\\n 请传入canvas元素或者canvasId')\n    }\n  }\n\n  private initDpr() {\n    const { dpr = true } = this.options\n    if (typeof dpr === 'boolean') {\n      this.dpr = window.devicePixelRatio ?? 1\n    }\n    else {\n      this.dpr = dpr\n    }\n  }\n\n  private initCanvas() {\n    const canvas = this.options.canvas\n    if (canvas) {\n      if (typeof canvas === 'string') {\n        if (this._env === ENV.WEB) {\n          this.canvas = document.querySelector(canvas) as HTMLCanvasElement\n        }\n        else {\n          let query: WechatMiniprogram.SelectorQuery | UniNamespace.SelectorQuery\n          if (this._env === ENV.WX) {\n            query = wx.createSelectorQuery()\n          }\n          else {\n            query = uni.createSelectorQuery()\n          }\n          query.select('#myCanvas')\n            .fields({ node: true, size: true }, undefined as any)\n            .exec((res) => {\n              const canvas = res[0].node as HTMLCanvasElement\n              this.canvas = canvas\n              this.initCanvasSize()\n            })\n        }\n      }\n      else {\n        this.canvas = canvas\n        this.initCanvasSize()\n      }\n    }\n    else {\n      this.canvas = document.createElement('canvas')!\n      this.initCanvasSize()\n    }\n  }\n\n  private initCanvasSize() {\n    const { width = 300, height = 150 } = this.options\n    if (!this.canvas)\n      return\n    if (this.canvas.style) {\n      this.canvas.style.width = formatWithPx(width)\n      this.canvas.style.height = formatWithPx(height)\n      this.canvas.width = width * this.dpr\n      this.canvas.height = height * this.dpr\n    }\n    else {\n      this.canvas.width = width * this.dpr\n      this.canvas.height = height * this.dpr\n    }\n    this.width = width\n    this.height = width\n    this.ctx = this.canvas.getContext('2d')!\n    this._ready = true\n    this.emit('ready')\n    this.ticker.init(this.canvas, true)\n  }\n\n  private initTicker() {\n    this.ticker = new Ticker()\n    this.ticker.add(this.update.bind(this))\n  }\n\n  private beforeRender() {\n    this.ctx.save()\n  }\n\n  private afterRender() {\n    this.ctx.restore()\n  }\n\n  children: Display[] = []\n\n  add(...objects: Display[]) {\n    for (let index = 0; index < objects.length; index++) {\n      const object = objects[index]\n      this.children.push(object)\n      object.onAdd(this)\n    }\n  }\n\n  remove(...objects: Display[]) {\n    for (let index = 0; index < objects.length; index++) {\n      const object = objects[index]\n      const delIndex = this.children.indexOf(object)\n      if (delIndex !== -1) {\n        object.onRemove()\n        this.children.splice(delIndex, 1)\n      }\n    }\n  }\n\n  private update() {\n    if (!this.children.length) {\n      return\n    }\n    const isDirty = !![...this.children.filter(e => e.dirty)].length\n    const _renderIds = this.children.every(e => e._renderId > 0)\n    if (_renderIds && this.children.length) {\n      this.emit('render')\n    }\n    if (!isDirty)\n      return\n    this.ctx.clearRect(\n      -this.canvas.width,\n      -this.canvas.height,\n      this.canvas.width * 2,\n      this.canvas.height * 2,\n    )\n\n    // this.debug()\n    const shouldRender = [...this.children].filter(e => e.shouldUpdate)\n    while (shouldRender.length) {\n      this.beforeRender()\n      const child = shouldRender.shift()!\n      child.render(this.ctx)\n      child.dirty = false\n      child._renderId++\n      this.afterRender()\n    }\n  }\n\n  toDataURL(type?: string, quality?: any) {\n    return this.canvas.toDataURL(type, quality)\n  }\n\n  toDataURLAsync(type?: string, quality?: any) {\n    return new Promise<string>((resolve) => {\n      this.once('render', () => {\n        resolve(this.toDataURL(type, quality))\n      })\n    })\n  }\n\n  wrapperRender(fn: (ctx: CanvasRenderingContext2D) => any) {\n    this.beforeRender()\n    fn(this.ctx)\n    this.afterRender()\n  }\n}\n\nclass Ticker {\n  requestAnimationFrame?: typeof requestAnimationFrame\n  cancelAnimationFrame?: typeof cancelAnimationFrame\n  myReq: number = 0\n  private isRunning: boolean = false\n  handler: ((time: number) => void)[] = []\n  protected _env = getEnv()\n  constructor(protected autoStart: boolean = true) {\n\n  }\n\n  init(canvas: HTMLCanvasElement, autoStart: boolean) {\n    if (this._env === ENV.WX) {\n      this.requestAnimationFrame = (canvas as any).requestAnimationFrame.bind(this)\n      this.cancelAnimationFrame = (canvas as any).requestAnimationFrame.bind(this)\n    }\n    else {\n      this.requestAnimationFrame = requestAnimationFrame.bind(this)\n      this.cancelAnimationFrame = cancelAnimationFrame.bind(this)\n    }\n    if (autoStart) {\n      this.start()\n    }\n  }\n\n  add(fn: (time: number) => void) {\n    this.handler.push(fn)\n  }\n\n  removeAll() {\n    this.handler = []\n  }\n\n  remove(fn: (time: number) => void) {\n    const index = this.handler.indexOf(fn)\n    if (index !== -1) {\n      this.handler.splice(index, 1)\n    }\n  }\n\n  start() {\n    this.isRunning = true\n    this.myReq = this.requestAnimationFrame!(this.update.bind(this))\n  }\n\n  stop() {\n    if (this.isRunning && this.myReq) {\n      this.cancelAnimationFrame?.(this.myReq)\n      this.isRunning = false\n    }\n  }\n\n  update() {\n    if (!this.isRunning)\n      return\n    this.myReq = this.requestAnimationFrame!(this.update.bind(this))\n    this.handler.forEach(fn => fn(performance.now()))\n  }\n}\n","import type { PointData } from './PointData'\nimport type { PointLike } from './PointLike'\n\nexport interface Observer<T> {\n  _onUpdate: (point?: T) => void\n}\n\nexport class ObservablePoint implements PointLike {\n  public _x: number\n  public _y: number\n  private readonly _observer: Observer<ObservablePoint> | null\n  constructor(observer: Observer<ObservablePoint> | null, x?: number, y?: number) {\n    this._x = x || 0\n    this._y = y || 0\n    this._observer = observer\n  }\n\n  public clone(observer?: Observer<ObservablePoint>): ObservablePoint {\n    return new ObservablePoint(observer ?? this._observer, this._x, this._y)\n  }\n\n  public set(x = 0, y = x): this {\n    if (this._x !== x || this._y !== y) {\n      this._x = x\n      this._y = y\n      this._observer?._onUpdate(this)\n    }\n    return this\n  }\n\n  public copyFrom(p: PointData): this {\n    if (this._x !== p.x || this._y !== p.y) {\n      this._x = p.x\n      this._y = p.y\n      this._observer?._onUpdate(this)\n    }\n    return this\n  }\n\n  public copyTo<T extends PointLike>(p: T): T {\n    p.set(this._x, this._y)\n    return p\n  }\n\n  public equals(p: PointData): boolean {\n    return (p.x === this._x) && (p.y === this._y)\n  }\n\n  get x(): number {\n    return this._x\n  }\n\n  set x(value: number) {\n    if (this._x !== value) {\n      this._x = value\n      this._observer?._onUpdate(this)\n    }\n  }\n\n  get y(): number {\n    return this._y\n  }\n\n  set y(value: number) {\n    if (this._y !== value) {\n      this._y = value\n      this._observer?._onUpdate(this)\n    }\n  }\n\n  [Symbol.iterator]() {\n    let step = 0\n    const properties = [this.x, this.y]\n\n    return {\n      next: () => {\n        if (step < properties.length) {\n          return { value: properties[step++], done: false }\n        }\n        else {\n          return { done: true, value: undefined }\n        }\n      },\n    }\n  }\n}\n","import EventEmitter from 'eventemitter3'\nimport type { App } from '../app'\nimport type { Observer } from '../coordinate/ObservablePoint'\nimport { ObservablePoint } from '../coordinate/ObservablePoint'\nimport type { PointData } from '../coordinate/PointData'\nimport { createProxy, ensureBetween, getEnv } from '../utils'\n\ninterface ShadowType {\n  /**\n   * [CanvasRenderingContext2D.shadowOffsetX](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowOffsetX)\n   */\n  x?: number\n  /**\n   * [CanvasRenderingContext2D.shadowOffsetY](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowOffsetY)\n   */\n  y?: number\n  /**\n   * [CanvasRenderingContext2D.shadowBlur](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowBlur)\n   */\n  blur?: number\n  /**\n   * [CanvasRenderingContext2D.shadowColor](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/shadowColor)\n   */\n  color?: string\n}\n/**\n * [单位矩阵变化](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setTransform)\n */\nexport interface DisplayOptions {\n  /**\n   * 元素是否可见\n   */\n  visible?: boolean\n  /**\n   * 元素位置x\n   */\n  x?: number\n  /**\n   * 元素位置y\n   */\n  y?: number\n  /**\n   * 元素位置\n   */\n  position?: PointData\n  /**\n   * 旋转角度(弧度)\n   */\n  rotation?: number\n  /**\n   * 缩放比例\n   */\n  scale?: PointData | number\n  /**\n   * 单位矩阵变化中心，默认是[0,0]表示左上角，[1,1]表示右下角，[0.5,0.5]表示中心\n   *\n   * 此属性可以很好的控制元素的锚点，不用计算相对位置\n   *\n   * 例如：一个500x500的画布上需要绘制一个上下居中的图片\n   *\n   * ``` ts\n   * const text = new Picture('demo.png',{\n   *  anchor: 0.5\n   * })\n   * ```\n   *\n   * ```\n   * > [!IMPORTANT]\n   * > Crucial information necessary for users to succeed.\n   * ```\n   */\n  anchor?: PointData | number\n  /**\n   * 同 anchor，但是具体坐标，建议使用 anchor\n   */\n  pivot?: PointData | number\n  /**\n   * 元素倾斜\n   */\n  skew?: PointData\n  /**\n   * 透明度\n   */\n  alpha?: number\n  /**\n   * 阴影\n   */\n  shadow?: ShadowType\n}\n\n/**\n * 默认值\n */\nconst defaultSkew = new ObservablePoint(null)\nconst defaultPivot = new ObservablePoint(null)\nconst defaultAnchor = new ObservablePoint(null)\nconst defaultScale = new ObservablePoint(null, 1, 1)\n\nexport abstract class Display extends EventEmitter<{\n  ready: []\n}> implements Observer<ObservablePoint> {\n  protected _env = getEnv()\n  constructor(options: DisplayOptions = {}) {\n    super()\n    this.visible = options.visible ?? true\n    if (options.position) {\n      this.position = options.position\n    }\n    else {\n      this.x = options.x ?? 0\n      this.y = options.y ?? 0\n    }\n    this.scale = options.scale ?? 1\n    this.skew = options.skew ?? { x: 0, y: 0 }\n    this.pivot = options.pivot ?? 0\n    this.shadow = options.shadow ?? this._shadow\n    this.rotation = options.rotation ?? 0\n    this.anchor = options.anchor ?? 0\n    this.alpha = options.alpha ?? 1\n  }\n\n  /**\n   * 更新优化\n   */\n\n  private get __shouldUpdate() {\n    return !(!this.visible\n      || this.scale.x === 0\n      || this.scale.y === 0\n      || this.alpha === 0)\n  }\n  /**\n   * 更新优化\n   * 如果_shouldRender为true 则渲染\n   * 否则跳过渲染\n   */\n  abstract get _shouldUpdate(): boolean\n\n  get shouldUpdate() {\n    return this.__shouldUpdate && this._shouldUpdate\n  }\n\n  protected _dirty = false\n  set dirty(value) {\n    if (this._dirty === value)\n      return\n    this._dirty = value\n  }\n\n  get dirty() {\n    return this._dirty\n  }\n\n  set x(value) {\n    if (this.x !== value) {\n      this.position.x = value\n    }\n  }\n\n  get x() {\n    return this.position.x\n  }\n\n  set y(value) {\n    if (this.y !== value) {\n      this.position.y = value\n    }\n  }\n\n  get y() {\n    return this.position.y\n  }\n\n  private _position = new ObservablePoint(this, 0, 0)\n\n  set position(value: PointData) {\n    if (this.position !== value) {\n      this._position.copyFrom(value)\n    }\n  }\n\n  get position(): ObservablePoint {\n    return this._position\n  }\n\n  private _scale: ObservablePoint = defaultScale\n\n  set scale(value: PointData | number) {\n    if (this._scale === defaultScale) {\n      this._scale = new ObservablePoint(this, 1, 1)\n    }\n    if (typeof value === 'number') {\n      this._scale.set(value)\n    }\n    else {\n      this._scale.copyFrom(value)\n    }\n  }\n\n  get scale(): ObservablePoint {\n    if (this._scale === defaultScale) {\n      this._scale = new ObservablePoint(this, 1, 1)\n    }\n    return this._scale\n  }\n\n  private _skew: ObservablePoint = defaultSkew\n\n  set skew(value: PointData) {\n    if (this._skew === defaultSkew) {\n      this._skew = new ObservablePoint(this)\n    }\n    this._skew.copyFrom(value)\n  }\n\n  get skew(): ObservablePoint {\n    if (this._skew === defaultSkew) {\n      this._skew = new ObservablePoint(this, 0, 0)\n    }\n    return this._skew\n  }\n\n  private _alpha = 1\n\n  set alpha(value) {\n    if (this.alpha !== value) {\n      this._alpha = value\n      this._onUpdate()\n    }\n  }\n\n  get alpha() {\n    return this._alpha\n  }\n\n  private _rotation = 0\n\n  set rotation(value) {\n    if (this.rotation !== value) {\n      this._rotation = value\n      this._onUpdate()\n    }\n  }\n\n  get rotation() {\n    return this._rotation\n  }\n\n  private _anchor = defaultAnchor\n\n  set anchor(value: PointData | number) {\n    if (this._anchor === defaultAnchor) {\n      this._anchor = new ObservablePoint(this, 0, 0)\n    }\n    if (typeof value === 'number') {\n      this._anchor.set(value)\n    }\n    else {\n      this._anchor.copyFrom(value)\n    }\n  }\n\n  get anchor(): ObservablePoint {\n    if (this._anchor === defaultAnchor) {\n      this._anchor = new ObservablePoint(this)\n    }\n    return this._anchor\n  }\n\n  private _pivot: ObservablePoint = defaultPivot\n\n  set pivot(value: PointData | number) {\n    if (this._pivot === defaultPivot) {\n      this._pivot = new ObservablePoint(this, 0, 0)\n    }\n    if (typeof value === 'number') {\n      this._pivot.set(value)\n    }\n    else {\n      this._pivot.copyFrom(value)\n    }\n  }\n\n  get pivot(): ObservablePoint {\n    if (this._pivot === defaultPivot) {\n      this._pivot = new ObservablePoint(this)\n    }\n    return this._pivot\n  }\n\n  private _shadow: ShadowType = { x: 0, y: 0 }\n\n  set shadow(value) {\n    if (value === this._shadow)\n      return\n    if (value) {\n      this._shadow = createProxy(value, () => {\n        this._onUpdate()\n      })\n      this._onUpdate()\n    }\n  }\n\n  get shadow(): ShadowType {\n    return this._shadow\n  }\n\n  _onUpdate(_point?: ObservablePoint | undefined) {\n    this.dirty = true\n  }\n\n  _app: App | null = null\n  // abstract style: BaseStyle\n\n  private _visible = true\n\n  get visible() {\n    return this._visible\n  }\n\n  set visible(value) {\n    this._visible = value\n    this._onUpdate()\n  }\n\n  protected _shouldUpdateBounds = true\n\n  protected shouldUpdateBounds() {\n    this._shouldUpdateBounds = true\n  }\n\n  private _baseRender(ctx: CanvasRenderingContext2D) {\n    if ((this.shadow?.x || this.shadow?.y)\n      && (this.shadow?.blur || this.shadow?.color)) {\n      if (this.shadow.color) {\n        ctx.shadowColor = this.shadow.color\n      }\n      if (this.shadow.blur) {\n        ctx.shadowBlur = this.shadow.blur\n      }\n      if (this.shadow.x) {\n        ctx.shadowOffsetX = this.shadow.x\n      }\n      if (this.shadow.y) {\n        ctx.shadowOffsetY = this.shadow.y\n      }\n    }\n  }\n\n  public render(ctx: CanvasRenderingContext2D) {\n    if (this._shouldUpdateBounds) {\n      this.updateTransformBounds()\n      this._shouldUpdateBounds = false\n    }\n    if (this.alpha !== 1) {\n      ctx.globalAlpha = this.alpha\n    }\n    const dpr = this._app?.dpr ?? 1\n    const scaleX = this.scale.x * dpr\n    const scaleY = this.scale.y * dpr\n    const skewX = this.skew.x\n    const skewY = this.skew.y\n    const positionX = this.position.x * dpr\n    const positionY = this.position.y * dpr\n    const pivotX = this.pivot.x\n    const pivotY = this.pivot.y\n    const rotation = this.rotation\n    // Calculate rotation matrix components\n    const cos = Math.cos(rotation)\n    const sin = Math.sin(rotation)\n\n    const anchorX = ensureBetween(this.anchor.x, 0, 1)\n    const anchorY = ensureBetween(this.anchor.y, 0, 1)\n\n    const originX = this.transformWidth * anchorX\n    const originY = this.transformHeight * anchorY\n\n    const dx = positionX - (pivotX + originX) * cos * scaleX + (pivotY + originY) * sin * scaleY\n    const dy = positionY - (pivotX + originX) * sin * scaleX - (pivotY + originY) * cos * scaleY\n\n    ctx.setTransform(\n      scaleX * cos + skewY * -sin, // a\n      scaleX * sin + skewY * cos, // b\n      skewX * cos + scaleY * -sin, // c\n      skewX * sin + scaleY * cos, // d\n      dx, // e\n      dy, // f\n    )\n    const _position = this.position.clone()\n    this.position.set(0)\n    this._baseRender(ctx)\n    this._render(ctx)\n    this.position = _position\n    ctx.resetTransform()\n  }\n\n  _renderId = 0\n  protected abstract _render(ctx: CanvasRenderingContext2D): void\n\n  /**\n   * 同于形变转换的宽度\n   */\n  protected abstract transformWidth: number\n  /**\n   * 同于形变转换的高度\n   */\n  protected abstract transformHeight: number\n\n  /**\n   * 同于形变转换的边界\n   */\n  protected abstract updateTransformBounds(): void\n\n  get height() {\n    return this.transformHeight\n  }\n\n  get width() {\n    return this.transformWidth\n  }\n\n  onAdd(_app: App) {\n    this._app = _app\n    this._onUpdate()\n  }\n\n  onRemove() {\n    this._app = null\n    this._onUpdate()\n  }\n\n  addTo(app: App) {\n    app.add(this)\n    return this\n  }\n\n  destroy() {\n    this.removeAllListeners()\n  }\n}\n","import EventEmitter from 'eventemitter3'\nimport { createProxy } from '../utils'\n\nexport type InputColor = CanvasRenderingContext2D['strokeStyle']\nexport type LineDash = Iterable<number>\nexport interface StrokeInput {\n  /**\n   * 颜色\n   */\n  color?: InputColor\n  /**\n   * 宽度 同 [lineWidth](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/lineWidth)\n   */\n  width?: number\n  /**\n   * [CanvasRenderingContext2D.lineDashOffset](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/lineDashOffset)\n   */\n  dash?: LineDash\n}\n/**\n * 抽象样式\n */\nexport interface IAbstractStyle {\n  /**\n   * 填充颜色\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/fillStyle)\n   */\n  fill: CanvasRenderingContext2D['fillStyle'] | null\n  /**\n   * 描边颜色 当仅仅指定stroke 而未指定 fill 时 只会绘制镂空文字\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/strokeStyle)\n   */\n  stroke: StrokeInput\n  /**\n   * [CanvasRenderingContext2D.filter](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/filter)\n   */\n  filter: CanvasRenderingContext2D['filter']\n}\nexport abstract class AbstractStyle extends EventEmitter<{\n  update: []\n  updateBounds: []\n}> implements IAbstractStyle {\n  private _fill = '#000'\n\n  set fill(value) {\n    this._fill = value\n    this.update()\n  }\n\n  get fill() {\n    return this._fill\n  }\n\n  private _stroke: StrokeInput = {}\n\n  set stroke(value: StrokeInput | InputColor) {\n    if (value === this._stroke)\n      return\n    if (\n      typeof value === 'string'\n      || (typeof CanvasGradient !== 'undefined' && value instanceof CanvasGradient)\n      || (typeof CanvasPattern !== 'undefined' && value instanceof CanvasPattern)\n    ) {\n      this._stroke = createProxy({\n        ...this._stroke,\n        color: value,\n      }, () => {\n        this.update()\n      })\n    }\n    else {\n      this._stroke = createProxy(value as StrokeInput, () => {\n        this.update()\n      })\n      this.update()\n    }\n  }\n\n  get stroke(): StrokeInput {\n    return this._stroke\n  }\n\n  private _filter = 'none'\n\n  set filter(value) {\n    this._filter = value\n    this.update()\n  }\n\n  get filter() {\n    return this._filter\n  }\n\n  update() {\n    this.emit('update')\n  }\n\n  updateBounds() {\n    this.emit('updateBounds')\n  }\n\n  render(ctx: CanvasRenderingContext2D) {\n    if (this.stroke.color && this.stroke.width) {\n      ctx.lineWidth = this.stroke.width\n      ctx.strokeStyle = this.stroke.color\n    }\n    if (this.fill) {\n      ctx.fillStyle = this.fill\n    }\n    if (this.filter) {\n      ctx.filter = this.filter\n    }\n    return this\n  }\n\n  destroy() {\n    this.removeAllListeners()\n  }\n}\n","import type { Properties } from 'csstype'\nimport { createCanvasFontString, formatWithPx } from '../utils'\nimport type { IAbstractStyle } from './abstract-style'\nimport { AbstractStyle } from './abstract-style'\n\nexport interface TextStyleOptions extends IAbstractStyle {\n  /**\n   * @description 字体\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-family)\n   */\n  fontFamily: Properties['fontFamily']\n  /**\n   * @description 字体大小 当值为 number 时单位为px\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-size)\n   */\n  fontSize: Properties['fontSize'] | (number & {})\n  /**\n   * @description 字体样式\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-style)\n   */\n  fontStyle: Properties['fontStyle']\n  /**\n   * @description 字体的粗细程度\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-weight)\n   */\n  fontWeight: Properties['fontWeight']\n  /**\n   * 指定绘制文本时字体如何被扩展或压缩\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fontStretch)\n   */\n  fontStretch: CanvasFontStretch\n  /**\n   * 用于指定渲染文本的替代大写形式\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fontVariantCaps)\n   */\n  fontVariantCaps: CanvasFontVariantCaps\n  /**\n   * 用于指定绘制文本时字母之间的间距\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/letterSpacing)\n   */\n  letterSpacing: string | number\n  /**\n   * 指定绘制文本时单词之间的间距\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/wordSpacing)\n   */\n  wordSpacing: string | number\n  /**\n   * 文本时文本的对齐方式\n   * [MDN Reference](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/textAlign)\n   */\n  textAlign: CanvasTextAlign\n\n  /**\n   * 用于指定文本的行高\n   */\n  lineHeight: number\n  /**\n   * 是否开启换行\n   */\n  wordWrap: boolean\n  /**\n   * 换行宽度\n   */\n  wordWrapWidth: number\n}\n\nexport class TextStyle extends AbstractStyle implements TextStyleOptions {\n  public static defaultTextStyle: TextStyleOptions = {\n    fill: 'black',\n    stroke: {\n      width: 1,\n    },\n    fontFamily: 'Arial',\n    fontSize: 12,\n    fontStyle: 'normal',\n    fontWeight: 'normal',\n    fontStretch: 'condensed',\n    fontVariantCaps: 'normal',\n    letterSpacing: 0,\n    wordSpacing: 0,\n    textAlign: 'left',\n    filter: 'none',\n    lineHeight: 0,\n    wordWrap: false,\n    wordWrapWidth: 0,\n  }\n\n  _isStroke: boolean\n  constructor(style: Partial<TextStyleOptions> = {}) {\n    super()\n    this._isStroke = !!style.stroke\n    const fullStyle = Object.assign({}, TextStyle.defaultTextStyle, style)\n    for (const key in fullStyle) {\n      const thisKey = key as keyof typeof this\n      const data = fullStyle[key as keyof TextStyleOptions] as any\n      if (key === 'stroke') {\n        this[thisKey] = Object.assign({}, TextStyle.defaultTextStyle[key] as unknown as object, data)\n      }\n      else {\n        this[thisKey] = data\n      }\n    }\n  }\n\n  public reset() {\n    const defaultStyle = TextStyle.defaultTextStyle\n    for (const key in defaultStyle) {\n      this[key as keyof typeof this] = defaultStyle[key as keyof TextStyleOptions] as any\n    }\n    this.updateBounds()\n    this.update()\n  }\n\n  protected readonly textBaseline = 'top'\n\n  private _fontSize: TextStyleOptions['fontSize']\n  set fontSize(value) {\n    this._fontSize = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontSize() {\n    return this._fontSize\n  }\n\n  private _fontFamily: TextStyleOptions['fontFamily']\n  set fontFamily(value) {\n    this._fontFamily = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontFamily() {\n    return this._fontFamily\n  }\n\n  private _fontStyle: TextStyleOptions['fontStyle']\n\n  set fontStyle(value) {\n    this._fontStyle = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontStyle() {\n    return this._fontStyle\n  }\n\n  private _fontWeight: TextStyleOptions['fontWeight']\n\n  set fontWeight(value) {\n    this._fontWeight = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontWeight() {\n    return this._fontWeight\n  }\n\n  private _fontStretch: TextStyleOptions['fontStretch'] = TextStyle.defaultTextStyle.fontStretch\n\n  set fontStretch(value) {\n    this._fontStretch = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontStretch() {\n    return this._fontStretch\n  }\n\n  private _fontVariantCaps: TextStyleOptions['fontVariantCaps'] = TextStyle.defaultTextStyle.fontVariantCaps\n\n  set fontVariantCaps(value) {\n    this._fontVariantCaps = value\n    this.updateBounds()\n    this.update()\n  }\n\n  get fontVariantCaps() {\n    return this._fontVariantCaps\n  }\n\n  private _letterSpacing: TextStyleOptions['letterSpacing'] = TextStyle.defaultTextStyle.letterSpacing\n\n  set letterSpacing(value) {\n    this._letterSpacing = value\n    this.update()\n    this.updateBounds()\n  }\n\n  get letterSpacing() {\n    return this._letterSpacing\n  }\n\n  private _wordSpacing: TextStyleOptions['wordSpacing'] = TextStyle.defaultTextStyle.wordSpacing\n\n  set wordSpacing(value) {\n    this._wordSpacing = value\n    this.update()\n    this.updateBounds()\n  }\n\n  get wordSpacing() {\n    return this._wordSpacing\n  }\n\n  private _textAlign: TextStyleOptions['textAlign'] = TextStyle.defaultTextStyle.textAlign\n\n  set textAlign(value) {\n    this._textAlign = value\n    this.update()\n  }\n\n  get textAlign() {\n    return this._textAlign\n  }\n\n  private _lineHeight = 0\n\n  set lineHeight(value) {\n    if (this.lineHeight !== value) {\n      this._lineHeight = value\n      this.update()\n      this.updateBounds()\n    }\n  }\n\n  get lineHeight() {\n    if (!this._lineHeight) {\n      this._lineHeight = typeof this.fontSize == 'number' ? this.fontSize : Number.parseInt(`${this.fontSize}`)\n    }\n    return this._lineHeight\n  }\n\n  private _wordWrap = false\n\n  set wordWrap(value) {\n    if (this.wordWrap !== value) {\n      this._wordWrap = value\n      this.update()\n      this.updateBounds()\n    }\n  }\n\n  get wordWrap() {\n    return this._wordWrap\n  }\n\n  private _wordWrapWidth = 0\n\n  set wordWrapWidth(value) {\n    if (this.wordWrapWidth !== value) {\n      this._wordWrapWidth = value\n      this.update()\n      this.updateBounds()\n    }\n  }\n\n  get wordWrapWidth() {\n    return this._wordWrapWidth\n  }\n\n  clone() {\n    return new TextStyle({\n      fill: this.fill,\n      stroke: this.stroke,\n      fontFamily: this.fontFamily,\n      fontSize: this.fontSize,\n      fontStyle: this.fontStyle,\n      fontWeight: this.fontWeight,\n      fontStretch: this.fontStretch,\n      fontVariantCaps: this.fontVariantCaps,\n      letterSpacing: this.letterSpacing,\n      wordSpacing: this.wordSpacing,\n      textAlign: this.textAlign,\n      filter: this.filter,\n    })\n  }\n\n  render(ctx: CanvasRenderingContext2D) {\n    super.render(ctx)\n    ctx.textBaseline = 'top'\n    ctx.font = createCanvasFontString(this)\n    ctx.fontStretch = this.fontStretch\n    ctx.fontVariantCaps = this.fontVariantCaps\n    ctx.letterSpacing = formatWithPx(this.letterSpacing)\n    ctx.wordSpacing = formatWithPx(this.wordSpacing)\n    ctx.textAlign = this.textAlign\n    return this\n  }\n};\n","import type { Properties } from 'csstype'\nimport type { PointData } from '../coordinate/PointData'\nimport { ObservablePoint } from '../coordinate/ObservablePoint'\nimport { ENV, calcDiff, drawRectCompatible } from '../utils'\nimport type { App } from '../app'\nimport type { DisplayOptions } from './display'\nimport { Display } from './display'\n\nexport interface PictureOptions extends DisplayOptions {\n  /**\n   * 图片的宽高\n   */\n  size?: PointData\n  /**\n   * 图片切片的开始坐标\n   */\n  slice?: PointData\n  /**\n   * 图片切片的宽高\n   */\n  sliceSize?: PointData\n  /**\n   * 图片的缩放模式\n   */\n  objectFit?: Properties['objectFit']\n  /**\n   * 圆角\n   */\n  rounded?: number\n}\n\nexport class Picture extends Display {\n  private src = ''\n  constructor(maybeImage: HTMLImageElement | string, private options?: PictureOptions) {\n    super(options)\n    if (typeof maybeImage == 'string') {\n      if (this._env === ENV.WX) {\n        this.src = maybeImage\n      }\n      else {\n        this.image = document.createElement('img')\n        this.image.src = maybeImage\n        this.initImageEvents()\n      }\n      this.rounded = this.options?.rounded ?? 0\n    }\n    else {\n      this.image = maybeImage\n      this.initImageEvents()\n    }\n  }\n\n  onAdd(_app: App) {\n    super.onAdd(_app)\n    if (this._env !== ENV.WEB) {\n      _app.onReady(this.createImage.bind(this))\n    }\n  }\n\n  createImage() {\n    if (!this._app)\n      return\n    this.image = (this._app?.canvas as any).createImage()\n    this.image!.src = this.src\n    this.initImageEvents()\n  }\n\n  initImageEvents() {\n    if (!this.image)\n      return\n    if (this.image.complete) {\n      this._onImageComplete()\n    }\n    else {\n      this.image.addEventListener('load', () => {\n        this._onImageComplete()\n      })\n    }\n  }\n\n  private image?: HTMLImageElement\n\n  private _size = new ObservablePoint(this, 0, 0)\n\n  private _imageSize = new ObservablePoint(this, 0, 0)\n\n  set size(value: PointData) {\n    if (this.size !== value) {\n      this._size.copyFrom(value)\n      this.shouldUpdateBounds()\n    }\n  }\n\n  get size(): ObservablePoint {\n    return this._size\n  }\n\n  private _slice = new ObservablePoint(this)\n\n  set slice(value: PointData) {\n    if (this.slice !== value) {\n      this._slice.copyFrom(value)\n      this.shouldUpdateBounds()\n    }\n  }\n\n  get slice(): ObservablePoint {\n    return this._slice\n  }\n\n  private _sliceSize = new ObservablePoint(this)\n\n  set sliceSize(value: PointData) {\n    if (this.sliceSize !== value) {\n      this._sliceSize.copyFrom(value)\n      this._onUpdate()\n      this.shouldUpdateBounds()\n    }\n  }\n\n  get sliceSize(): ObservablePoint {\n    return this._sliceSize\n  }\n\n  private _objectFit: Properties['objectFit'] = 'none'\n\n  set objectFit(value) {\n    if (this.objectFit !== value) {\n      this._objectFit = value\n      this.shouldUpdateBounds()\n      this._onUpdate()\n    }\n  }\n\n  get objectFit() {\n    return this._objectFit\n  }\n\n  private _rounded = 0\n\n  set rounded(value) {\n    value = value <= 0 ? 0 : value\n    if (this.rounded !== value) {\n      this._rounded = value\n      this._onUpdate()\n    }\n  }\n\n  _onUpdate(_point?: ObservablePoint | undefined) {\n    if (this._complete)\n      super._onUpdate(_point)\n  }\n\n  get rounded() {\n    return this._rounded\n  }\n\n  private _complete = false\n\n  private _onImageComplete() {\n    if (!this.image)\n      return\n    this._imageSize.set(\n      this.image.width,\n      this.image.height,\n    )\n\n    this.size = this.options?.size ?? {\n      x: this.image.width,\n      y: this.image.height,\n    }\n\n    this.slice = this.options?.slice ?? this.slice\n\n    this.sliceSize = this.options?.sliceSize ?? {\n      x: this.size.x,\n      y: this.size.y,\n    }\n\n    this.objectFit = this.options?.objectFit ?? this.objectFit\n\n    this.rounded = this.options?.rounded ?? this.rounded\n    this._complete = true\n    this.emit('ready')\n    this._onUpdate()\n    this.shouldUpdateBounds()\n  }\n\n  get _shouldUpdate(): boolean {\n    return true\n  }\n\n  private get _isSlice() {\n    return (!!this.slice.x || !!this.slice.y) || !this.sliceSize.equals(this.size)\n  }\n\n  private renderRoundedClip(ctx: CanvasRenderingContext2D, position: PointData, size: PointData) {\n    drawRectCompatible(ctx, position, size, this.rounded)\n    ctx.clip()\n  }\n\n  protected _render(ctx: CanvasRenderingContext2D): void {\n    if (!this.image || !this._complete) {\n      return\n    }\n    if (!this._isSlice) {\n      const _size = this.size.clone()\n      const _position = this.position.clone()\n      const scaleDiff = _size.x / this._imageSize.x\n      const diffSize = calcDiff([this._imageSize.x, this._imageSize.y])\n      const diff = diffSize * scaleDiff\n      const slim = this._imageSize.x < this._imageSize.y\n      const fat = this._imageSize.x > this._imageSize.y\n      if (slim || fat) {\n        switch (this.objectFit) {\n          case 'contain':\n            if (slim) {\n              this.position.set(this.position.x - diff / 2, this.position.y)\n              this.size.set(this.size.x - diff, this.size.y)\n            }\n            else {\n              this.position.set(this.position.x, this.position.y + diff / 2)\n              this.size.set(this.size.x, this.size.y - diff)\n            }\n            // ctx.beginPath()\n            // if (this.rounded) {\n            //   ctx.roundRect(this.x, this.y, this.size.x, this.size.y, this.rounded)\n            // }\n            // else {\n            //   ctx.rect(this.x, this.y, this.size.x, this.size.y)\n            // }\n            // ctx.clip()\n            this.renderRoundedClip(ctx, this.position, this.size)\n            break\n          case 'cover':\n            if (slim) {\n              this.position.set(this.position.x + diff / 2, this.position.y)\n              this.size.set(this.size.x + diff, this.size.y)\n            }\n            else {\n              this.position.set(this.position.x - diff / 2, this.position.y)\n              this.size.set(this.size.x + diff, this.size.y)\n            }\n            // ctx.beginPath()\n            // if (this.rounded) {\n            //   ctx.roundRect(_position.x, _position.y, _size.x, _size.y, this.rounded)\n            // }\n            // else {\n            //   ctx.rect(_position.x, _position.y, _size.x, _size.y)\n            // }\n            // ctx.clip()\n            this.renderRoundedClip(ctx, _position, _size)\n            break\n          default:\n            this.renderRoundedClip(ctx, this.position, this.size)\n        }\n      }\n      ctx.drawImage(\n        this.image,\n        this.position.x,\n        this.position.y,\n        this.size.x,\n        this.size.y,\n      )\n      this.position = _position\n      this.size = _size\n    }\n    else {\n      const args = [\n        this.image,\n        this.slice.x,\n        this.slice.y,\n        this.sliceSize.x,\n        this.sliceSize.y,\n        this.x,\n        this.y,\n        this.size.x,\n        this.size.y,\n      ] as const\n\n      // ctx.beginPath()\n      // console.log(this.rounded)\n      // if (this.rounded) {\n      //   ctx.roundRect(this.x, this.y, this.size.x, this.size.y, this.rounded)\n      // }\n      // else {\n      //   ctx.rect(this.x, this.y, this.size.x, this.size.y)\n      // }\n      // ctx.clip()\n      this.renderRoundedClip(ctx, this.position, this.size)\n      ctx.drawImage(...args)\n    }\n  }\n\n  protected transformWidth: number = 0\n  protected transformHeight: number = 0\n  protected updateTransformBounds(): void {\n    this.transformWidth = this.size.x\n    this.transformHeight = this.size.y\n  }\n}\n","import type { IAbstractStyle, InputColor, StrokeInput } from '../style/abstract-style'\n// import type { FunctionKeys } from '../types'\nimport { ENV, calcDiff, createProxy, drawRectCompatible } from '../utils'\nimport type { DisplayOptions } from './display'\nimport { Display } from './display'\n\n// type CanvasRenderingContext2DMethods = FunctionKeys<CanvasRenderingContext2D>\ninterface PathData<T extends keyof CanvasRenderingContext2D> {\n  action: T\n  args: any[]\n}\n\ntype Methods =\n  | 'beginPath'\n  | 'closePath'\n  | 'moveTo'\n  | 'fill'\n  | 'stroke'\n  | 'lineTo' //\n  | 'rect' //\n  | 'roundRect' //\n  | 'fillRect' //\n  | 'strokeRect'\n  | 'arc' //\n  | 'arcTo' //\n  | 'bezierCurveTo' //\n  | 'ellipse'\n  | 'lineCap'\n  | 'lineJoin'\n\ntype PathInstruction = PathData<Methods>\ninterface _ShapeOptions extends DisplayOptions {\n\n}\n\ninterface IShape {\n  beginPath: () => Shape\n  closePath: () => Shape\n  moveTo: (...args: Parameters<CanvasRenderingContext2D['moveTo']>) => Shape\n  lineTo: (...args: Parameters<CanvasRenderingContext2D['lineTo']>) => Shape\n  stroke: (value?: StrokeInput | InputColor) => Shape\n  fill: (color?: InputColor) => Shape\n  rect: (...args: Parameters<CanvasRenderingContext2D['rect']>) => Shape\n  roundRect: (...args: Parameters<CanvasRenderingContext2D['roundRect']>) => Shape\n  arc: (...args: Parameters<CanvasRenderingContext2D['arc']>) => Shape\n  arcTo: (...args: Parameters<CanvasRenderingContext2D['arcTo']>) => Shape\n  bezierCurveTo: (...args: Parameters<CanvasRenderingContext2D['bezierCurveTo']>) => Shape\n  ellipse: (...args: Parameters<CanvasRenderingContext2D['ellipse']>) => Shape\n  fillRect: (...args: Parameters<CanvasRect['fillRect']>) => Shape\n  strokeRect: (...args: Parameters<CanvasRect['strokeRect']>) => Shape\n  lineCap: (...args: [CanvasRenderingContext2D['lineCap']]) => void\n  lineJoin: (...args: [CanvasRenderingContext2D['lineJoin']]) => void\n}\n\nexport type ShapeOptions = Partial<_ShapeOptions>\n\nexport class Shape extends Display implements IShape {\n  constructor(options: ShapeOptions = {}) {\n    super(options)\n    this.emit('ready')\n    this._onUpdate()\n  }\n\n  private addPath(...items: PathInstruction[]) {\n    this.pathInstruction.push(...items)\n    this.shouldUpdateBounds()\n  }\n\n  beginPath(): Shape {\n    this.addPath({\n      action: 'beginPath',\n      args: [],\n    })\n    return this\n  }\n\n  closePath() {\n    this.addPath({\n      action: 'closePath',\n      args: [],\n    })\n    return this\n  }\n\n  lineCap(cap: 'butt' | 'round' | 'square') {\n    this.addPath({\n      action: 'lineCap',\n      args: [cap],\n    })\n    return this\n  }\n\n  lineJoin(join: 'bevel' | 'miter' | 'round') {\n    this.addPath({\n      action: 'lineJoin',\n      args: [join],\n    })\n    return this\n  }\n\n  moveTo(x: number, y: number) {\n    this.addPath({\n      action: 'moveTo',\n      args: [x, y],\n    })\n    return this\n  }\n\n  lineTo(x: number, y: number) {\n    this.addPath({\n      action: 'lineTo',\n      args: [x, y],\n    })\n    return this\n  }\n\n  rect(x: number, y: number, w: number, h: number) {\n    this.addPath({\n      action: 'rect',\n      args: [x, y, w, h],\n    })\n    return this\n  }\n\n  roundRect(\n    x: number,\n    y: number,\n    w: number,\n    h: number,\n    radii?: number | DOMPointInit | Iterable<number | DOMPointInit>,\n  ) {\n    this.addPath({\n      action: 'roundRect',\n      args: [x, y, w, h, radii],\n    })\n    return this\n  }\n\n  arc(\n    x: number,\n    y: number,\n    radius: number,\n    startAngle: number = 0,\n    endAngle: number = 2 * Math.PI,\n    counterclockwise?: boolean,\n  ) {\n    this.addPath({\n      action: 'arc',\n      args: [x, y, radius, startAngle, endAngle, counterclockwise],\n    })\n    return this\n  }\n\n  arcTo(x1: number, y1: number, x2: number, y2: number, radius: number) {\n    this.addPath({\n      action: 'arcTo',\n      args: [x1, y1, x2, y2, radius],\n    })\n    return this\n  }\n\n  bezierCurveTo(\n    cp1x: number,\n    cp1y: number,\n    cp2x: number,\n    cp2y: number,\n    x: number,\n    y: number,\n  ) {\n    this.addPath({\n      action: 'bezierCurveTo',\n      args: [cp1x, cp1y, cp2x, cp2y, x, y],\n    })\n    return this\n  }\n\n  ellipse(\n    x: number,\n    y: number,\n    radiusX: number,\n    radiusY: number,\n    rotation: number,\n    startAngle: number,\n    endAngle: number,\n    counterclockwise?: boolean,\n  ) {\n    this.addPath({\n      action: 'ellipse',\n      args: [x, y, radiusX, radiusY, rotation, startAngle, endAngle, counterclockwise],\n    })\n    return this\n  }\n\n  fillRect(x: number, y: number, w: number, h: number) {\n    this.addPath({\n      action: 'fillRect',\n      args: [x, y, w, h],\n    })\n    return this\n  }\n\n  strokeRect(x: number, y: number, w: number, h: number) {\n    this.addPath({\n      action: 'strokeRect',\n      args: [x, y, w, h],\n    })\n    return this\n  }\n\n  private pathInstruction: PathInstruction[] = []\n  get _shouldUpdate(): boolean {\n    const actions = this.pathInstruction.map(item => item.action)\n    if (actions.includes('fill')\n      || actions.includes('stroke')) {\n      return true\n    }\n    return false\n  }\n\n  protected _render(ctx: CanvasRenderingContext2D): void {\n    if (!ctx) {\n      throw new Error('CanvasRenderingContext2D is null or undefined')\n    }\n    for (let index = 0; index < this.pathInstruction.length; index++) {\n      const { action, args } = this.pathInstruction[index]\n      if (action === 'fill') {\n        if (args[0]) {\n          ctx.fillStyle = args[0]\n        }\n        else if (this.fillStyle) {\n          ctx.fillStyle = this.fillStyle\n        }\n        ctx.fill()\n      }\n      else if (action === 'stroke') {\n        if (args[0]) {\n          const strokeInput = args[0] as StrokeInput | InputColor\n          if (typeof strokeInput === 'string'\n            || (typeof CanvasGradient !== 'undefined' && strokeInput instanceof CanvasGradient)\n            || (typeof CanvasPattern !== 'undefined' && strokeInput instanceof CanvasPattern)\n          ) {\n            ctx.strokeStyle = strokeInput\n            ctx.lineWidth = this.strokeStyle.width ?? 1\n          }\n          else {\n            const _strokeInput = strokeInput as StrokeInput\n            const color = _strokeInput.color ?? this.strokeStyle.color\n            if (color)\n              ctx.strokeStyle = color\n\n            const width = _strokeInput.width ?? this.strokeStyle.width\n\n            if (width)\n              ctx.lineWidth = width\n\n            if (_strokeInput.dash) {\n              ctx.setLineDash(_strokeInput.dash)\n            }\n            else {\n              ctx.setLineDash([])\n            }\n          }\n        }\n        else {\n          if (this.strokeStyle.color)\n            ctx.strokeStyle = this.strokeStyle.color\n          if (this.strokeStyle.width)\n            ctx.lineWidth = this.strokeStyle.width\n          if (this.strokeStyle.dash) {\n            ctx.setLineDash(this.strokeStyle.dash)\n          }\n          else {\n            ctx.setLineDash([])\n          }\n        }\n        ctx.stroke()\n      }\n      else if (['lineCap', 'lineJoin'].includes(action)) {\n        ctx[action] = args[0]\n      }\n      else if (action === 'roundRect' && this._env === ENV.WX) {\n        drawRectCompatible(ctx, { x: args[0], y: args[1] }, { x: args[2], y: args[3] }, args[4])\n      }\n      else {\n        if (!(action in ctx)) {\n          throw new Error(`CanvasRenderingContext2D has no method ${action}`)\n        }\n        else {\n          ;(ctx[action] as (...args: any[]) => void)(...args)\n        }\n      }\n    }\n  }\n\n  private _strokeStyle: StrokeInput = {}\n\n  set strokeStyle(value: StrokeInput | InputColor) {\n    if (value === this._strokeStyle)\n      return\n    if (\n      typeof value === 'string'\n      || (typeof CanvasGradient !== 'undefined' && value instanceof CanvasGradient)\n      || (typeof CanvasPattern !== 'undefined' && value instanceof CanvasPattern)\n    ) {\n      this._strokeStyle = createProxy({\n        ...this._strokeStyle,\n        color: value,\n      }, () => {\n        this._onUpdate()\n      })\n    }\n    else {\n      this._strokeStyle = createProxy(value as StrokeInput, () => {\n        this._onUpdate()\n      })\n      this._onUpdate()\n    }\n  }\n\n  get strokeStyle(): StrokeInput {\n    return this._strokeStyle\n  }\n\n  protected transformWidth = 0\n  protected transformHeight = 0\n  protected updateTransformBounds(): void {\n    // 所有坐标的最大值放进来\n    const allX: number[] = []\n    const allY: number[] = []\n    for (let index = 0; index < this.pathInstruction.length; index++) {\n      const { action, args } = this.pathInstruction[index]\n      switch (action) {\n        case 'lineTo':\n          allX.push(args[0])\n          allY.push(args[1])\n          break\n        case 'fillRect':\n        case 'strokeRect':\n        case 'roundRect':\n        case 'rect':{\n          let strokeWeight = 0\n          if (action === 'strokeRect') {\n            strokeWeight = this.strokeStyle.width ?? 1\n          }\n          allX.push(args[0])\n          allY.push(args[1])\n\n          allX.push(args[0] + args[2] + strokeWeight)\n          allY.push(args[1] + args[3] + strokeWeight)\n          break\n        }\n        case 'arc':\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[2])\n          break\n        case 'arcTo':\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[2])\n          break\n        case 'bezierCurveTo':\n          allX.push(args[2] + args[4])\n          allY.push(args[3] + args[5])\n          break\n        case 'ellipse':\n          allX.push(args[0] + args[2])\n          allY.push(args[1] + args[3])\n      }\n    }\n    this.transformWidth = calcDiff(allX)\n    this.transformHeight = calcDiff(allY)\n  }\n\n  private _fillStyle: InputColor | null = null\n\n  set fillStyle(value) {\n    this._fillStyle = value\n    this._onUpdate()\n  }\n\n  get fillStyle() {\n    return this._fillStyle\n  }\n\n  fill(color?: IAbstractStyle['fill']) {\n    if (color) {\n      this.addPath({\n        action: 'fill',\n        args: [color],\n      })\n    }\n    return this\n  }\n\n  stroke(value?: StrokeInput | InputColor) {\n    this.addPath({\n      action: 'stroke',\n      args: value ? [value] : [],\n    })\n    return this\n  }\n\n  private _filter = 'none'\n\n  set filter(value) {\n    this._filter = value\n    this._onUpdate()\n  }\n\n  get filter() {\n    return this._filter\n  }\n}\n","import type { TextStyleOptions } from '../style/text-style'\nimport { TextStyle } from '../style/text-style'\nimport type { DisplayOptions } from './display'\nimport { Display } from './display'\n\nexport interface TextOptions extends DisplayOptions {\n  /**\n   * 文本\n   */\n  text: string\n  /**\n   * 文本样式\n   */\n  style?: Partial<TextStyleOptions> | TextStyle\n}\n\nexport class Text extends Display {\n  constructor(options: TextOptions) {\n    super(options)\n    if (options.style)\n      this.style = options.style\n    this.text = options.text ?? ''\n    this.emit('ready')\n    this._onUpdate()\n  }\n\n  private _style = new TextStyle()\n\n  set style(style: Partial<TextStyleOptions> | TextStyle) {\n    style = style || {}\n    this._style?.off('update', this._onUpdate, this)\n    this._style?.off('updateBounds', this.shouldUpdateBounds, this)\n    if (style instanceof TextStyle) {\n      this._style = style\n    }\n    else {\n      this._style = new TextStyle(style)\n    }\n    this._style.on('update', this._onUpdate, this)\n    this._style?.on('updateBounds', this.shouldUpdateBounds, this)\n    this._onUpdate()\n  }\n\n  get style(): TextStyle {\n    return this._style\n  }\n\n  private _text = ''\n\n  set text(text) {\n    if (this._text === text)\n      return\n    this._text = text\n    this._onUpdate()\n  }\n\n  get text() {\n    return this._text\n  }\n\n  get _shouldUpdate(): boolean {\n    return !!(this.style.fill) || !!(this.style.stroke.color && this.style.stroke.width)\n  }\n\n  getSplitText(ctx: CanvasRenderingContext2D) {\n    const texts = this.text.split('')\n    const splitText = []\n    let multilineText: string[] = []\n    for (let i = 0; i < texts.length; i++) {\n      const currentStr = texts[i]\n      multilineText.push(currentStr)\n      const rowStr = multilineText.join('')\n      if (ctx.measureText(rowStr).width > this.style.wordWrapWidth) {\n        multilineText.pop()\n        splitText.push(multilineText.join(''))\n        multilineText = [currentStr]\n        continue\n      }\n      if (i === texts.length - 1) {\n        splitText.push(rowStr)\n      }\n    }\n    return splitText\n  }\n\n  _render(ctx: CanvasRenderingContext2D) {\n    if (this.style.fill || (this.style.stroke?.color && this.style.stroke?.width)) {\n      this.style.render(ctx)\n      // 绘制单行文本\n      if (!this.style.wordWrap || !this.style.wordWrapWidth) {\n        if (this.style.fill) {\n          ctx.fillText(this.text, this.position.x, this.position.y)\n        }\n        if (this.style.stroke?.color && this.style.stroke?.width) {\n          ctx.strokeText(this.text, this.position.x, this.position.y)\n        }\n      }\n      else {\n        const splitText = this.getSplitText(ctx)\n        for (let i = 0; i < splitText.length; i++) {\n          const text = splitText[i]\n          if (this.style.fill) {\n            ctx.strokeText(text, this.position.x, this.position.y + i * this.style.lineHeight)\n          }\n          if (this.style.stroke?.color && this.style.stroke?.width) {\n            ctx.strokeText(text, this.position.x, this.position.y + i * this.style.lineHeight)\n          }\n        }\n      }\n    }\n  }\n\n  protected transformWidth = 0\n\n  protected transformHeight = 0\n  protected updateTransformBounds() {\n    if (!this._app)\n      return\n    this._app.wrapperRender((ctx) => {\n      this.style.render(ctx)\n      if (!this.style.wordWrap || !this.style.wordWrapWidth) {\n        const measure = ctx.measureText(this.text)\n        this.transformWidth = measure.width\n        let height = Math.max(...[\n          measure.actualBoundingBoxDescent - measure.actualBoundingBoxAscent,\n          typeof this.style.fontSize == 'number' ? this.style.fontSize : Number.parseInt(`${this.style.fontSize}`),\n        ])\n        if (this.style.stroke && this.style.stroke.width) {\n          height += this.style.stroke.width\n        }\n        this.transformHeight = height\n      }\n      else {\n        const splitText = this.getSplitText(ctx)\n        this.transformWidth = this.style.wordWrapWidth\n        if (!splitText.length) {\n          this.transformHeight = 0\n          return\n        }\n        const measure = ctx.measureText(this.getSplitText(ctx)[0])\n        const lineHeight = this.style.lineHeight\n        let height = Math.max(...[\n          measure.actualBoundingBoxDescent - measure.actualBoundingBoxAscent,\n          lineHeight,\n        ])\n        if (this.style.stroke && this.style.stroke.width) {\n          height += this.style.stroke.width\n        }\n        if (splitText.length > 1) {\n          this.transformHeight = (splitText.length - 1) * lineHeight + height\n        }\n      }\n    })\n  }\n};\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","exports","ENV","formatWithPx","val","calcDiff","numbers","reduce","a","b","calcMax","calcMin","ensureBetween","input","min","max","createProxy","value","cb","Proxy","set","target","property","newValue","getEnv","uni","UNI_APP","wx","WX","window","document","WEB","UNKNOWN","drawRectCompatible","ctx","position","size","rounded","Math","x","y","beginPath","moveTo","arcTo","closePath","roundRect","rect","Ticker","autoStart","requestAnimationFrame","cancelAnimationFrame","myReq","isRunning","handler","_env","constructor","init","canvas","bind","start","add","removeAll","remove","index","indexOf","splice","update","stop","forEach","performance","now","ObservablePoint","_x","_y","_observer","observer","clone","_onUpdate","copyFrom","p","copyTo","equals","Symbol","iterator","step","properties","next","done","defaultSkew","defaultPivot","defaultAnchor","defaultScale","Display","options","super","visible","scale","skew","pivot","shadow","_shadow","rotation","anchor","alpha","__shouldUpdate","shouldUpdate","_shouldUpdate","_dirty","dirty","_position","_scale","_skew","_alpha","_rotation","_anchor","_pivot","_point","_app","_visible","_shouldUpdateBounds","shouldUpdateBounds","_baseRender","blur","color","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","render","updateTransformBounds","globalAlpha","dpr","scaleX","scaleY","skewX","skewY","positionX","positionY","pivotX","pivotY","cos","sin","anchorX","anchorY","originX","transformWidth","originY","transformHeight","dx","dy","setTransform","_render","resetTransform","_renderId","height","width","onAdd","onRemove","addTo","app","destroy","AbstractStyle","_fill","fill","_stroke","stroke","CanvasGradient","CanvasPattern","_filter","filter","updateBounds","lineWidth","strokeStyle","fillStyle","TextStyle","static","fontFamily","fontSize","fontStyle","fontWeight","fontStretch","fontVariantCaps","letterSpacing","wordSpacing","textAlign","lineHeight","wordWrap","wordWrapWidth","_isStroke","style","fullStyle","assign","defaultTextStyle","key","thisKey","data","reset","defaultStyle","textBaseline","_fontSize","_fontFamily","_fontStyle","_fontWeight","_fontStretch","_fontVariantCaps","_letterSpacing","_wordSpacing","_textAlign","_lineHeight","Number","parseInt","_wordWrap","_wordWrapWidth","font","createCanvasFontString","_ready","ticker","validateAppOptions","initDpr","initTicker","initCanvas","onReady","appOptions","console","error","devicePixelRatio","querySelector","query","createSelectorQuery","select","fields","node","exec","res","initCanvasSize","createElement","getContext","beforeRender","save","afterRender","restore","children","objects","object","delIndex","isDirty","e","every","clearRect","shouldRender","child","shift","toDataURL","type","quality","toDataURLAsync","Promise","resolve","wrapperRender","src","maybeImage","image","initImageEvents","createImage","complete","_onImageComplete","addEventListener","_size","_imageSize","_slice","_sliceSize","sliceSize","_objectFit","objectFit","_rounded","_complete","_isSlice","renderRoundedClip","clip","drawImage","scaleDiff","diff","slim","fat","addPath","items","pathInstruction","action","lineCap","cap","lineJoin","join","lineTo","w","h","radii","arc","radius","startAngle","endAngle","PI","counterclockwise","x1","y1","x2","y2","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","ellipse","radiusX","radiusY","fillRect","strokeRect","actions","map","item","includes","Error","strokeInput","_strokeInput","dash","setLineDash","_strokeStyle","allX","allY","strokeWeight","_fillStyle","text","_style","_text","getSplitText","texts","split","splitText","multilineText","currentStr","rowStr","measureText","pop","strokeText","fillText","measure","actualBoundingBoxDescent","actualBoundingBoxAscent"],"mappings":"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","x_google_ignoreList":[0]}