function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var e={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function s(){}function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function h(t,e,s,h,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var r=new n(s,h||t,o),a=i?i+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],r]:t._events[a].push(r):(t._events[a]=r,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function r(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),r.prototype.eventNames=function(){var t,s,n=[];if(0===this._eventsCount)return n;for(s in t=this._events)e.call(t,s)&&n.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},r.prototype.listeners=function(t){var e=i?i+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,h=s.length,o=new Array(h);n<h;n++)o[n]=s[n].fn;return o},r.prototype.listenerCount=function(t){var e=i?i+t:t,s=this._events[e];return s?s.fn?1:s.length:0},r.prototype.emit=function(t,e,s,n,h,o){var r=i?i+t:t;if(!this._events[r])return!1;var a,l,d=this._events[r],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,s),!0;case 4:return d.fn.call(d.context,e,s,n),!0;case 5:return d.fn.call(d.context,e,s,n,h),!0;case 6:return d.fn.call(d.context,e,s,n,h,o),!0}for(l=1,a=new Array(c-1);l<c;l++)a[l-1]=arguments[l];d.fn.apply(d.context,a)}else{var p,u=d.length;for(l=0;l<u;l++)switch(d[l].once&&this.removeListener(t,d[l].fn,void 0,!0),c){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,e);break;case 3:d[l].fn.call(d[l].context,e,s);break;case 4:d[l].fn.call(d[l].context,e,s,n);break;default:if(!a)for(p=1,a=new Array(c-1);p<c;p++)a[p-1]=arguments[p];d[l].fn.apply(d[l].context,a)}}return!0},r.prototype.on=function(t,e,i){return h(this,t,e,i,!1)},r.prototype.once=function(t,e,i){return h(this,t,e,i,!0)},r.prototype.removeListener=function(t,e,s,n){var h=i?i+t:t;if(!this._events[h])return this;if(!e)return o(this,h),this;var r=this._events[h];if(r.fn)r.fn!==e||n&&!r.once||s&&r.context!==s||o(this,h);else{for(var a=0,l=[],d=r.length;a<d;a++)(r[a].fn!==e||n&&!r[a].once||s&&r[a].context!==s)&&l.push(r[a]);l.length?this._events[h]=1===l.length?l[0]:l:o(this,h)}return this},r.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new s,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=i,r.EventEmitter=r,t.exports=r}(e);var i,s=t(e.exports);function n(t){return"string"==typeof t?t:`${t}px`}function h(t){return function(t){return t.reduce(((t,e)=>t>e?t:e))}(t)-function(t){return t.reduce(((t,e)=>t<e?t:e))}(t)}function o(t,e=0,i=1){return t<=e?e:t>=i?i:t}function r(t,e){return new Proxy(t,{set:(t,i,s)=>(t[i]=s,e?.(i,s),!0)})}function a(){return"undefined"!=typeof uni?i.UNI_APP:"undefined"!=typeof wx?i.WX:"undefined"!=typeof window&&void 0!==window.document?i.WEB:i.UNKNOWN}function l(t,e,s,n){n=n??0,n=Math.min(n,s.x/2,s.y/2),t.beginPath(),n?a()===i.WX?(t.moveTo(e.x+n,e.y),t.arcTo(e.x+s.x,e.y,e.x+s.x,e.y+n,n),t.arcTo(e.x+s.x,e.y+s.y,e.x+s.x-n,e.y+s.y,n),t.arcTo(e.x,e.y+s.y,e.x,e.y+s.y-n,n),t.arcTo(e.x,e.y,e.x+n,e.y,n),t.closePath()):t.roundRect(e.x,e.y,s.x,s.y,n):t.rect(e.x,e.y,s.x,s.y)}!function(t){t.WX="WX",t.WEB="WEB",t.UNKNOWN="UNKNOWN",t.UNI_APP="UNI_APP"}(i||(i={}));class d extends s{options;ctx;_ready=!1;_env=a();canvas;ticker;dpr=1;width=0;height=0;constructor(t={}){super(),this.options=t,this.validateAppOptions(t),this.initDpr(),this.initTicker(),this.initCanvas()}onReady(t){this._ready?t():this.once("ready",(()=>{t()}))}validateAppOptions(t){this._env!==i.WX||t.canvas||console.error("当前为非document环境, 无法使用 document.createElement('canvas'),\n 请传入canvas元素或者canvasId")}initDpr(){const{dpr:t=!0}=this.options;this.dpr="boolean"==typeof t?window.devicePixelRatio??1:t}initCanvas(){const t=this.options.canvas;if(t)if("string"==typeof t)if(this._env===i.WEB)this.canvas=document.querySelector(t);else{let t;t=this._env===i.WX?wx.createSelectorQuery():uni.createSelectorQuery(),t.select("#myCanvas").fields({node:!0,size:!0},void 0).exec((t=>{const e=t[0].node;this.canvas=e,this.initCanvasSize()}))}else this.canvas=t,this.initCanvasSize();else this.canvas=document.createElement("canvas"),this.initCanvasSize()}initCanvasSize(){const{width:t=300,height:e=150}=this.options;this.canvas&&(this.canvas.style?(this.canvas.style.width=n(t),this.canvas.style.height=n(e),this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr):(this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr),this.width=t,this.height=t,this.ctx=this.canvas.getContext("2d"),this._ready=!0,this.emit("ready"),this.ticker.init(this.canvas,!0))}initTicker(){this.ticker=new c,this.ticker.add(this.update.bind(this))}beforeRender(){this.ctx.save()}afterRender(){this.ctx.restore()}children=[];add(...t){for(let e=0;e<t.length;e++){const i=t[e];this.children.push(i),i.onAdd(this)}}remove(...t){for(let e=0;e<t.length;e++){const i=t[e],s=this.children.indexOf(i);-1!==s&&(i.onRemove(),this.children.splice(s,1))}}update(){if(!this.children.length)return;const t=!![...this.children.filter((t=>t.dirty))].length;if(this.children.every((t=>t._renderId>0))&&this.children.length&&this.emit("render"),!t)return;this.ctx.clearRect(-this.canvas.width,-this.canvas.height,2*this.canvas.width,2*this.canvas.height);const e=[...this.children].filter((t=>t.shouldUpdate));for(;e.length;){this.beforeRender();const t=e.shift();t.render(this.ctx),t.dirty=!1,t._renderId++,this.afterRender()}}toDataURL(t,e){return this.canvas.toDataURL(t,e)}toDataURLAsync(t,e){return new Promise((i=>{this.once("render",(()=>{i(this.toDataURL(t,e))}))}))}wrapperRender(t){this.beforeRender(),t(this.ctx),this.afterRender()}}class c{autoStart;requestAnimationFrame;cancelAnimationFrame;myReq=0;isRunning=!1;handler=[];_env=a();constructor(t=!0){this.autoStart=t}init(t,e){this._env===i.WX?(this.requestAnimationFrame=t.requestAnimationFrame.bind(this),this.cancelAnimationFrame=t.requestAnimationFrame.bind(this)):(this.requestAnimationFrame=requestAnimationFrame.bind(this),this.cancelAnimationFrame=cancelAnimationFrame.bind(this)),e&&this.start()}add(t){this.handler.push(t)}removeAll(){this.handler=[]}remove(t){const e=this.handler.indexOf(t);-1!==e&&this.handler.splice(e,1)}start(){this.isRunning=!0,this.myReq=this.requestAnimationFrame(this.update.bind(this))}stop(){this.isRunning&&this.myReq&&(this.cancelAnimationFrame?.(this.myReq),this.isRunning=!1)}update(){this.isRunning&&(this.myReq=this.requestAnimationFrame(this.update.bind(this)),this.handler.forEach((t=>t(performance.now()))))}}class p{_x;_y;_observer;constructor(t,e,i){this._x=e||0,this._y=i||0,this._observer=t}clone(t){return new p(t??this._observer,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this._observer?._onUpdate(this)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this._observer?._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer?._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer?._onUpdate(this))}[Symbol.iterator](){let t=0;const e=[this.x,this.y];return{next:()=>t<e.length?{value:e[t++],done:!1}:{done:!0,value:void 0}}}}const u=new p(null),f=new p(null),_=new p(null),y=new p(null,1,1);class g extends s{_env=a();constructor(t={}){super(),this.visible=t.visible??!0,t.position?this.position=t.position:(this.x=t.x??0,this.y=t.y??0),this.scale=t.scale??1,this.skew=t.skew??{x:0,y:0},this.pivot=t.pivot??0,this.shadow=t.shadow??this._shadow,this.rotation=t.rotation??0,this.anchor=t.anchor??0,this.alpha=t.alpha??1}get __shouldUpdate(){return!(!this.visible||0===this.scale.x||0===this.scale.y||0===this.alpha)}get shouldUpdate(){return this.__shouldUpdate&&this._shouldUpdate}_dirty=!1;set dirty(t){this._dirty!==t&&(this._dirty=t)}get dirty(){return this._dirty}set x(t){this.x!==t&&(this.position.x=t)}get x(){return this.position.x}set y(t){this.y!==t&&(this.position.y=t)}get y(){return this.position.y}_position=new p(this,0,0);set position(t){this.position!==t&&this._position.copyFrom(t)}get position(){return this._position}_scale=y;set scale(t){this._scale===y&&(this._scale=new p(this,1,1)),"number"==typeof t?this._scale.set(t):this._scale.copyFrom(t)}get scale(){return this._scale===y&&(this._scale=new p(this,1,1)),this._scale}_skew=u;set skew(t){this._skew===u&&(this._skew=new p(this)),this._skew.copyFrom(t)}get skew(){return this._skew===u&&(this._skew=new p(this,0,0)),this._skew}_alpha=1;set alpha(t){this.alpha!==t&&(this._alpha=t,this._onUpdate())}get alpha(){return this._alpha}_rotation=0;set rotation(t){this.rotation!==t&&(this._rotation=t,this._onUpdate())}get rotation(){return this._rotation}_anchor=_;set anchor(t){this._anchor===_&&(this._anchor=new p(this,0,0)),"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get anchor(){return this._anchor===_&&(this._anchor=new p(this)),this._anchor}_pivot=f;set pivot(t){this._pivot===f&&(this._pivot=new p(this,0,0)),"number"==typeof t?this._pivot.set(t):this._pivot.copyFrom(t)}get pivot(){return this._pivot===f&&(this._pivot=new p(this)),this._pivot}_shadow={x:0,y:0};set shadow(t){t!==this._shadow&&t&&(this._shadow=r(t,(()=>{this._onUpdate()})),this._onUpdate())}get shadow(){return this._shadow}_onUpdate(t){this.dirty=!0}_app=null;_visible=!0;get visible(){return this._visible}set visible(t){this._visible=t,this._onUpdate()}_shouldUpdateBounds=!0;shouldUpdateBounds(){this._shouldUpdateBounds=!0}_baseRender(t){(this.shadow?.x||this.shadow?.y)&&(this.shadow?.blur||this.shadow?.color)&&(this.shadow.color&&(t.shadowColor=this.shadow.color),this.shadow.blur&&(t.shadowBlur=this.shadow.blur),this.shadow.x&&(t.shadowOffsetX=this.shadow.x),this.shadow.y&&(t.shadowOffsetY=this.shadow.y))}render(t){this._shouldUpdateBounds&&(this.updateTransformBounds(),this._shouldUpdateBounds=!1),1!==this.alpha&&(t.globalAlpha=this.alpha);const e=this._app?.dpr??1,i=this.scale.x*e,s=this.scale.y*e,n=this.skew.x,h=this.skew.y,r=this.position.x*e,a=this.position.y*e,l=this.pivot.x,d=this.pivot.y,c=this.rotation,p=Math.cos(c),u=Math.sin(c),f=o(this.anchor.x,0,1),_=o(this.anchor.y,0,1),y=this.transformWidth*f,g=this.transformHeight*_,m=r-(l+y)*p*i+(d+g)*u*s,x=a-(l+y)*u*i-(d+g)*p*s;t.setTransform(i*p+h*-u,i*u+h*p,n*p+s*-u,n*u+s*p,m,x);const v=this.position.clone();this.position.set(0),this._baseRender(t),this._render(t),this.position=v,t.resetTransform()}_renderId=0;get height(){return this.transformHeight}get width(){return this.transformWidth}onAdd(t){this._app=t,this._onUpdate()}onRemove(){this._app=null,this._onUpdate()}addTo(t){return t.add(this),this}destroy(){this.removeAllListeners()}}class m extends g{options;src="";constructor(t,e){super(e),this.options=e,"string"==typeof t?(this._env===i.WX?this.src=t:(this.image=document.createElement("img"),this.image.src=t,this.initImageEvents()),this.rounded=this.options?.rounded??0):(this.image=t,this.initImageEvents())}onAdd(t){super.onAdd(t),this._env!==i.WEB&&t.onReady(this.createImage.bind(this))}createImage(){this._app&&(this.image=(this._app?.canvas).createImage(),this.image.src=this.src,this.initImageEvents())}initImageEvents(){this.image&&(this.image.complete?this._onImageComplete():this.image.addEventListener("load",(()=>{this._onImageComplete()})))}image;_size=new p(this,0,0);_imageSize=new p(this,0,0);set size(t){this.size!==t&&(this._size.copyFrom(t),this.shouldUpdateBounds())}get size(){return this._size}_slice=new p(this);set slice(t){this.slice!==t&&(this._slice.copyFrom(t),this.shouldUpdateBounds())}get slice(){return this._slice}_sliceSize=new p(this);set sliceSize(t){this.sliceSize!==t&&(this._sliceSize.copyFrom(t),this._onUpdate(),this.shouldUpdateBounds())}get sliceSize(){return this._sliceSize}_objectFit="none";set objectFit(t){this.objectFit!==t&&(this._objectFit=t,this.shouldUpdateBounds(),this._onUpdate())}get objectFit(){return this._objectFit}_rounded=0;set rounded(t){t=t<=0?0:t,this.rounded!==t&&(this._rounded=t,this._onUpdate())}_onUpdate(t){this._complete&&super._onUpdate(t)}get rounded(){return this._rounded}_complete=!1;_onImageComplete(){this.image&&(this._imageSize.set(this.image.width,this.image.height),this.size=this.options?.size??{x:this.image.width,y:this.image.height},this.slice=this.options?.slice??this.slice,this.sliceSize=this.options?.sliceSize??{x:this.size.x,y:this.size.y},this.objectFit=this.options?.objectFit??this.objectFit,this.rounded=this.options?.rounded??this.rounded,this._complete=!0,this.emit("ready"),this._onUpdate(),this.shouldUpdateBounds())}get _shouldUpdate(){return!0}get _isSlice(){return!!this.slice.x||!!this.slice.y||!this.sliceSize.equals(this.size)}renderRoundedClip(t,e,i){l(t,e,i,this.rounded),t.clip()}_render(t){if(this.image&&this._complete)if(this._isSlice){const e=[this.image,this.slice.x,this.slice.y,this.sliceSize.x,this.sliceSize.y,this.x,this.y,this.size.x,this.size.y];this.renderRoundedClip(t,this.position,this.size),t.drawImage(...e)}else{const e=this.size.clone(),i=this.position.clone(),s=e.x/this._imageSize.x,n=h([this._imageSize.x,this._imageSize.y])*s,o=this._imageSize.x<this._imageSize.y,r=this._imageSize.x>this._imageSize.y;if(o||r)switch(this.objectFit){case"contain":o?(this.position.set(this.position.x-n/2,this.position.y),this.size.set(this.size.x-n,this.size.y)):(this.position.set(this.position.x,this.position.y+n/2),this.size.set(this.size.x,this.size.y-n)),this.renderRoundedClip(t,this.position,this.size);break;case"cover":o?(this.position.set(this.position.x+n/2,this.position.y),this.size.set(this.size.x+n,this.size.y)):(this.position.set(this.position.x-n/2,this.position.y),this.size.set(this.size.x+n,this.size.y)),this.renderRoundedClip(t,i,e);break;default:this.renderRoundedClip(t,this.position,this.size)}t.drawImage(this.image,this.position.x,this.position.y,this.size.x,this.size.y),this.position=i,this.size=e}}transformWidth=0;transformHeight=0;updateTransformBounds(){this.transformWidth=this.size.x,this.transformHeight=this.size.y}}class x extends g{constructor(t={}){super(t),this.emit("ready"),this._onUpdate()}addPath(...t){this.pathInstruction.push(...t),this.shouldUpdateBounds()}beginPath(){return this.addPath({action:"beginPath",args:[]}),this}closePath(){return this.addPath({action:"closePath",args:[]}),this}lineCap(t){return this.addPath({action:"lineCap",args:[t]}),this}lineJoin(t){return this.addPath({action:"lineJoin",args:[t]}),this}moveTo(t,e){return this.addPath({action:"moveTo",args:[t,e]}),this}lineTo(t,e){return this.addPath({action:"lineTo",args:[t,e]}),this}rect(t,e,i,s){return this.addPath({action:"rect",args:[t,e,i,s]}),this}roundRect(t,e,i,s,n){return this.addPath({action:"roundRect",args:[t,e,i,s,n]}),this}arc(t,e,i,s=0,n=2*Math.PI,h){return this.addPath({action:"arc",args:[t,e,i,s,n,h]}),this}arcTo(t,e,i,s,n){return this.addPath({action:"arcTo",args:[t,e,i,s,n]}),this}bezierCurveTo(t,e,i,s,n,h){return this.addPath({action:"bezierCurveTo",args:[t,e,i,s,n,h]}),this}ellipse(t,e,i,s,n,h,o,r){return this.addPath({action:"ellipse",args:[t,e,i,s,n,h,o,r]}),this}fillRect(t,e,i,s){return this.addPath({action:"fillRect",args:[t,e,i,s]}),this}strokeRect(t,e,i,s){return this.addPath({action:"strokeRect",args:[t,e,i,s]}),this}pathInstruction=[];get _shouldUpdate(){const t=this.pathInstruction.map((t=>t.action));return!(!t.includes("fill")&&!t.includes("stroke"))}_render(t){if(!t)throw new Error("CanvasRenderingContext2D is null or undefined");for(let e=0;e<this.pathInstruction.length;e++){const{action:s,args:n}=this.pathInstruction[e];if("fill"===s)n[0]?t.fillStyle=n[0]:this.fillStyle&&(t.fillStyle=this.fillStyle),t.fill();else if("stroke"===s){if(n[0]){const e=n[0];if("string"==typeof e||"undefined"!=typeof CanvasGradient&&e instanceof CanvasGradient||"undefined"!=typeof CanvasPattern&&e instanceof CanvasPattern)t.strokeStyle=e,t.lineWidth=this.strokeStyle.width??1;else{const i=e,s=i.color??this.strokeStyle.color;s&&(t.strokeStyle=s);const n=i.width??this.strokeStyle.width;n&&(t.lineWidth=n),i.dash?t.setLineDash(i.dash):t.setLineDash([])}}else this.strokeStyle.color&&(t.strokeStyle=this.strokeStyle.color),this.strokeStyle.width&&(t.lineWidth=this.strokeStyle.width),this.strokeStyle.dash?t.setLineDash(this.strokeStyle.dash):t.setLineDash([]);t.stroke()}else if(["lineCap","lineJoin"].includes(s))t[s]=n[0];else if("roundRect"===s&&this._env===i.WX)l(t,{x:n[0],y:n[1]},{x:n[2],y:n[3]},n[4]);else{if(!(s in t))throw new Error(`CanvasRenderingContext2D has no method ${s}`);t[s](...n)}}}_strokeStyle={};set strokeStyle(t){t!==this._strokeStyle&&("string"==typeof t||"undefined"!=typeof CanvasGradient&&t instanceof CanvasGradient||"undefined"!=typeof CanvasPattern&&t instanceof CanvasPattern?this._strokeStyle=r({...this._strokeStyle,color:t},(()=>{this._onUpdate()})):(this._strokeStyle=r(t,(()=>{this._onUpdate()})),this._onUpdate()))}get strokeStyle(){return this._strokeStyle}transformWidth=0;transformHeight=0;updateTransformBounds(){const t=[],e=[];for(let i=0;i<this.pathInstruction.length;i++){const{action:s,args:n}=this.pathInstruction[i];switch(s){case"lineTo":t.push(n[0]),e.push(n[1]);break;case"fillRect":case"strokeRect":case"roundRect":case"rect":{let i=0;"strokeRect"===s&&(i=this.strokeStyle.width??1),t.push(n[0]),e.push(n[1]),t.push(n[0]+n[2]+i),e.push(n[1]+n[3]+i);break}case"arc":case"arcTo":t.push(n[0]+n[2]),e.push(n[1]+n[2]);break;case"bezierCurveTo":t.push(n[2]+n[4]),e.push(n[3]+n[5]);break;case"ellipse":t.push(n[0]+n[2]),e.push(n[1]+n[3])}}this.transformWidth=h(t),this.transformHeight=h(e)}_fillStyle=null;set fillStyle(t){this._fillStyle=t,this._onUpdate()}get fillStyle(){return this._fillStyle}fill(t){return t&&this.addPath({action:"fill",args:[t]}),this}stroke(t){return this.addPath({action:"stroke",args:t?[t]:[]}),this}_filter="none";set filter(t){this._filter=t,this._onUpdate()}get filter(){return this._filter}}class v extends s{_fill="#000";set fill(t){this._fill=t,this.update()}get fill(){return this._fill}_stroke={};set stroke(t){t!==this._stroke&&("string"==typeof t||"undefined"!=typeof CanvasGradient&&t instanceof CanvasGradient||"undefined"!=typeof CanvasPattern&&t instanceof CanvasPattern?this._stroke=r({...this._stroke,color:t},(()=>{this.update()})):(this._stroke=r(t,(()=>{this.update()})),this.update()))}get stroke(){return this._stroke}_filter="none";set filter(t){this._filter=t,this.update()}get filter(){return this._filter}update(){this.emit("update")}updateBounds(){this.emit("updateBounds")}render(t){return this.stroke.color&&this.stroke.width&&(t.lineWidth=this.stroke.width,t.strokeStyle=this.stroke.color),this.fill&&(t.fillStyle=this.fill),this.filter&&(t.filter=this.filter),this}destroy(){this.removeAllListeners()}}class w extends v{static defaultTextStyle={fill:"black",stroke:{width:1},fontFamily:"Arial",fontSize:12,fontStyle:"normal",fontWeight:"normal",fontStretch:"condensed",fontVariantCaps:"normal",letterSpacing:0,wordSpacing:0,textAlign:"left",filter:"none",lineHeight:0,wordWrap:!1,wordWrapWidth:0};_isStroke;constructor(t={}){super(),this._isStroke=!!t.stroke;const e=Object.assign({},w.defaultTextStyle,t);for(const t in e){const i=t,s=e[t];this[i]="stroke"===t?Object.assign({},w.defaultTextStyle[t],s):s}}reset(){const t=w.defaultTextStyle;for(const e in t)this[e]=t[e];this.updateBounds(),this.update()}textBaseline="top";_fontSize;set fontSize(t){this._fontSize=t,this.updateBounds(),this.update()}get fontSize(){return this._fontSize}_fontFamily;set fontFamily(t){this._fontFamily=t,this.updateBounds(),this.update()}get fontFamily(){return this._fontFamily}_fontStyle;set fontStyle(t){this._fontStyle=t,this.updateBounds(),this.update()}get fontStyle(){return this._fontStyle}_fontWeight;set fontWeight(t){this._fontWeight=t,this.updateBounds(),this.update()}get fontWeight(){return this._fontWeight}_fontStretch=w.defaultTextStyle.fontStretch;set fontStretch(t){this._fontStretch=t,this.updateBounds(),this.update()}get fontStretch(){return this._fontStretch}_fontVariantCaps=w.defaultTextStyle.fontVariantCaps;set fontVariantCaps(t){this._fontVariantCaps=t,this.updateBounds(),this.update()}get fontVariantCaps(){return this._fontVariantCaps}_letterSpacing=w.defaultTextStyle.letterSpacing;set letterSpacing(t){this._letterSpacing=t,this.update(),this.updateBounds()}get letterSpacing(){return this._letterSpacing}_wordSpacing=w.defaultTextStyle.wordSpacing;set wordSpacing(t){this._wordSpacing=t,this.update(),this.updateBounds()}get wordSpacing(){return this._wordSpacing}_textAlign=w.defaultTextStyle.textAlign;set textAlign(t){this._textAlign=t,this.update()}get textAlign(){return this._textAlign}_lineHeight=0;set lineHeight(t){this.lineHeight!==t&&(this._lineHeight=t,this.update(),this.updateBounds())}get lineHeight(){return this._lineHeight||(this._lineHeight="number"==typeof this.fontSize?this.fontSize:Number.parseInt(`${this.fontSize}`)),this._lineHeight}_wordWrap=!1;set wordWrap(t){this.wordWrap!==t&&(this._wordWrap=t,this.update(),this.updateBounds())}get wordWrap(){return this._wordWrap}_wordWrapWidth=0;set wordWrapWidth(t){this.wordWrapWidth!==t&&(this._wordWrapWidth=t,this.update(),this.updateBounds())}get wordWrapWidth(){return this._wordWrapWidth}clone(){return new w({fill:this.fill,stroke:this.stroke,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontStretch:this.fontStretch,fontVariantCaps:this.fontVariantCaps,letterSpacing:this.letterSpacing,wordSpacing:this.wordSpacing,textAlign:this.textAlign,filter:this.filter})}render(t){return super.render(t),t.textBaseline="top",t.font=function({fontFamily:t,fontSize:e,fontStyle:i="normal",fontWeight:s="normal"}){return`${i} ${s} ${"string"==typeof e?e:`${e}px`} ${t}`}(this),t.fontStretch=this.fontStretch,t.fontVariantCaps=this.fontVariantCaps,t.letterSpacing=n(this.letterSpacing),t.wordSpacing=n(this.wordSpacing),t.textAlign=this.textAlign,this}}class S extends g{constructor(t){super(t),t.style&&(this.style=t.style),this.text=t.text??"",this.emit("ready"),this._onUpdate()}_style=new w;set style(t){t=t||{},this._style?.off("update",this._onUpdate,this),this._style?.off("updateBounds",this.shouldUpdateBounds,this),this._style=t instanceof w?t:new w(t),this._style.on("update",this._onUpdate,this),this._style?.on("updateBounds",this.shouldUpdateBounds,this),this._onUpdate()}get style(){return this._style}_text="";set text(t){this._text!==t&&(this._text=t,this._onUpdate())}get text(){return this._text}get _shouldUpdate(){return!!this.style.fill||!(!this.style.stroke.color||!this.style.stroke.width)}getSplitText(t){const e=this.text.split(""),i=[];let s=[];for(let n=0;n<e.length;n++){const h=e[n];s.push(h);const o=s.join("");t.measureText(o).width>this.style.wordWrapWidth?(s.pop(),i.push(s.join("")),s=[h]):n===e.length-1&&i.push(o)}return i}_render(t){if(this.style.fill||this.style.stroke?.color&&this.style.stroke?.width)if(this.style.render(t),this.style.wordWrap&&this.style.wordWrapWidth){const e=this.getSplitText(t);for(let i=0;i<e.length;i++){const s=e[i];this.style.fill&&t.strokeText(s,this.position.x,this.position.y+i*this.style.lineHeight),this.style.stroke?.color&&this.style.stroke?.width&&t.strokeText(s,this.position.x,this.position.y+i*this.style.lineHeight)}}else this.style.fill&&t.fillText(this.text,this.position.x,this.position.y),this.style.stroke?.color&&this.style.stroke?.width&&t.strokeText(this.text,this.position.x,this.position.y)}transformWidth=0;transformHeight=0;updateTransformBounds(){this._app&&this._app.wrapperRender((t=>{if(this.style.render(t),this.style.wordWrap&&this.style.wordWrapWidth){const e=this.getSplitText(t);if(this.transformWidth=this.style.wordWrapWidth,!e.length)return void(this.transformHeight=0);const i=t.measureText(this.getSplitText(t)[0]),s=this.style.lineHeight;let n=Math.max(i.actualBoundingBoxDescent-i.actualBoundingBoxAscent,s);this.style.stroke&&this.style.stroke.width&&(n+=this.style.stroke.width),e.length>1&&(this.transformHeight=(e.length-1)*s+n)}else{const e=t.measureText(this.text);this.transformWidth=e.width;let i=Math.max(e.actualBoundingBoxDescent-e.actualBoundingBoxAscent,"number"==typeof this.style.fontSize?this.style.fontSize:Number.parseInt(`${this.style.fontSize}`));this.style.stroke&&this.style.stroke.width&&(i+=this.style.stroke.width),this.transformHeight=i}}))}}export{d as App,m as Picture,x as Shape,S as Text,w as TextStyle};
//# sourceMappingURL=index.esm.js.map
